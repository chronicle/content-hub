<!--Copyright 2025 Google LLC-->

<!--Licensed under the Apache License, Version 2.0 (the "License");-->
<!--you may not use this file except in compliance with the License.-->
<!--You may obtain a copy of the License at-->

<!--http://www.apache.org/licenses/LICENSE-2.0-->

<!--Unless required by applicable law or agreed to in writing, software-->
<!--distributed under the License is distributed on an "AS IS" BASIS,-->
<!--WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.-->
<!--See the License for the specific language governing permissions and-->
<!--limitations under the License.-->

<!DOCTYPE html>
<html lang="en" class="antialiased bg-slate-100">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Validation Test Report</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    {{ css_content }}
  </style>
</head>
<body class="text-slate-600 p-4 md:p-8 bg-slate-100">

<main class="max-w-7xl mx-auto space-y-8">
  <header class="flex flex-col md:flex-row justify-between items-start md:items-end gap-6 border-b border-slate-200 pb-8">
    <div class="space-y-2">
      <div class="flex items-center gap-2">
        <span class="px-3 py-1 rounded-full bg-indigo-100 text-indigo-700 text-xs font-bold tracking-wide uppercase">Validation Report</span>
      </div>
      <h1 class="text-4xl md:text-5xl font-bold text-slate-800 tracking-tight">
        Validation Results
      </h1>
      <p class="text-slate-500 font-medium flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        Generated on {{ current_time }}
      </p>
    </div>

    <button onclick="downloadReport()" class="group flex items-center gap-2 bg-slate-800 hover:bg-slate-700 text-white font-semibold px-5 py-2.5 rounded-lg shadow-lg hover:shadow-xl transition-all transform hover:-translate-y-0.5 duration-200">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 group-hover:animate-bounce" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
      </svg>
      <span>Download JSON</span>
    </button>
  </header>

  <section class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 flex items-center justify-between group hover:border-amber-200 hover:shadow-md transform hover:-translate-y-1 transition-all duration-300">
      <div>
        <p class="text-sm font-semibold text-slate-400 uppercase tracking-wider">Total Warnings</p>
        <p class="text-4xl font-bold text-amber-600 mt-1">{{ total_non_fatal_issues }}</p>
      </div>
      <div class="h-12 w-12 rounded-xl bg-amber-50 text-amber-600 flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
        </svg>
      </div>
    </div>
    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 flex items-center justify-between group hover:border-red-200 hover:shadow-md transform hover:-translate-y-1 transition-all duration-300">
      <div>
        <p class="text-sm font-semibold text-slate-400 uppercase tracking-wider">Total Failures</p>
        <p class="text-4xl font-bold text-red-600 mt-1">{{ total_fatal_issues }}</p>
      </div>
      <div class="h-12 w-12 rounded-xl bg-red-50 text-red-600 flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
      </div>
    </div>
  </section>

  <section class="tab-container mb-6">
    <nav class="flex space-x-4 border-b border-slate-200" aria-label="Main Types">
      {% for group_name in validation_groups.keys() %}
      <button
          class="tab-button flex items-center gap-2 px-4 py-3 text-lg font-bold text-slate-500 border-b-2 border-transparent hover:text-slate-800 transition-colors {% if loop.first %}active border-indigo-600 text-indigo-600{% endif %}"
          onclick="switchTab(this, 'group-{{ group_name|urlencode }}', '.tab-container')">
        {% if group_name == 'Playbook' %}
        <span class="text-xl">ðŸ“˜</span>
        {% else %}
        <span class="text-xl">ðŸ§©</span>
        {% endif %}
        {{ group_name }}
      </button>
      {% endfor %}
    </nav>
  </section>

  <section class="tab-content-container">
    {% for group_name, group_data in validation_groups.items() %}
    <div id="group-{{ group_name|urlencode }}" class="tab-content {% if not loop.first %}hidden{% endif %} animate-fade-in space-y-6">

      <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden min-h-[500px]">

        <div class="tab-container border-b border-slate-200 bg-slate-50/50 px-6 py-4">
          <nav class="flex space-x-2 bg-slate-200/50 p-1 rounded-xl w-fit" aria-label="Stages">
            {% for category in group_data.reports_by_category.keys() %}
            <button class="tab-button px-6 py-2 rounded-lg text-sm font-semibold transition-all duration-300 ease-out {% if loop.first %}active{% endif %}"
                    onclick="switchTab(this, '{{ group_name|urlencode }}-{{ category|urlencode }}', '.tab-container')">
              {{ category }}
            </button>
            {% endfor %}
          </nav>
        </div>

        <div class="tab-content-container p-6 md:p-8 bg-slate-50/30">
          {% for category, reports in group_data.reports_by_category.items() %}
          <div id="{{ group_name|urlencode }}-{{ category|urlencode }}" class="tab-content {% if not loop.first %}hidden{% endif %} animate-fade-in space-y-4">

            {% if reports %}
            {% for report in reports %}
            {% set has_fatal = report.validation_report.failed_fatal_validations | length > 0 %}
            {% set has_non_fatal = report.validation_report.failed_non_fatal_validations | length > 0 %}
            {% set status = 'fail' if has_fatal else 'warn' %}

            <div class="integration-item bg-white rounded-xl border border-slate-200 shadow-sm hover:shadow-lg hover:-translate-y-0.5 transition-all duration-300 overflow-hidden">
              <div class="p-4 md:p-5 cursor-pointer flex justify-between items-center group" onclick="toggleAccordion(this)">
                <div class="flex items-center gap-4">
                  <div class="status-icon-{{ status }} p-2 rounded-lg transition-transform duration-300 group-hover:scale-110">
                    {% if status == 'warn' %}
                    <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>
                    {% else %}
                    <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    {% endif %}
                  </div>
                  <div>
                    <h3 class="font-bold text-lg text-slate-800 group-hover:text-indigo-600 transition-colors">{{ report.integration_name }}</h3>
                  </div>
                </div>

                <div class="flex items-center gap-6">
                  <div class="flex gap-2">
                    {% if has_fatal %}
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                          {{ report.validation_report.failed_fatal_validations | length }} Failed
                        </span>
                    {% endif %}
                    {% if has_non_fatal %}
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-amber-100 text-amber-800">
                          {{ report.validation_report.failed_non_fatal_validations | length }} Warnings
                        </span>
                    {% endif %}
                  </div>
                  <svg class="chevron-icon h-5 w-5 text-slate-400 group-hover:text-slate-600 transform transition-transform duration-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                  </svg>
                </div>
              </div>

              <div class="collapsible-content bg-slate-50/50">
                <div class="p-6 border-t border-slate-100 space-y-6">

                  {% if has_fatal %}
                  <div class="animate-fade-in">
                    <h4 class="flex items-center gap-2 text-sm font-bold text-red-600 uppercase tracking-wider mb-4">
                      <span class="w-2 h-2 rounded-full bg-red-600"></span> Fatal Errors
                    </h4>
                    <div class="space-y-3">
                      {% for issue in report.validation_report.failed_fatal_validations %}
                      <div class="bg-white rounded-lg border border-red-200 overflow-hidden shadow-sm hover:shadow-md transition-shadow">
                        <div class="p-4 bg-red-50/30 flex justify-between items-center cursor-pointer hover:bg-red-50 transition-colors" onclick="toggleAccordion(this)">
                          <span class="font-semibold text-red-900">{{ issue.validation_name }}</span>
                          <svg class="chevron-icon h-4 w-4 text-red-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                        </div>
                        {% if issue.info %}
                        <div class="collapsible-content">
                          <div class="p-4 bg-slate-800 text-slate-200 text-sm font-mono overflow-x-auto border-t border-red-100">
                            {{ issue.info }}
                          </div>
                        </div>
                        {% endif %}
                      </div>
                      {% endfor %}
                    </div>
                  </div>
                  {% endif %}

                  {% if has_non_fatal %}
                  <div class="animate-fade-in">
                    <h4 class="flex items-center gap-2 text-sm font-bold text-amber-600 uppercase tracking-wider mb-4">
                      <span class="w-2 h-2 rounded-full bg-amber-600"></span> Warnings
                    </h4>
                    <div class="space-y-3">
                      {% for issue in report.validation_report.failed_non_fatal_validations %}
                      <div class="bg-white rounded-lg border border-amber-200 overflow-hidden shadow-sm hover:shadow-md transition-shadow">
                        <div class="p-4 bg-amber-50/30 flex justify-between items-center cursor-pointer hover:bg-amber-50 transition-colors" onclick="toggleAccordion(this)">
                          <span class="font-semibold text-amber-900">{{ issue.validation_name }}</span>
                          <svg class="chevron-icon h-4 w-4 text-amber-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                        </div>
                        {% if issue.info %}
                        <div class="collapsible-content">
                          <div class="p-4 bg-amber-50/20 text-slate-700 text-sm font-mono overflow-x-auto border-t border-amber-100">
                            {{ issue.info }}
                          </div>
                        </div>
                        {% endif %}
                      </div>
                      {% endfor %}
                    </div>
                  </div>
                  {% endif %}
                </div>
              </div>
            </div>
            {% endfor %}
            {% else %}
            <div class="flex flex-col items-center justify-center py-20 text-center animate-fade-in">
              <div class="w-24 h-24 bg-emerald-50 rounded-full flex items-center justify-center mb-6">
                <svg class="w-12 h-12 text-emerald-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
              </div>
              <h3 class="text-2xl font-bold text-slate-800 mb-2">No Failures Found</h3>
              <p class="text-slate-500 max-w-sm">There are no failed validations to display for this stage.</p>
            </div>
            {% endif %}
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
    {% endfor %}
  </section>

</main>

<script>
  {{ js_content | safe }}
</script>
</body>
</html>