GetAuthenticationLogsForUser:
  ai_description: >-
    Retrieves comprehensive user data and multi-factor authentication (MFA) logs from
    Duo Security for a specified user within a defined timeframe. This action is designed
    to assist in security investigations by identifying 'known safe' authentication
    sources based on a configurable frequency threshold.


    ### Parameters

    | Parameter | Type | Mandatory | Description |

    | :--- | :--- | :--- | :--- |

    | Authentication Threshold | String | Yes | The minimum number of successful authentications
    required for an authentication source (IP, device, etc.) to be considered 'known'
    or 'safe'. Default is 2. |

    | Number Days Back | String | Yes | The number of days prior to the current time
    to search for authentication logs. Default is 1 day. |

    | Username | String | No | The specific Duo username to retrieve data for. While
    marked as not mandatory in settings, the action logic requires this to identify
    the target user. |


    ### Flow Description

    1. **Configuration Retrieval:** Extracts Duo Admin API credentials (Hostname,
    Secret Key, and Integration Key) from the integration configuration.

    2. **Time Window Calculation:** Calculates the epoch timestamps for the start
    (current time minus 'Number Days Back') and end of the search window.

    3. **User Identification:** Uses the Duo Admin SDK to fetch user metadata for
    the provided 'Username' to obtain the unique internal `user_id`.

    4. **Log Retrieval:** Requests authentication logs from Duo for the specific `user_id`
    within the calculated time window.

    5. **Data Aggregation:** Parses successful authentication events to count occurrences
    of specific attributes: Access IPs, States, OS versions, Applications, Auth Devices,
    and Factors.

    6. **Threshold Filtering:** Filters the aggregated counts; any source with fewer
    successful logins than the 'Authentication Threshold' is removed from the 'known'
    lists to highlight anomalies.

    7. **Result Generation:** Compiles the raw logs and the processed 'known source'
    dictionaries into a JSON result for use in subsequent playbook steps.


    ### Additional Notes

    - The action utilizes a retry mechanism (60-second sleep) if it encounters errors
    during API calls, typically to handle Duo's rate-limiting.
  capabilities:
    can_create_case_comments: false
    can_create_case_wall_logs: false
    can_create_insight: false
    can_mutate_external_data: false
    can_mutate_internal_data: false
    can_update_entities: false
    external_data_mutation_explanation: null
    fetches_data: true
    internal_data_mutation_explanation: null
  categories:
    enrichment: true
  entity_usage:
    entity_scopes: [ ]
    filters_by_additional_properties: false
    filters_by_alert_identifier: false
    filters_by_case_identifier: false
    filters_by_creation_time: false
    filters_by_entity_type: false
    filters_by_identifier: false
    filters_by_is_artifact: false
    filters_by_is_enriched: false
    filters_by_is_internal: false
    filters_by_is_pivot: false
    filters_by_is_suspicious: false
    filters_by_is_vulnerable: false
    filters_by_modification_time: false
GetTrustMonitorEvents:
  ai_description: >-
    ### General Description

    The **Get Trust Monitor Events** action retrieves historical event data from the
    DUO Trust Monitor. It allows users to query DUO's administrative API to collect
    security-related events that occurred within a specified number of days preceding
    the current time.


    ### Parameters Description

    | Parameter Name | Type | Mandatory | Description |

    | :--- | :--- | :--- | :--- |

    | **Number Days Back** | String | Yes | The number of days from the current moment
    to look back and retrieve Trust Monitor events. |


    ### Flow Description

    1. **Configuration Retrieval:** The action extracts the DUO API Hostname, Admin
    Secret Key, and Admin Integration Key from the integration settings.

    2. **Parameter Processing:** The 'Number Days Back' parameter is converted into
    a millisecond-based timestamp range relative to the current system time.

    3. **API Request:** Using the DUO Python SDK, the action authenticates and calls
    the `get_trust_monitor_events_by_offset` endpoint using the calculated time range.

    4. **Result Reporting:** The retrieved events are compiled into a list and added
    to the action's JSON results for use in downstream playbook steps.


    ### Additional Notes

    - This action does not interact with specific entities (like IPs or Users) from
    the alert context; it performs a global search for events within the specified
    timeframe.

    - Ensure the provided Admin Integration Key has the appropriate permissions to
    access Trust Monitor data.
  capabilities:
    can_create_case_comments: false
    can_create_case_wall_logs: false
    can_create_insight: false
    can_mutate_external_data: false
    can_mutate_internal_data: false
    can_update_entities: false
    external_data_mutation_explanation: null
    fetches_data: true
    internal_data_mutation_explanation: null
  categories:
    enrichment: true
  entity_usage:
    entity_scopes: [ ]
    filters_by_additional_properties: false
    filters_by_alert_identifier: false
    filters_by_case_identifier: false
    filters_by_creation_time: false
    filters_by_entity_type: false
    filters_by_identifier: false
    filters_by_is_artifact: false
    filters_by_is_enriched: false
    filters_by_is_internal: false
    filters_by_is_pivot: false
    filters_by_is_suspicious: false
    filters_by_is_vulnerable: false
    filters_by_modification_time: false
GetUsersByName:
  ai_description: >-
    ### General Description

    This action queries the DUO Admin API to retrieve comprehensive information for
    a specific username. It is used to obtain user identifiers, authentication details,
    and device data associated with a DUO MFA account within the environment.


    ### Parameters Description

    | Parameter | Type | Mandatory | Description |

    | :--- | :--- | :--- | :--- |

    | Username | String | Yes | The DUO username for which to retrieve data from the
    Admin API. |


    ### Flow Description

    1. **Authentication**: The action initializes the DUO Admin API client using the
    integration's API Hostname, Integration Key, and Secret Key.

    2. **Parameter Extraction**: Retrieves the target 'Username' from the action parameters.

    3. **API Query**: Calls the DUO SDK method `get_users_by_name` to fetch user-specific
    records.

    4. **Data Aggregation**: Iterates through the returned user data to identify the
    unique DUO User ID and compiles the full metadata response.

    5. **Completion**: Appends the retrieved user details to the action's JSON results
    and completes the execution.


    ### Additional Notes

    This action does not process entities from the SOAR scope; it operates solely
    based on the input string provided in the 'Username' parameter.
  capabilities:
    can_create_case_comments: false
    can_create_case_wall_logs: false
    can_create_insight: false
    can_mutate_external_data: false
    can_mutate_internal_data: false
    can_update_entities: false
    external_data_mutation_explanation: null
    fetches_data: true
    internal_data_mutation_explanation: null
  categories:
    enrichment: true
  entity_usage:
    entity_scopes: [ ]
    filters_by_additional_properties: false
    filters_by_alert_identifier: false
    filters_by_case_identifier: false
    filters_by_creation_time: false
    filters_by_entity_type: false
    filters_by_identifier: false
    filters_by_is_artifact: false
    filters_by_is_enriched: false
    filters_by_is_internal: false
    filters_by_is_pivot: false
    filters_by_is_suspicious: false
    filters_by_is_vulnerable: false
    filters_by_modification_time: false
Ping:
  ai_description: >-
    ### General Description

    The **Ping** action is a diagnostic utility designed to verify connectivity between
    Google SecOps and the Duo Security Auth API. It validates that the provided API
    Hostname, Secret Key, and Integration Key are correct and that the system can
    successfully generate the required request signatures to communicate with Duo.


    ### Parameters Description

    This action does not utilize action-specific parameters. Instead, it relies on
    the global integration configuration parameters:


    | Parameter | Description | Expected Type | Mandatory |

    | :--- | :--- | :--- | :--- |

    | API Hostname | The Duo API hostname (e.g., api-xxxx.duosecurity.com). | String
    | Yes |

    | Auth Secret Key | The Secret Key for the Duo Auth API. | String | Yes |

    | Auth Integration Key | The Integration Key for the Duo Auth API. | String |
    Yes |


    ### Additional Notes

    - This action is typically used during the initial setup of the Duo integration
    or for troubleshooting connectivity issues.

    - It does not process or interact with any entities within the case.


    ### Flow Description

    1. **Credential Retrieval**: The script extracts the API Hostname, Auth Secret
    Key, and Auth Integration Key from the integration's configuration.

    2. **Client Initialization**: It initializes the Duo Python SDK (`duo_client.Auth`)
    using the retrieved credentials.

    3. **Connectivity Test**: It executes a call to the Duo `/check` endpoint.

    4. **Status Report**: The action returns a success message if the credentials
    and signature are valid. If an exception occurs (e.g., network timeout, invalid
    keys), it catches the error and reports a failure status.
  capabilities:
    can_create_case_comments: false
    can_create_case_wall_logs: false
    can_create_insight: false
    can_mutate_external_data: false
    can_mutate_internal_data: false
    can_update_entities: false
    external_data_mutation_explanation: null
    fetches_data: true
    internal_data_mutation_explanation: null
  categories:
    enrichment: false
  entity_usage:
    entity_scopes: [ ]
    filters_by_additional_properties: false
    filters_by_alert_identifier: false
    filters_by_case_identifier: false
    filters_by_creation_time: false
    filters_by_entity_type: false
    filters_by_identifier: false
    filters_by_is_artifact: false
    filters_by_is_enriched: false
    filters_by_is_internal: false
    filters_by_is_pivot: false
    filters_by_is_suspicious: false
    filters_by_is_vulnerable: false
    filters_by_modification_time: false
