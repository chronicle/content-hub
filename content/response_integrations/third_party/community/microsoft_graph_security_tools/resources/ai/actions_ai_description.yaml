Delete Attachment:
  ai_description: >-
    ### General Description

    This action deletes a specific attachment from a user's mailbox in Microsoft 365
    using the Microsoft Graph API. It is primarily used for remediation tasks, such
    as removing malicious files from an inbox after they have been identified.


    ### Parameters

    | Parameter Name | Type | Mandatory | Description |

    | :--- | :--- | :--- | :--- |

    | User ID | string | Yes | The user principal name (email address) of the mailbox
    owner. |

    | Message ID | string | Yes | The unique identifier of the email message containing
    the attachment. |

    | Attachment ID | string | Yes | The unique identifier of the specific attachment
    to be deleted. |


    ### Flow Description

    1. **Authentication**: The action initializes a connection to Microsoft Graph
    using the provided Client ID, Secret/Certificate, and Tenant ID.

    2. **Parameter Extraction**: It retrieves the User ID, Message ID, and Attachment
    ID from the action inputs.

    3. **API Execution**: It sends a DELETE request to the Microsoft Graph endpoint:
    `https://graph.microsoft.com/v1.0/users/{user_id}/messages/{message_id}/attachments/{attachment_id}`.

    4. **Result Processing**: The action checks the HTTP response status. A 204 status
    code indicates a successful deletion. The result is then logged and returned to
    the Google SecOps platform.


    ### Additional Notes

    This action requires the integration to have sufficient permissions (e.g., `Mail.ReadWrite`)
    in the Azure AD application registration to perform deletion operations on user
    mailboxes.
  capabilities:
    can_create_case_comments: false
    can_create_insight: false
    can_modify_alert_data: false
    can_mutate_external_data: true
    can_mutate_internal_data: false
    can_update_entities: false
    external_data_mutation_explanation: >-
      Deletes an attachment from a user's mailbox in Microsoft 365 via the Microsoft
      Graph API.
    fetches_data: false
    internal_data_mutation_explanation: null
  categories:
    enrichment: false
  entity_usage:
    entity_types: []
    filters_by_additional_properties: false
    filters_by_alert_identifier: false
    filters_by_case_identifier: false
    filters_by_creation_time: false
    filters_by_entity_type: false
    filters_by_identifier: false
    filters_by_is_artifact: false
    filters_by_is_enriched: false
    filters_by_is_internal: false
    filters_by_is_pivot: false
    filters_by_is_suspicious: false
    filters_by_is_vulnerable: false
    filters_by_modification_time: false
Delete Message:
  ai_description: >-
    ### General Description

    Deletes a specific email message from one or more Microsoft 365 mailboxes using
    the Microsoft Graph API. This action is primarily used for remediation and containment,
    allowing security analysts to remove malicious or unauthorized emails from user
    environments.


    ### Parameters

    | Parameter Name | Type | Mandatory | Description |

    | :--- | :--- | :--- | :--- |

    | Message ID | string | Yes | The unique identifier of the email message to be
    deleted. |

    | User ID | string | Yes | The email address or userPrincipalName of the mailbox
    owner. This parameter supports a comma-separated list (CSV) to target multiple
    mailboxes simultaneously. |


    ### Flow Description

    1. **Authentication**: The action establishes a connection to Microsoft Graph
    using the provided integration credentials (Client ID, Secret, Tenant ID, or Certificate).

    2. **Input Parsing**: It retrieves the `Message ID` and `User ID` from the action
    parameters. If the `User ID` contains multiple values, it splits them into a list.

    3. **API Execution**: For each provided User ID, the action sends a DELETE request
    to the Microsoft Graph endpoint `https://graph.microsoft.com/v1.0/users/{user_id}/messages/{message_id}`.

    4. **Result Handling**: The action checks the HTTP status code of the response.
    A 204 status code indicates a successful deletion. The final status and result
    JSON are then returned to the Google SecOps platform.


    ### Additional Notes

    This action performs a permanent deletion of the message from the specified mailbox(es).
    Ensure the Message ID is accurate before execution.
  capabilities:
    can_create_case_comments: false
    can_create_insight: false
    can_modify_alert_data: false
    can_mutate_external_data: true
    can_mutate_internal_data: false
    can_update_entities: false
    external_data_mutation_explanation: >-
      Deletes email messages from Microsoft 365 mailboxes via the Microsoft Graph
      API.
    fetches_data: false
    internal_data_mutation_explanation: null
  categories:
    enrichment: false
  entity_usage:
    entity_types: []
    filters_by_additional_properties: false
    filters_by_alert_identifier: false
    filters_by_case_identifier: false
    filters_by_creation_time: false
    filters_by_entity_type: false
    filters_by_identifier: false
    filters_by_is_artifact: false
    filters_by_is_enriched: false
    filters_by_is_internal: false
    filters_by_is_pivot: false
    filters_by_is_suspicious: false
    filters_by_is_vulnerable: false
    filters_by_modification_time: false
Get Message:
  ai_description: >-
    ### General Description

    This action retrieves a specific email message from a user's inbox using the Microsoft
    Graph API. It is designed to fetch detailed message metadata and content for investigation
    or archival purposes. The action requires the user's principal name (email) and
    the specific message ID to perform the lookup.


    ### Parameters Description


    | Parameter | Type | Mandatory | Description |

    | :--- | :--- | :--- | :--- |

    | User ID | string | Yes | The userPrincipalName (email) of the user whose inbox
    is being accessed. |

    | Message ID | string | Yes | The unique identifier of the email message to retrieve.
    |


    ### Additional Notes

    This action performs a read-only operation (GET request) and does not modify the
    state of the mailbox or the message itself. It requires appropriate Microsoft
    Graph permissions (e.g., `Mail.Read`) to be configured in the Azure App Registration.


    ### Flow Description

    1. **Authentication**: The action initializes the `MicrosoftGraphSecurityManager`
    using the integration's configuration (Client ID, Secret/Certificate, and Tenant
    ID) to obtain an OAuth2 access token.

    2. **Parameter Extraction**: It extracts the `User ID` and `Message ID` provided
    by the user.

    3. **API Request**: The action calls the Microsoft Graph `/users/{user_id}/messages/{message_id}`
    endpoint via a GET request.

    4. **Data Processing**: The retrieved message data is processed and added to the
    action's JSON results.

    5. **Completion**: The action terminates, returning the message details as a structured
    JSON object.
  capabilities:
    can_create_case_comments: false
    can_create_insight: false
    can_modify_alert_data: false
    can_mutate_external_data: false
    can_mutate_internal_data: false
    can_update_entities: false
    external_data_mutation_explanation: null
    fetches_data: true
    internal_data_mutation_explanation: null
  categories:
    enrichment: true
  entity_usage:
    entity_types: []
    filters_by_additional_properties: false
    filters_by_alert_identifier: false
    filters_by_case_identifier: false
    filters_by_creation_time: false
    filters_by_entity_type: false
    filters_by_identifier: false
    filters_by_is_artifact: false
    filters_by_is_enriched: false
    filters_by_is_internal: false
    filters_by_is_pivot: false
    filters_by_is_suspicious: false
    filters_by_is_vulnerable: false
    filters_by_modification_time: false
Get User MFA:
  ai_description: >-
    ### General Description

    This action retrieves Multi-Factor Authentication (MFA) registration and status
    details for users from Microsoft Graph. It is designed to provide security analysts
    with visibility into whether users have MFA enabled, registered, and which authentication
    methods are in use. The action can query a specific email address provided as
    a parameter and also automatically processes email-related entities within the
    case.


    ### Parameters Description

    | Parameter | Type | Mandatory | Description |

    | :--- | :--- | :--- | :--- |

    | **User Email** | string | Yes | The primary user principal name (email) to search
    for MFA statistics. |

    | **Create Insight** | boolean | No | If set to `true`, the action will create
    a detailed Case Insight for every user found with MFA statistics. Default is `false`.
    |

    | **Integration Configuration** | N/A | Yes | Requires valid Microsoft Graph credentials
    (Client ID, Secret/Certificate, and Tenant ID) configured in the integration settings.
    |


    ### Flow Description

    1. **Authentication**: Connects to the Microsoft Graph API using the provided
    Client ID, Tenant ID, and either a Client Secret or Certificate.

    2. **Primary Query**: Retrieves MFA registration details for the email address
    specified in the `User Email` parameter.

    3. **Entity Processing**: Iterates through all entities in the current context.
    It identifies potential user entities by checking if the entity identifier contains
    an '@' symbol.

    4. **Data Retrieval**: For each identified entity, it queries the Microsoft Graph
    `credentialUserRegistrationDetails` report to fetch MFA status (e.g., `isRegistered`,
    `isEnabled`, `isCapable`).

    5. **Insight Generation**: If the `Create Insight` parameter is enabled, the action
    generates a formatted insight for each user, detailing their MFA registration
    status and available authentication methods.

    6. **Result Compilation**: Aggregates all retrieved MFA records into a JSON array
    and returns it as the action result.


    ### Additional Notes

    - The action uses the Microsoft Graph Beta endpoint for MFA reports.

    - The JSON result index zero always corresponds to the user provided in the `User
    Email` parameter.
  capabilities:
    can_create_case_comments: false
    can_create_insight: true
    can_modify_alert_data: false
    can_mutate_external_data: false
    can_mutate_internal_data: true
    can_update_entities: false
    external_data_mutation_explanation: null
    fetches_data: true
    internal_data_mutation_explanation: >-
      The action creates Case Insights within Google SecOps to display MFA registration
      details if the 'Create Insight' parameter is enabled.
  categories:
    enrichment: true
  entity_usage:
    entity_types:
    - ADDRESS
    - ALERT
    - APPLICATION
    - CHILDHASH
    - CHILDPROCESS
    - CLUSTER
    - CONTAINER
    - CREDITCARD
    - CVE
    - CVEID
    - DATABASE
    - DEPLOYMENT
    - DESTINATIONDOMAIN
    - DOMAIN
    - EMAILSUBJECT
    - EVENT
    - FILEHASH
    - FILENAME
    - GENERICENTITY
    - HOSTNAME
    - IPSET
    - MacAddress
    - PARENTHASH
    - PARENTPROCESS
    - PHONENUMBER
    - POD
    - PROCESS
    - SERVICE
    - SOURCEDOMAIN
    - THREATACTOR
    - THREATCAMPAIGN
    - THREATSIGNATURE
    - DestinationURL
    - USB
    - USERUNIQNAME
    filters_by_additional_properties: false
    filters_by_alert_identifier: false
    filters_by_case_identifier: false
    filters_by_creation_time: false
    filters_by_entity_type: false
    filters_by_identifier: true
    filters_by_is_artifact: false
    filters_by_is_enriched: false
    filters_by_is_internal: false
    filters_by_is_pivot: false
    filters_by_is_suspicious: false
    filters_by_is_vulnerable: false
    filters_by_modification_time: false
List Attachments:
  ai_description: >-
    ### General Description

    This action retrieves a list of attachment objects associated with a specific
    email message in a user's mailbox using the Microsoft Graph API. It is primarily
    used for forensic investigation and mail analysis to identify files sent or received
    within a specific message context.


    ### Parameters Description

    | Parameter | Type | Mandatory | Description |

    | :--- | :--- | :--- | :--- |

    | User ID | String | Yes | The userPrincipalName (email address) or the unique
    ID of the user whose mailbox is being accessed. |

    | Message ID | String | No | The unique identifier of the message from which to
    retrieve the list of attachments. |


    ### Additional Notes

    * This action requires valid Microsoft Graph API credentials (Client ID, Tenant
    ID, and either a Client Secret or a Certificate) configured in the integration
    settings.

    * The action returns the raw JSON metadata for all attachments found on the message,
    which typically includes properties like `name`, `contentType`, `size`, and `id`.


    ### Flow Description

    1. **Authentication**: The action initializes the `MicrosoftGraphSecurityManager`
    using the integration's configuration parameters (Client ID, Secret/Certificate,
    Tenant ID) to obtain an OAuth2 access token.

    2. **Parameter Extraction**: It retrieves the `User ID` and `Message ID` provided
    by the user in the action configuration.

    3. **API Request**: The action calls the `list_attachments` method in the manager,
    which executes a GET request to the Microsoft Graph endpoint: `https://graph.microsoft.com/v1.0/users/{user_id}/messages/{message_id}/attachments`.

    4. **Result Processing**: The retrieved attachment data is added to the action's
    JSON results.

    5. **Completion**: The action terminates with a success status, providing the
    attachment list for downstream processing.
  capabilities:
    can_create_case_comments: false
    can_create_insight: false
    can_modify_alert_data: false
    can_mutate_external_data: false
    can_mutate_internal_data: false
    can_update_entities: false
    external_data_mutation_explanation: null
    fetches_data: true
    internal_data_mutation_explanation: null
  categories:
    enrichment: true
  entity_usage:
    entity_types: []
    filters_by_additional_properties: false
    filters_by_alert_identifier: false
    filters_by_case_identifier: false
    filters_by_creation_time: false
    filters_by_entity_type: false
    filters_by_identifier: false
    filters_by_is_artifact: false
    filters_by_is_enriched: false
    filters_by_is_internal: false
    filters_by_is_pivot: false
    filters_by_is_suspicious: false
    filters_by_is_vulnerable: false
    filters_by_modification_time: false
List Mail Rules:
  ai_description: >-
    ### General Description

    This action retrieves all message rules defined for a specific user's inbox in
    Microsoft 365 using the Microsoft Graph API. It is primarily used for investigating
    suspicious mailbox configurations, such as rules that automatically forward or
    delete emails, which are common indicators of business email compromise (BEC).


    ### Parameters Description

    | Parameter | Description | Type | Mandatory |

    | :--- | :--- | :--- | :--- |

    | User ID | The email address or userPrincipalName (UPN) of the target user whose
    inbox rules will be listed. | String | Yes |


    ### Flow Description

    1. **Authentication**: The action initializes a connection to Microsoft Graph
    using the provided integration credentials (Client ID, Secret/Certificate, and
    Tenant ID).

    2. **Parameter Extraction**: It retrieves the `User ID` from the action parameters.

    3. **API Request**: It executes a GET request to the Microsoft Graph endpoint:
    `https://graph.microsoft.com/v1.0/users/{user_id}/mailFolders/inbox/messageRules`.

    4. **Data Processing**: The action receives a collection of `messageRule` objects
    from the API.

    5. **Output**: The retrieved rules are attached to the action's result as a JSON
    object for further analysis in the SOAR platform.


    ### Additional Notes

    This action does not interact with or filter Google SecOps entities; it operates
    strictly based on the provided `User ID` parameter.
  capabilities:
    can_create_case_comments: false
    can_create_insight: false
    can_modify_alert_data: false
    can_mutate_external_data: false
    can_mutate_internal_data: false
    can_update_entities: false
    external_data_mutation_explanation: null
    fetches_data: true
    internal_data_mutation_explanation: null
  categories:
    enrichment: false
  entity_usage:
    entity_types: []
    filters_by_additional_properties: false
    filters_by_alert_identifier: false
    filters_by_case_identifier: false
    filters_by_creation_time: false
    filters_by_entity_type: false
    filters_by_identifier: false
    filters_by_is_artifact: false
    filters_by_is_enriched: false
    filters_by_is_internal: false
    filters_by_is_pivot: false
    filters_by_is_suspicious: false
    filters_by_is_vulnerable: false
    filters_by_modification_time: false
List Messages:
  ai_description: >-
    ### General Description

    This action lists email messages from a specific user's mailbox using the Microsoft
    Graph API. It allows security analysts to retrieve message metadata or specific
    content for investigation purposes. The action supports OData query parameters
    for advanced filtering and field selection to limit the returned data.


    ### Parameters Description

    | Parameter | Type | Mandatory | Description |

    | :--- | :--- | :--- | :--- |

    | **User ID** | String | Yes | The email address (userPrincipalName) or unique
    ID of the user whose mailbox is being queried. |

    | **Select Filter** | String | No | A comma-separated list of specific message
    properties to return (e.g., `subject,sender,receivedDateTime`). This helps reduce
    the payload size. |

    | **Query Parameters** | String | No | Advanced OData query parameters used to
    filter, sort, or search messages. For example, `$filter=subject eq 'Security Alert'`
    or `$top=10`. |


    ### Flow Description

    1.  **Authentication**: The action connects to Microsoft Graph using the integration's
    Client ID, Secret, and Tenant ID (or certificate).

    2.  **Parameter Extraction**: It retrieves the target `User ID`, any field selections
    (`Select Filter`), and OData filters (`Query Parameters`).

    3.  **Request Construction**: The `MicrosoftGraphSecurityManager` builds a GET
    request URL targeting the `/users/{user_id}/messages` endpoint, appending the
    encoded query and selection filters.

    4.  **Data Retrieval**: The action executes the GET request to the Microsoft Graph
    API.

    5.  **Output**: The retrieved list of messages is returned as a JSON object and
    stored in the action's result data for use in subsequent playbook steps.
  capabilities:
    can_create_case_comments: false
    can_create_insight: false
    can_modify_alert_data: false
    can_mutate_external_data: false
    can_mutate_internal_data: false
    can_update_entities: false
    external_data_mutation_explanation: null
    fetches_data: true
    internal_data_mutation_explanation: null
  categories:
    enrichment: true
  entity_usage:
    entity_types: []
    filters_by_additional_properties: false
    filters_by_alert_identifier: false
    filters_by_case_identifier: false
    filters_by_creation_time: false
    filters_by_entity_type: false
    filters_by_identifier: false
    filters_by_is_artifact: false
    filters_by_is_enriched: false
    filters_by_is_internal: false
    filters_by_is_pivot: false
    filters_by_is_suspicious: false
    filters_by_is_vulnerable: false
    filters_by_modification_time: false
Ping:
  ai_description: "### General Description\nThe **Ping** action is a utility designed\
    \ to verify the connectivity and authentication configuration between Google SecOps\
    \ and the Microsoft Graph Security API. It ensures that the provided credentials\
    \ (Client ID, Secret ID, or Certificate) are valid and that the environment can\
    \ successfully communicate with the Microsoft identity platform to obtain an access\
    \ token.\n\n### Parameters Description\nThis action does not require any action-specific\
    \ parameters. It relies entirely on the **Integration Configuration** parameters:\n\
    * **Client ID**: The Application ID from the Azure registration portal.\n* **Secret\
    \ ID**: The application secret created in the Azure portal.\n* **Tenant ID**:\
    \ The directory (tenant) ID from the Azure portal.\n* **Certificate Path**: (Optional)\
    \ Path to a certificate file if using certificate-based authentication.\n* **Certificate\
    \ Password**: (Optional) Password for the certificate file.\n\n### Additional\
    \ Notes\n* This action is typically used during the initial setup or troubleshooting\
    \ of the integration to confirm that the network path and API permissions are\
    \ correctly configured.\n* It does not process any entities or modify any data\
    \ within Microsoft Graph Security or Google SecOps.\n\n### Flow Description\n\
    1. **Initialization**: The script initializes the Siemplify Action context and\
    \ logs the start of the process.\n2. **Configuration Extraction**: It retrieves\
    \ the necessary authentication details (Client ID, Secret, Tenant ID, etc.) from\
    \ the integration's global configuration.\n3. **Manager Instantiation**: It attempts\
    \ to create an instance of the `MicrosoftGraphSecurityManager`.\n4. **Authentication\
    \ Check**: During instantiation, the manager automatically attempts to generate\
    \ an OAuth2 access token by sending a POST request to the Microsoft login endpoint\
    \ (`https://login.microsoftonline.com/{tenant}/oauth2/v2.0/token`).\n5. **Result\
    \ Reporting**: \n    * If the token is successfully retrieved, the action returns\
    \ a success status (`true`) and a \"Connection Established\" message.\n    * If\
    \ an exception occurs (e.g., invalid credentials, network timeout), the action\
    \ catches the error, logs it, and returns a failure status (`false`)."
  capabilities:
    can_create_case_comments: false
    can_create_insight: false
    can_modify_alert_data: false
    can_mutate_external_data: false
    can_mutate_internal_data: false
    can_update_entities: false
    external_data_mutation_explanation: null
    fetches_data: false
    internal_data_mutation_explanation: null
  categories:
    enrichment: false
  entity_usage:
    entity_types: []
    filters_by_additional_properties: false
    filters_by_alert_identifier: false
    filters_by_case_identifier: false
    filters_by_creation_time: false
    filters_by_entity_type: false
    filters_by_identifier: false
    filters_by_is_artifact: false
    filters_by_is_enriched: false
    filters_by_is_internal: false
    filters_by_is_pivot: false
    filters_by_is_suspicious: false
    filters_by_is_vulnerable: false
    filters_by_modification_time: false
