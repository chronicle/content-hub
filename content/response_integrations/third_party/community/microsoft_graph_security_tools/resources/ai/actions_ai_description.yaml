Delete Attachment:
  ai_description: >-
    ### General description

    Deletes a specific attachment from a user's mailbox using the Microsoft Graph
    API. This action is primarily used for security orchestration and remediation
    to remove malicious or unauthorized files from email messages after they have
    been identified. It targets a specific attachment within a specific message for
    a specific user.


    ### Parameters description

    | Name | Type | Mandatory | Description |

    | :--- | :--- | :--- | :--- |

    | **User ID** | String | Yes | The User Principal Name (email address) of the
    user whose mailbox contains the message. |

    | **Message ID** | String | Yes | The unique identifier of the email message containing
    the attachment. |

    | **Attachment ID** | String | Yes | The unique identifier of the attachment to
    be deleted. |


    ### Additional notes

    This action does not iterate over entities in the SOAR case. It relies on the
    explicit provision of User ID, Message ID, and Attachment ID through action parameters.
    The action assumes the integration has the necessary 'Mail.ReadWrite' or 'Mail.Send'
    permissions in Microsoft Graph.


    ### Flow description

    1. **Authentication**: The action initializes the Microsoft Graph Security Manager
    using the provided Client ID, Secret/Certificate, and Tenant ID to obtain an OAuth
    token.

    2. **Parameter Extraction**: It retrieves the target User ID, Message ID, and
    Attachment ID from the action's input parameters.

    3. **Deletion Request**: It sends an HTTP DELETE request to the Microsoft Graph
    endpoint: `/users/{user_id}/messages/{message_id}/attachments/{attachment_id}`.

    4. **Status Verification**: It evaluates the response from the API. An HTTP 204
    No Content status indicates a successful deletion, which is then reported back
    to the SOAR platform. Any other status code results in a failure notification.
  capabilities:
    can_create_case_comments: false
    can_create_case_wall_logs: false
    can_create_insight: false
    can_mutate_external_data: true
    can_mutate_internal_data: false
    can_update_entities: false
    external_data_mutation_explanation: >-
      Performs a DELETE request against the Microsoft Graph API to permanently remove
      an attachment from a user's mailbox.
    fetches_data: false
    internal_data_mutation_explanation: null
  categories:
    enrichment: false
  entity_usage:
    entity_scopes: []
    filters_by_additional_properties: false
    filters_by_alert_identifier: false
    filters_by_case_identifier: false
    filters_by_creation_time: false
    filters_by_entity_type: false
    filters_by_identifier: false
    filters_by_is_artifact: false
    filters_by_is_enriched: false
    filters_by_is_internal: false
    filters_by_is_pivot: false
    filters_by_is_suspicious: false
    filters_by_is_vulnerable: false
    filters_by_modification_time: false
Delete Message:
  ai_description: >-
    ### General Description

    The **Delete Message** action allows analysts to programmatically delete a specific
    email message from one or more Microsoft 365 user mailboxes using the Microsoft
    Graph API. This action is critical for remediation scenarios, such as removing
    phishing emails or sensitive data that was inadvertently sent to internal users.


    ### Parameters Description

    | Parameter | Description | Type | Mandatory |

    | :--- | :--- | :--- | :--- |

    | **Message ID** | The unique identifier of the message to be deleted from the
    mailbox. | String | Yes |

    | **User ID** | The userPrincipalName (email address) of the user whose mailbox
    contains the message. This parameter supports a comma-separated list (CSV) to
    delete the same message ID from multiple mailboxes simultaneously. | String |
    Yes |


    ### Flow Description

    1.  **Authentication**: The action retrieves credentials (Client ID, Secret/Certificate)
    from the integration configuration and authenticates with Microsoft Graph.

    2.  **Input Parsing**: The action extracts the `Message ID` and the `User ID`
    (which may be a single email or a CSV list) from the user input.

    3.  **API Execution**: The script iterates through each provided User ID and sends
    a `DELETE` request to the Microsoft Graph API endpoint: `https://graph.microsoft.com/v1.0/users/{user_id}/messages/{message_id}`.

    4.  **Result Handling**: The action captures the HTTP response status. An HTTP
    204 status code indicates a successful deletion. The final result is logged and
    reported back to the Google SecOps case wall.
  capabilities:
    can_create_case_comments: false
    can_create_case_wall_logs: false
    can_create_insight: false
    can_mutate_external_data: true
    can_mutate_internal_data: false
    can_update_entities: false
    external_data_mutation_explanation: >-
      The action permanently deletes email messages from specified user mailboxes
      in Microsoft 365 via the Microsoft Graph API.
    fetches_data: false
    internal_data_mutation_explanation: null
  categories:
    enrichment: false
  entity_usage:
    entity_scopes: []
    filters_by_additional_properties: false
    filters_by_alert_identifier: false
    filters_by_case_identifier: false
    filters_by_creation_time: false
    filters_by_entity_type: false
    filters_by_identifier: false
    filters_by_is_artifact: false
    filters_by_is_enriched: false
    filters_by_is_internal: false
    filters_by_is_pivot: false
    filters_by_is_suspicious: false
    filters_by_is_vulnerable: false
    filters_by_modification_time: false
Get Message:
  ai_description: >-
    ### General Description

    Retrieves a specific email message from a user's Microsoft 365 inbox using the
    Microsoft Graph API. This action allows analysts to fetch the full details of
    an email to support forensic investigation and incident response. It requires
    the user's email address and the unique message identifier as inputs.


    ### Parameters Description


    | Parameter | Type | Mandatory | Description |

    | :--- | :--- | :--- | :--- |

    | User ID | string | Yes | The user's UPN (User Principal Name) or email address
    whose inbox contains the message. |

    | Message ID | string | Yes | The unique identifier (ID) of the message to retrieve
    from the Microsoft Graph service. |


    ### Flow Description

    1. **Authentication**: The action establishes a connection to the Microsoft Graph
    API using the integration's Client ID, Secret (or Certificate), and Tenant ID.

    2. **Data Retrieval**: It performs a GET request to the `/users/{id}/messages/{id}`
    endpoint to fetch the full message object.

    3. **Output**: The retrieved message details are added to the action's result
    as a JSON object, and the execution is marked as successful if the message is
    found.


    ### Additional Notes

    This is a read-only action; it does not delete, move, or modify the email in the
    user's mailbox.
  capabilities:
    can_create_case_comments: false
    can_create_case_wall_logs: false
    can_create_insight: false
    can_mutate_external_data: false
    can_mutate_internal_data: false
    can_update_entities: false
    external_data_mutation_explanation: null
    fetches_data: true
    internal_data_mutation_explanation: null
  categories:
    enrichment: true
  entity_usage:
    entity_scopes: []
    filters_by_additional_properties: false
    filters_by_alert_identifier: false
    filters_by_case_identifier: false
    filters_by_creation_time: false
    filters_by_entity_type: false
    filters_by_identifier: false
    filters_by_is_artifact: false
    filters_by_is_enriched: false
    filters_by_is_internal: false
    filters_by_is_pivot: false
    filters_by_is_suspicious: false
    filters_by_is_vulnerable: false
    filters_by_modification_time: false
Get User MFA:
  ai_description: "### General Description\nRetrieves Multi-Factor Authentication\
    \ (MFA) statistics and registration details for users from Microsoft Graph. This\
    \ action targets a specific user provided via a parameter and enriches the case\
    \ by processing any email-related entities found within the alert context. It\
    \ identifies whether a user is registered for MFA, if it is enabled, and which\
    \ authentication methods are currently configured. \n\n### Parameters Description\n\
    | Parameter | Type | Mandatory | Description |\n| :--- | :--- | :--- | :--- |\n\
    | User Email | string | Yes | The User Principal Name (UPN) or email address of\
    \ the primary user to search for MFA statistics. |\n| Create Insight | boolean\
    \ | No | If enabled, the action will generate a detailed case insight for the\
    \ user specified in the parameters and for each valid email entity found in the\
    \ case context. |\n\n### Additional Notes\n- The action specifically looks for\
    \ entities whose identifiers contain an '@' symbol to identify potential user\
    \ accounts/emails.\n- The JSON result at index zero will always contain the data\
    \ for the user provided in the 'User Email' parameter.\n\n### Flow Description\n\
    1. **Initialization**: Connects to Microsoft Graph using the provided Client ID,\
    \ Secret, and Tenant ID.\n2. **Parameter-based Lookup**: Fetches MFA statistics\
    \ for the email address provided in the 'User Email' parameter.\n3. **Insight\
    \ Generation (Parameter)**: If 'Create Insight' is enabled, generates a case insight\
    \ for the primary user.\n4. **Entity Discovery**: Iterates through all entities\
    \ in the current scope, filtering for those whose identifiers contain an '@' character.\n\
    5. **Entity Enrichment**: For each matching entity, fetches its specific MFA registration\
    \ details from Microsoft Graph.\n6. **Insight Generation (Entities)**: If 'Create\
    \ Insight' is enabled, generates individual case insights for each processed entity.\n\
    7. **Result Completion**: Aggregates all retrieved MFA data into a JSON result\
    \ and completes the action."
  capabilities:
    can_create_case_comments: false
    can_create_case_wall_logs: false
    can_create_insight: true
    can_mutate_external_data: false
    can_mutate_internal_data: true
    can_update_entities: false
    external_data_mutation_explanation: null
    fetches_data: true
    internal_data_mutation_explanation: >-
      Creates case insights containing user MFA registration status, enablement status,
      and authentication methods.
  categories:
    enrichment: true
  entity_usage:
    entity_scopes:
    - USERUNIQNAME
    filters_by_additional_properties: false
    filters_by_alert_identifier: false
    filters_by_case_identifier: false
    filters_by_creation_time: false
    filters_by_entity_type: false
    filters_by_identifier: true
    filters_by_is_artifact: false
    filters_by_is_enriched: false
    filters_by_is_internal: false
    filters_by_is_pivot: false
    filters_by_is_suspicious: false
    filters_by_is_vulnerable: false
    filters_by_modification_time: false
List Attachments:
  ai_description: >-
    ### General Description

    The **List Attachments** action retrieves a list of attachment objects associated
    with a specific email message in a user's Microsoft 365 mailbox. It leverages
    the Microsoft Graph API to fetch metadata for all files, items, or reference attachments
    linked to the provided message ID, providing visibility into the contents of an
    email for investigation or forensic purposes.


    ### Parameters Description

    | Parameter | Type | Mandatory | Description |

    | :--- | :--- | :--- | :--- |

    | **User ID** | string | Yes | The user principal name (email) or unique ID of
    the user whose mailbox is being accessed. |

    | **Message ID** | string | No | The unique identifier of the message from which
    to retrieve the list of attachments. Note: Although marked as non-mandatory in
    configuration, the action logic requires this to build the request URL. |


    ### Flow Description

    1. **Authentication**: The action authenticates with Microsoft Graph using the
    configured Client ID, Secret/Certificate, and Tenant ID.

    2. **Parameter Extraction**: It retrieves the User ID and Message ID provided
    by the user.

    3. **API Request**: The action makes a GET request to the Microsoft Graph endpoint:
    `https://graph.microsoft.com/v1.0/users/{user_id}/messages/{message_id}/attachments`.

    4. **Data Output**: The resulting list of attachment objects (including properties
    like name, size, and content type) is stored as a JSON result within the action
    execution context.


    ### Additional Notes

    This action is a read-only operation and does not download the file content itself,
    only the metadata of the attachments. It does not operate on SOAR entities automatically;
    inputs must be provided manually or mapped from previous playbook steps.
  capabilities:
    can_create_case_comments: false
    can_create_case_wall_logs: false
    can_create_insight: false
    can_mutate_external_data: false
    can_mutate_internal_data: false
    can_update_entities: false
    external_data_mutation_explanation: null
    fetches_data: true
    internal_data_mutation_explanation: null
  categories:
    enrichment: true
  entity_usage:
    entity_scopes: []
    filters_by_additional_properties: false
    filters_by_alert_identifier: false
    filters_by_case_identifier: false
    filters_by_creation_time: false
    filters_by_entity_type: false
    filters_by_identifier: false
    filters_by_is_artifact: false
    filters_by_is_enriched: false
    filters_by_is_internal: false
    filters_by_is_pivot: false
    filters_by_is_suspicious: false
    filters_by_is_vulnerable: false
    filters_by_modification_time: false
List Mail Rules:
  ai_description: >-
    ### General Description

    This action retrieves all message rule objects defined for a specific user's Inbox
    in Microsoft 365 using the Microsoft Graph API. It is primarily used for investigative
    purposes to identify suspicious email forwarding, deletion, or movement rules
    that might indicate a compromised account.


    ### Parameters Description

    | Parameter Name | Type | Mandatory | Description |

    | :--- | :--- | :--- | :--- |

    | User ID | string | Yes | The User ID or userPrincipalName (usually the email
    address) of the user whose inbox rules you want to retrieve. Example: `john.smith@mail.com`.
    |


    ### Flow Description

    1. **Initialization**: The action extracts the necessary credentials (Client ID,
    Secret/Certificate, Tenant ID) from the integration configuration and the target
    `User ID` from the action parameters.

    2. **Authentication**: It establishes a connection to the Microsoft Graph API
    via the `MicrosoftGraphSecurityManager` using either client secrets or certificates.

    3. **Data Retrieval**: It executes a GET request to the Graph endpoint `/v1.0/users/{user_email}/mailFolders/inbox/messageRules`
    to fetch the rules associated with the user's inbox.

    4. **Output**: The retrieved list of rules is returned as a JSON object, and the
    action state is marked as completed.


    ### Additional Notes

    This action does not run on entities automatically. It requires a specific User
    ID/Email to be provided as an input parameter.
  capabilities:
    can_create_case_comments: false
    can_create_case_wall_logs: false
    can_create_insight: false
    can_mutate_external_data: false
    can_mutate_internal_data: false
    can_update_entities: false
    external_data_mutation_explanation: null
    fetches_data: true
    internal_data_mutation_explanation: null
  categories:
    enrichment: true
  entity_usage:
    entity_scopes: []
    filters_by_additional_properties: false
    filters_by_alert_identifier: false
    filters_by_case_identifier: false
    filters_by_creation_time: false
    filters_by_entity_type: false
    filters_by_identifier: false
    filters_by_is_artifact: false
    filters_by_is_enriched: false
    filters_by_is_internal: false
    filters_by_is_pivot: false
    filters_by_is_suspicious: false
    filters_by_is_vulnerable: false
    filters_by_modification_time: false
List Messages:
  ai_description: >-
    ### General Description

    The **List Messages** action retrieves a list of email messages from a specific
    user's mailbox using the Microsoft Graph API. It is primarily used for investigative
    purposes to audit mailbox content, search for specific subjects, or identify communications
    involving a particular user. The action allows for fine-grained control over the
    returned data through field selection and OData query filtering.


    ### Parameters Description

    | Parameter | Type | Mandatory | Description |

    | :--- | :--- | :--- | :--- |

    | **User ID** | String | Yes | The User Principal Name (UPN) or email address
    of the mailbox to query (e.g., `john.smith@mail.com`). |

    | **Select Filter** | String | No | A comma-separated list of specific message
    fields to return (e.g., `sender,subject,receivedDateTime`). This reduces the payload
    size. |

    | **Query Parameters** | String | No | Standard OData query parameters to filter
    or sort results. Must begin with '$'. (e.g., `$filter=subject eq 'test'`). |


    ### Additional Notes

    - This action interacts with the `/users/{id}/messages` endpoint of the Microsoft
    Graph API.

    - The action supports both Client Secret and Certificate-based authentication
    as configured in the integration settings.

    - It does not process entities automatically; it relies solely on the provided
    action parameters.


    ### Flow Description

    1. **Authentication:** The action initializes the `MicrosoftGraphSecurityManager`
    and generates an OAuth2 access token using the provided Integration credentials
    (Client ID, Tenant ID, and Secret/Certificate).

    2. **Parameter Extraction:** Retrieves the target `User ID`, optional `Select
    Filter`, and optional `Query Parameters` from the action input.

    3. **Query Construction:** Builds the API request URL, appending the `$select`
    parameter and any additional OData query strings, ensuring proper URL encoding.

    4. **Data Retrieval:** Executes an HTTP GET request to Microsoft Graph.

    5. **Result Processing:** Validates the response and adds the resulting list of
    message objects as a JSON result to the action output.
  capabilities:
    can_create_case_comments: false
    can_create_case_wall_logs: false
    can_create_insight: false
    can_mutate_external_data: false
    can_mutate_internal_data: false
    can_update_entities: false
    external_data_mutation_explanation: null
    fetches_data: true
    internal_data_mutation_explanation: null
  categories:
    enrichment: true
  entity_usage:
    entity_scopes: []
    filters_by_additional_properties: false
    filters_by_alert_identifier: false
    filters_by_case_identifier: false
    filters_by_creation_time: false
    filters_by_entity_type: false
    filters_by_identifier: false
    filters_by_is_artifact: false
    filters_by_is_enriched: false
    filters_by_is_internal: false
    filters_by_is_pivot: false
    filters_by_is_suspicious: false
    filters_by_is_vulnerable: false
    filters_by_modification_time: false
Ping:
  ai_description: >-
    ### General Description


    The **Ping** action is a diagnostic utility designed to verify the connectivity
    between Google SecOps and the Microsoft Graph Security API. Its primary purpose
    is to ensure that the integration configuration (Client ID, Secret ID, Tenant
    ID, and certificates) is correct and that the SOAR platform can successfully authenticate
    with the Microsoft environment.


    ### Parameters Description


    There are no action-specific parameters for this action. It utilizes the global
    integration settings to perform the connectivity test.


    ### Flow Description


    1.  **Credential Retrieval**: The action extracts the necessary authentication
    credentials from the integration configuration, including Client ID, Secret ID,
    Tenant ID, and certificate details if provided.

    2.  **Manager Initialization**: It instantiates the `MicrosoftGraphSecurityManager`,
    which automatically attempts to authenticate.

    3.  **Authentication Request**: The manager sends a POST request to the Microsoft
    identity platform (`login.microsoftonline.com`) to request an OAuth access token
    using either the client secret or the certificate-based JWT assertion.

    4.  **Validation**: If the token is received successfully, the connection is validated
    as established.

    5.  **Output**: The action returns a boolean result (`true` for success, `false`
    for failure) and logs the outcome in the execution status.


    ### Additional Notes


    *   This action does not process or interact with any entities (IPs, Hosts, etc.).

    *   It does not retrieve or modify any security data; it only tests the API handshake.
  capabilities:
    can_create_case_comments: false
    can_create_case_wall_logs: false
    can_create_insight: false
    can_mutate_external_data: false
    can_mutate_internal_data: false
    can_update_entities: false
    external_data_mutation_explanation: null
    fetches_data: false
    internal_data_mutation_explanation: null
  categories:
    enrichment: false
  entity_usage:
    entity_scopes: []
    filters_by_additional_properties: false
    filters_by_alert_identifier: false
    filters_by_case_identifier: false
    filters_by_creation_time: false
    filters_by_entity_type: false
    filters_by_identifier: false
    filters_by_is_artifact: false
    filters_by_is_enriched: false
    filters_by_is_internal: false
    filters_by_is_pivot: false
    filters_by_is_suspicious: false
    filters_by_is_vulnerable: false
    filters_by_modification_time: false
