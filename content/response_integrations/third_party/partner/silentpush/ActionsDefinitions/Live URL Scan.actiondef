{"Name":"Live URL Scan","Description":"This command scan a URL to retrieve hosting metadata.","Script":"from SiemplifyAction import SiemplifyAction\nfrom SiemplifyUtils import unix_now, convert_unixtime_to_datetime, output_handler\nfrom ScriptResult import EXECUTION_STATE_COMPLETED, EXECUTION_STATE_FAILED,EXECUTION_STATE_TIMEDOUT\n\nfrom constants import (INTEGRATION_NAME, LIVE_URL_SCAN_SCRIPT_NAME )\nfrom SilentPushManager import SilentPushManager\n\nfrom typing import Dict, Tuple, Any\n\n@output_handler\ndef main():\n    siemplify = SiemplifyAction()\n\n    siemplify.script_name = LIVE_URL_SCAN_SCRIPT_NAME \n\n    # Extract Integration config\n    server_url = siemplify.extract_configuration_param(INTEGRATION_NAME, \"Silent Push Server\")\n    api_key = siemplify.extract_configuration_param(INTEGRATION_NAME, \"API Key\")\n\n    url = siemplify.extract_action_param(\"url\", print_value=True)\n    platform: str = siemplify.extract_action_param(\"platform\", print_value=True)\n    browser: str = siemplify.extract_action_param(\"browser\", print_value=True)\n    os: str = siemplify.extract_action_param(\"os\", print_value=True)\n    region: str = siemplify.extract_action_param(\"region\", print_value=True)\n\n    try:\n        # Validate platform, os, browser, and region\n        validation_errors = validate_parameters(platform, os, browser, region)\n        if validation_errors:\n            raise ValueError(validation_errors)\n\n        sp_manager = SilentPushManager(server_url, api_key, logger=siemplify.LOGGER)\n        raw_response = sp_manager.live_url_scan(url, platform, os, browser, region)\n        scan_results = raw_response.get(\"response\", {}).get(\"scan\", {})\n        \n        readable_output = format_scan_results(scan_results, url)\n        siemplify.result.add_result_json({\n            \"message\": readable_output.get(\"message\"),\n            \"url\": readable_output.get(\"url\"),\n            \"scan_results\": readable_output.get(\"scan_results\")\n        })\n        if not scan_results:\n            error_message = f\"No Scan data found for URL {url}.\"\n            siemplify.LOGGER.error(error_message)\n            status = EXECUTION_STATE_FAILED\n            siemplify.end(error_message, \"false\", status)\n        \n        output_message = f\"url: {url}, scan_results: {scan_results}\"\n        status = EXECUTION_STATE_COMPLETED\n        result_value = True\n    except Exception as error:\n        result_value = False\n        status = EXECUTION_STATE_FAILED\n        output_message = f\"Failed to retrieve scan data found for URL {url} for {INTEGRATION_NAME} server! Error: {error}\"\n        siemplify.LOGGER.error(output_message)\n        siemplify.LOGGER.exception(error)\n\n    for entity in siemplify.target_entities:\n        print(entity.identifier)\n\n\n    siemplify.LOGGER.info(\"\\n  status: {}\\n  result_value: {}\\n  output_message: {}\".format(status,result_value, output_message))\n    siemplify.end(output_message, result_value, status)\n\ndef validate_parameters(platform: str, os: str, browser: str, region: str) -> str:\n    \"\"\"Validate the platform, os, browser, and region values.\"\"\"\n    valid_platforms = [\"Desktop\", \"Mobile\", \"Crawler\"]\n    valid_os = [\"Windows\", \"Linux\", \"MacOS\", \"iOS\", \"Android\"]\n    valid_browsers = [\"Firefox\", \"Chrome\", \"Edge\", \"Safari\"]\n    valid_regions = [\"US\", \"EU\", \"AS\", \"TOR\"]\n\n    errors = []\n    if platform and platform not in valid_platforms:\n        errors.append(f\"Invalid platform. Must be one of: {', '.join(valid_platforms)}\")\n    if os and os not in valid_os:\n        errors.append(f\"Invalid OS. Must be one of: {', '.join(valid_os)}\")\n    if browser and browser not in valid_browsers:\n        errors.append(f\"Invalid browser. Must be one of: {', '.join(valid_browsers)}\")\n    if region and region not in valid_regions:\n        errors.append(f\"Invalid region. Must be one of: {', '.join(valid_regions)}\")\n\n    return \"\\n\".join(errors)\n\ndef format_scan_results(scan_results: Dict[str, Any], url: str) -> Dict[str, Any]:\n    \"\"\"\n    Format the scan results for Google SecOps integration.\n    \n    Args:\n        scan_results (dict): API response data from a URL scan\n        url (str): The scanned URL\n\n    Returns:\n        dict: JSON object with human-readable message and raw results\n    \"\"\"\n    if not isinstance(scan_results, dict):\n        return {\n            \"message\": f\"Unexpected response format for URL scan. Response: {scan_results}\",\n            \"raw_results\": scan_results,\n            \"url\": url\n        }\n\n    if not scan_results:\n        return {\n            \"message\": f\"No scan results found for URL: {url}\",\n            \"raw_results\": scan_results,\n            \"url\": url\n        }\n\n    # Instead of tableToMarkdown, just return results as JSON\n    return {\n        \"message\": f\"URL Scan Results for {url}\",\n        \"scan_results\": scan_results,\n        \"url\": url\n    }\n\nif __name__ == \"__main__\":\n    main()\n","IntegrationIdentifier":"Silent Push","ScriptResultName":"ScriptResult","DynamicResultsMetadata":[{"ResultName":"JsonResult","ResultExample":"{}","ShowResult":false}],"Creator":"dc26f847-d850-429c-bc2c-59631a988301","IsEnabled":true,"IsCustom":true,"IsSystem":false,"Version":6.0,"TimeoutSeconds":600,"IsAsync":false,"AsyncPollingIntervalInSeconds":3600,"TotalIntervalTimeoutForAsyncInSeconds":86400,"Parameters":[{"CustomActionId":0,"IsMandatory":true,"DefaultValue":"https://silentpush.com","Description":"URL to scan.","Name":"url","Value":"https://silentpush.com","Type":0,"OptionalValues":null,"OptionalValuesJson":null},{"CustomActionId":0,"IsMandatory":false,"DefaultValue":null,"Description":"Platform to scan the URL on.","Name":"platform","Value":null,"Type":0,"OptionalValues":null,"OptionalValuesJson":null},{"CustomActionId":0,"IsMandatory":false,"DefaultValue":null,"Description":"Operating system to scan the URL on.","Name":"os","Value":null,"Type":0,"OptionalValues":null,"OptionalValuesJson":null},{"CustomActionId":0,"IsMandatory":false,"DefaultValue":null,"Description":"Browser to scan the URL on.","Name":"browser","Value":null,"Type":0,"OptionalValues":null,"OptionalValuesJson":null},{"CustomActionId":0,"IsMandatory":false,"DefaultValue":null,"Description":"Region to scan the URL in","Name":"region","Value":null,"Type":0,"OptionalValues":null,"OptionalValuesJson":null}],"DefaultResultValue":"","PythonVersion":"None","SimulationData":{"Entities":null},"SimulationDataJson":null}