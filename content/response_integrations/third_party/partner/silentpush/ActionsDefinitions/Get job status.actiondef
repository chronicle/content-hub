{"Name":"Get job status","Description":"This action retrieves the status of a running job or results from a completed job.","Script":"from SiemplifyAction import SiemplifyAction\nfrom SiemplifyUtils import unix_now, convert_unixtime_to_datetime, output_handler\nfrom ScriptResult import EXECUTION_STATE_COMPLETED, EXECUTION_STATE_FAILED,EXECUTION_STATE_TIMEDOUT\n\nfrom constants import (INTEGRATION_NAME, GET_JOB_STATUS_SCRIPT_NAME )\nfrom SilentPushManager import SilentPushManager\n\n@output_handler\ndef main():\n    siemplify = SiemplifyAction()\n    siemplify.script_name = GET_JOB_STATUS_SCRIPT_NAME \n    \n    # Extract Integration config\n    server_url = siemplify.extract_configuration_param(INTEGRATION_NAME, \"Silent Push Server\")\n    api_key = siemplify.extract_configuration_param(INTEGRATION_NAME, \"API Key\")\n    \n    #Extract action parameter\n    job_id = siemplify.extract_action_param(\"job_id\", print_value=True)\n    max_wait = siemplify.extract_action_param(\"max_wait\", print_value=True)\n    status_only = siemplify.extract_action_param(\"status_only\", print_value=True)\n    force_metadata_on = siemplify.extract_action_param(\"force_metadata_on\", print_value=True)\n    force_metadata_off = siemplify.extract_action_param(\"force_metadata_off\", print_value=True)\n\n    if max_wait:\n        max_wait = int(siemplify.extract_action_param(\"max_wait\", print_value=True))\n\n    params = {\n        \"max_wait\": max_wait or 20,\n        \"status_only\": status_only,\n        \"force_metadata_on\": force_metadata_on,\n        \"force_metadata_off\": force_metadata_off\n    }\n    status = EXECUTION_STATE_COMPLETED  # used to flag back to siemplify system, the action final status\n    output_message = \"output message :\"  # human readable message, showed in UI as the action result\n    result_value = None  # Set a simple result value, used for playbook if\\else and placeholders.\n\n    try:\n        sp_manager = SilentPushManager(server_url, api_key, logger=siemplify.LOGGER)\n        raw_response = sp_manager.get_job_status(job_id, params)\n        job_status = raw_response.get(\"response\", {})\n\n        if not job_status:\n            error_message = \"No job status found for Job ID: {job_id}\"\n            siemplify.LOGGER.error(error_message)\n            status = EXECUTION_STATE_FAILED\n            siemplify.end(error_message, \"false\", status)\n\n        output_message = f\"{job_status}\"\n        status = EXECUTION_STATE_COMPLETED\n        result_value = True\n    except Exception as error:\n        result_value = False\n        status = EXECUTION_STATE_FAILED\n        output_message = f\"Failed to retrieve to the job status of job ID :{job_id} for {INTEGRATION_NAME} server! Error: {error}\"\n        siemplify.LOGGER.error(output_message)\n        siemplify.LOGGER.exception(error)\n\n    for entity in siemplify.target_entities:\n        print(entity.identifier)\n\n    siemplify.LOGGER.info(\"\\n  status: {}\\n  result_value: {}\\n  output_message: {}\".format(status,result_value, output_message))\n    siemplify.end(output_message, result_value, status)\n\n\nif __name__ == \"__main__\":\n    main()\n","IntegrationIdentifier":"Silent Push","ScriptResultName":"ScriptResult","DynamicResultsMetadata":[{"ResultName":"JsonResult","ResultExample":"{}","ShowResult":false}],"Creator":"dc26f847-d850-429c-bc2c-59631a988301","IsEnabled":true,"IsCustom":true,"IsSystem":false,"Version":17.0,"TimeoutSeconds":600,"IsAsync":false,"AsyncPollingIntervalInSeconds":3600,"TotalIntervalTimeoutForAsyncInSeconds":86400,"Parameters":[{"CustomActionId":0,"IsMandatory":true,"DefaultValue":"d4067541-eafb-424c-98d3-de12d7a91331","Description":"ID of the job returned by Silent Push actions.","Name":"job_id","Value":"d4067541-eafb-424c-98d3-de12d7a91331","Type":0,"OptionalValues":null,"OptionalValuesJson":null},{"CustomActionId":0,"IsMandatory":false,"DefaultValue":null,"Description":"Number of seconds to wait for results (0-25 seconds).","Name":"max_wait","Value":null,"Type":0,"OptionalValues":null,"OptionalValuesJson":null},{"CustomActionId":0,"IsMandatory":false,"DefaultValue":"false","Description":"Return job status, even if job is complete.","Name":"status_only","Value":"false","Type":1,"OptionalValues":null,"OptionalValuesJson":null},{"CustomActionId":0,"IsMandatory":false,"DefaultValue":"false","Description":"Always return query metadata, even if original request did not include metadata.","Name":"force_metadata_on","Value":"false","Type":1,"OptionalValues":null,"OptionalValuesJson":null},{"CustomActionId":0,"IsMandatory":false,"DefaultValue":"false","Description":"Never return query metadata, even if original request did include metadata.","Name":"force_metadata_off","Value":"false","Type":1,"OptionalValues":null,"OptionalValuesJson":null}],"DefaultResultValue":"","PythonVersion":"None","SimulationData":{"Entities":null},"SimulationDataJson":null}