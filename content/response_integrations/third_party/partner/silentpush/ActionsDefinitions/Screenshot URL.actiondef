{"Name":"Screenshot URL","Description":"This commandGenerate screenshot of a URL.","Script":"from SiemplifyAction import SiemplifyAction\nfrom SiemplifyUtils import unix_now, convert_unixtime_to_datetime, output_handler\nfrom ScriptResult import EXECUTION_STATE_COMPLETED, EXECUTION_STATE_FAILED,EXECUTION_STATE_TIMEDOUT\nfrom urllib.parse import urlencode, urlparse\nfrom constants import (INTEGRATION_NAME, SCREENSHOT_URL_SCRIPT_NAME )\nfrom SilentPushManager import SilentPushManager\nimport requests\n\n@output_handler\ndef main():\n    siemplify = SiemplifyAction()\n\n    siemplify.script_name = SCREENSHOT_URL_SCRIPT_NAME \n\n    # Extract Integration config\n    server_url = siemplify.extract_configuration_param(INTEGRATION_NAME, \"Silent Push Server\")\n    api_key = siemplify.extract_configuration_param(INTEGRATION_NAME, \"API Key\")\n\n    url = siemplify.extract_action_param(\"url\", print_value=True)\n    \n    try:\n        sp_manager = SilentPushManager(server_url, api_key, logger=siemplify.LOGGER)\n        result = sp_manager.screenshot_url(url)\n        siemplify.LOGGER.info(result)\n        if result.get(\"error\"):\n            raise ValueError(result.get(\"error\"))\n\n        if not result.get(\"screenshot_url\"):\n            raise ValueError(\"screenshot_url is missing from API response.\")\n\n        screenshot_url = result[\"screenshot_url\"]\n        parsed_url = urlparse(screenshot_url)\n\n        if not parsed_url.scheme or not parsed_url.netloc:\n            raise ValueError(f\"Invalid screenshot URL format: {screenshot_url}\")\n\n        server_url = f\"{parsed_url.scheme}://{parsed_url.netloc}\"\n        url_suffix = parsed_url.path\n        if parsed_url.query:\n            url_suffix += f\"?{parsed_url.query}\"\n\n        full_url = server_url + url_suffix\n        image_response = requests.get(full_url,  stream=True)\n        \n        if not image_response or image_response.status_code != 200:\n            error_message = f\"Failed to download screenshot image: HTTP {getattr(image_response, 'status_code', 'No response')}\"\n            siemplify.LOGGER.error(error_message)\n            status = EXECUTION_STATE_FAILED\n            siemplify.end(error_message, \"false\", status)\n        \n        output_message = f\"screenshot_url : {result.get('screenshot_url')}\"\n        status = EXECUTION_STATE_COMPLETED\n        result_value = True\n        siemplify.result.add_result_json({\"url\": url, \"screenshot_url\":result.get('screenshot_url')})\n    except Exception as error:\n        result_value = False\n        status = EXECUTION_STATE_FAILED\n        output_message = f\"Failed to retrieve data  for {INTEGRATION_NAME} server! Error: {error}\"\n        siemplify.LOGGER.error(output_message)\n        siemplify.LOGGER.exception(error)\n\n    for entity in siemplify.target_entities:\n        print(entity.identifier)\n\n    siemplify.LOGGER.info(\"\\n  status: {}\\n  result_value: {}\\n  output_message: {}\".format(status,result_value, output_message))\n    siemplify.end(output_message, result_value, status)\n\n\nif __name__ == \"__main__\":\n    main()\n","IntegrationIdentifier":"Silent Push","ScriptResultName":"ScriptResult","DynamicResultsMetadata":[{"ResultName":"JsonResult","ResultExample":"{}","ShowResult":false}],"Creator":"dc26f847-d850-429c-bc2c-59631a988301","IsEnabled":true,"IsCustom":true,"IsSystem":false,"Version":5.0,"TimeoutSeconds":600,"IsAsync":false,"AsyncPollingIntervalInSeconds":3600,"TotalIntervalTimeoutForAsyncInSeconds":86400,"Parameters":[{"CustomActionId":0,"IsMandatory":true,"DefaultValue":"https://www.virustotal.com/gui/domain/tbibank-bg.com","Description":" URL for the screenshot.","Name":"url","Value":"https://www.virustotal.com/gui/domain/tbibank-bg.com","Type":0,"OptionalValues":null,"OptionalValuesJson":null}],"DefaultResultValue":"","PythonVersion":"None","SimulationData":{"Entities":null},"SimulationDataJson":null}