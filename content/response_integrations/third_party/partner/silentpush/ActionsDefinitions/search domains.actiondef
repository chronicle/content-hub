{"Name":"search domains","Description":"This command searches for domains with optional filters.","Script":"from SiemplifyAction import SiemplifyAction\nfrom SiemplifyUtils import unix_now, convert_unixtime_to_datetime, output_handler\nfrom ScriptResult import EXECUTION_STATE_COMPLETED, EXECUTION_STATE_FAILED,EXECUTION_STATE_TIMEDOUT\n\nfrom constants import (INTEGRATION_NAME, SEARCH_DOMAIN_SCRIPT_NAME )\nfrom SilentPushManager import SilentPushManager\n\n@output_handler\ndef main():\n    siemplify = SiemplifyAction()\n    siemplify.script_name = SEARCH_DOMAIN_SCRIPT_NAME \n    \n    # Extract Integration config\n    server_url = siemplify.extract_configuration_param(INTEGRATION_NAME, \"Silent Push Server\")\n    api_key = siemplify.extract_configuration_param(INTEGRATION_NAME, \"API Key\")\n    \n    #Extract action parameter\n    query = siemplify.extract_action_param(\"domain\", print_value=True)\n    limit = siemplify.extract_action_param(\"limit\", print_value=True)\n    skip = siemplify.extract_action_param(\"skip\", print_value=True)\n    start_date = siemplify.extract_action_param(\"start_date\", print_value=True)\n    end_date = siemplify.extract_action_param(\"end_date\", print_value=True)\n    risk_score_min = siemplify.extract_action_param(\"risk_score_min\", print_value=True)\n    risk_score_max = siemplify.extract_action_param(\"risk_score_max\", print_value=True)\n    domain_regex = siemplify.extract_action_param(\"domain_regex\", print_value=True)\n    name_server = siemplify.extract_action_param(\"name_server\", print_value=True)\n    asnum = siemplify.extract_action_param(\"asnum\", print_value=True)\n    asname = siemplify.extract_action_param(\"asname\", print_value=True)\n    min_ip_diversity = siemplify.extract_action_param(\"min_ip_diversity\", print_value=True)\n    registrar = siemplify.extract_action_param(\"registrar\", print_value=True)\n    min_asn_diversity = siemplify.extract_action_param(\"min_asn_diversity\", print_value=True)\n    certificate_issuer = siemplify.extract_action_param(\"certificate_issuer\", print_value=True)\n    whois_date_after = siemplify.extract_action_param(\"whois_date_after\", print_value=True)\n\n    try:\n        sp_manager = SilentPushManager(server_url, api_key, logger=siemplify.LOGGER)\n\n        siemplify.LOGGER.info(f\"Connecting to {INTEGRATION_NAME}...\\n\")\n        raw_response = sp_manager.search_domains(query=query,\n        start_date=start_date,\n        end_date=end_date,\n        risk_score_min=risk_score_min,\n        risk_score_max=risk_score_max,\n        limit=limit,\n        domain_regex=domain_regex,\n        name_server=name_server,\n        asnum=asnum,\n        asname=asname,\n        min_ip_diversity=min_ip_diversity,\n        registrar=registrar,\n        min_asn_diversity=min_asn_diversity,\n        certificate_issuer=certificate_issuer,\n        whois_date_after=whois_date_after,\n        skip=skip)\n\n        records = raw_response.get(\"response\", {}).get(\"records\", [])\n        if not records:\n            output_message = f\"No domains found for query :{query}\" \n        else:\n            output_message = f\"result : {records}\"\n        status = EXECUTION_STATE_COMPLETED\n        result_value = True\n    except Exception as error:\n        result_value = False\n        status = EXECUTION_STATE_FAILED\n        output_message = f\"Failed to retrieve to the search-domain records for {INTEGRATION_NAME} server! Error: {error}\"\n        siemplify.LOGGER.error(output_message)\n        siemplify.LOGGER.exception(error)\n\n    for entity in siemplify.target_entities:\n        print(entity.identifier)\n\n\n\n    siemplify.LOGGER.info(\"\\n  status: {}\\n  result_value: {}\\n  output_message: {}\".format(status,result_value, output_message))\n    siemplify.end(output_message, result_value, status)\n\n\nif __name__ == \"__main__\":\n    main()\n","IntegrationIdentifier":"Silent Push","ScriptResultName":"ScriptResult","DynamicResultsMetadata":[{"ResultName":"JsonResult","ResultExample":"{}","ShowResult":true}],"Creator":"dc26f847-d850-429c-bc2c-59631a988301","IsEnabled":true,"IsCustom":true,"IsSystem":false,"Version":14.0,"TimeoutSeconds":600,"IsAsync":false,"AsyncPollingIntervalInSeconds":3600,"TotalIntervalTimeoutForAsyncInSeconds":86400,"Parameters":[{"CustomActionId":0,"IsMandatory":false,"DefaultValue":null,"Description":"Name or wildcard pattern of domain names to search for.","Name":"domain","Value":null,"Type":0,"OptionalValues":null,"OptionalValuesJson":null},{"CustomActionId":0,"IsMandatory":false,"DefaultValue":null,"Description":"A valid RE2 regex pattern to match domains. Overrides the domain argument.","Name":"domain_regex","Value":null,"Type":0,"OptionalValues":null,"OptionalValuesJson":null},{"CustomActionId":0,"IsMandatory":false,"DefaultValue":null,"Description":"Name server name or wildcard pattern of the name server used by domains.","Name":"name_server","Value":null,"Type":0,"OptionalValues":null,"OptionalValuesJson":null},{"CustomActionId":0,"IsMandatory":false,"DefaultValue":null,"Description":"Autonomous System (AS) number to filter domains.","Name":"asnum","Value":null,"Type":0,"OptionalValues":null,"OptionalValuesJson":null},{"CustomActionId":0,"IsMandatory":false,"DefaultValue":null,"Description":"Search for all AS numbers where the AS Name begins with the specified value.","Name":"asname","Value":null,"Type":0,"OptionalValues":null,"OptionalValuesJson":null},{"CustomActionId":0,"IsMandatory":false,"DefaultValue":null,"Description":"Minimum IP diversity limit to filter domains.","Name":"min_ip_diversity","Value":null,"Type":0,"OptionalValues":null,"OptionalValuesJson":null},{"CustomActionId":0,"IsMandatory":false,"DefaultValue":null,"Description":"Name or partial name of the registrar used to register domains.","Name":"registrar","Value":null,"Type":0,"OptionalValues":null,"OptionalValuesJson":null},{"CustomActionId":0,"IsMandatory":false,"DefaultValue":null,"Description":"Minimum ASN diversity limit to filter domains.","Name":"min_asn_diversity","Value":null,"Type":0,"OptionalValues":null,"OptionalValuesJson":null},{"CustomActionId":0,"IsMandatory":false,"DefaultValue":null,"Description":"Filter domains that had SSL certificates issued by the specified certificate issuer. Wildcards supported.","Name":"certificate_issuer","Value":null,"Type":0,"OptionalValues":null,"OptionalValuesJson":null},{"CustomActionId":0,"IsMandatory":false,"DefaultValue":null,"Description":"Filter domains with a WHOIS creation date after this date (YYYY-MM-DD).","Name":"whois_date_after","Value":null,"Type":0,"OptionalValues":null,"OptionalValuesJson":null},{"CustomActionId":0,"IsMandatory":false,"DefaultValue":null,"Description":"Number of results to skip in the search query.","Name":"skip","Value":null,"Type":0,"OptionalValues":null,"OptionalValuesJson":null},{"CustomActionId":0,"IsMandatory":false,"DefaultValue":null,"Description":"Number of results to return. Defaults to the SilentPush API's behavior.","Name":"limit","Value":null,"Type":0,"OptionalValues":null,"OptionalValuesJson":null}],"DefaultResultValue":"","PythonVersion":"None","SimulationData":{"Entities":null},"SimulationDataJson":null}