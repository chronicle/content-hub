{"Name":"List Domain Information","Description":"This action get domain information along with Silent Push risk score and live whois information for multiple domains.","Script":"from SiemplifyAction import SiemplifyAction\nfrom SiemplifyUtils import unix_now, convert_unixtime_to_datetime, output_handler\nfrom ScriptResult import EXECUTION_STATE_COMPLETED, EXECUTION_STATE_FAILED,EXECUTION_STATE_TIMEDOUT\n\nfrom typing import Any, Dict\nfrom constants import (INTEGRATION_NAME, LIST_DOMAIN_INFORMATION_SCRIPT_NAME )\nfrom SilentPushManager import SilentPushManager\n\n@output_handler\ndef main():\n    siemplify = SiemplifyAction()\n    siemplify.script_name = LIST_DOMAIN_INFORMATION_SCRIPT_NAME \n\n    # Extract Integration config\n    server_url = siemplify.extract_configuration_param(INTEGRATION_NAME, \"Silent Push Server\")\n    api_key = siemplify.extract_configuration_param(INTEGRATION_NAME, \"API Key\")\n\n    domain = siemplify.extract_action_param(\"domains\", print_value=True)\n    domains:list = domain.split(',')\n    fetch_risk_score = siemplify.extract_action_param(\"fetch_risk_score\", print_value=True)\n    fetch_whois_info = siemplify.extract_action_param(\"fetch_whois_info\", print_value=True)\n\n    if fetch_risk_score == \"false\":\n        fetch_risk_score:bool = False\n    else:\n        fetch_risk_score:bool = True\n\n    try:\n        sp_manager = SilentPushManager(server_url, api_key, logger=siemplify.LOGGER)\n        response = sp_manager.list_domain_information(domains, fetch_risk_score, fetch_whois_info)\n        \n        records = response.get(\"domains\", [])\n        markdown_response = format_domain_information(response, fetch_risk_score, fetch_whois_info)\n        json_response = format_domain_information_json(response, fetch_risk_score, fetch_whois_info)\n        if not records:\n            error_message = f\"No domain info found for {domains}\"\n            siemplify.LOGGER.error(error_message)\n            status = EXECUTION_STATE_FAILED\n            siemplify.end(error_message, \"false\", status)\n        \n        output_message = f\"Result: {markdown_response}\"\n        siemplify.result.add_result_json({\"domain_information_results\":json_response})\n        status = EXECUTION_STATE_COMPLETED\n        result_value = True\n    except Exception as error:\n        result_value = False\n        status = EXECUTION_STATE_FAILED\n        output_message = f\"Failed to domain info for {domains} for {INTEGRATION_NAME} server! Error: {error}\"\n        siemplify.LOGGER.error(output_message)\n        siemplify.LOGGER.exception(error)\n\n    for entity in siemplify.target_entities:\n        print(entity.identifier)\n\n    siemplify.LOGGER.info(\"\\n  status: {}\\n  result_value: {}\\n  output_message: {}\".format(status,result_value, output_message))\n    siemplify.end(output_message, result_value, status)\n\ndef format_domain_information(response: Dict[str, Any], fetch_risk_score: bool, fetch_whois_info: bool) -> str:\n    \"\"\"\n    Format the response data into markdown-style text for Google SecOps.\n\n    Args:\n        response (Dict[str, Any]): API response data\n        fetch_risk_score (bool): Whether to include risk score data\n        fetch_whois_info (bool): Whether to include WHOIS data\n\n    Returns:\n        str: Markdown-formatted response\n    \"\"\"\n    markdown = [\"# Domain Information Results\\n\"]\n\n    for domain_data in response.get(\"domains\", []):\n        domain = domain_data.get(\"domain\", \"N/A\")\n        markdown.append(f\"## Domain: {domain}\")\n\n        # Domain Information\n        markdown.append(\"### Domain Information\")\n        for key, value in domain_data.items():\n            if isinstance(value, dict):\n                continue  # handled later\n            markdown.append(f\"- **{key}**: {value}\")\n\n        # Risk Score Information\n        if fetch_risk_score:\n            markdown.append(\"\\n### Risk Assessment\")\n            risk_score = domain_data.get(\"risk_score\", \"N/A\")\n            risk_expl = domain_data.get(\"risk_score_explanation\", \"N/A\")\n            markdown.append(f\"- **Risk Score**: {risk_score}\")\n            markdown.append(f\"- **Explanation**: {risk_expl}\")\n\n        # WHOIS Information\n        if fetch_whois_info:\n            whois_info = domain_data.get(\"whois_info\", {})\n            markdown.append(\"\\n### WHOIS Information\")\n            if whois_info and isinstance(whois_info, dict):\n                if \"error\" in whois_info:\n                    markdown.append(f\"- WHOIS Error: {whois_info['error']}\")\n                else:\n                    for k, v in whois_info.items():\n                        markdown.append(f\"- **{k}**: {v}\")\n            else:\n                markdown.append(\"- No WHOIS information available\")\n\n        markdown.append(\"\\n---\\n\")\n\n    return \"\\n\".join(markdown)\n\ndef format_domain_information_json(\n    response: Dict[str, Any],\n    fetch_risk_score: bool,\n    fetch_whois_info: bool\n):\n    \"\"\"\n    Format the response data into JSON format for Google SecOps action.\n\n    Args:\n        response (Dict[str, Any]): API response data\n        fetch_risk_score (bool): Whether to include risk score data\n        fetch_whois_info (bool): Whether to include WHOIS data\n\n    Returns:\n        Dict[str, Any]: JSON-formatted response\n    \"\"\"\n    results = []\n\n    for domain_data in response.get(\"domains\", []):\n        domain_result = {\n            \"domain\": domain_data.get(\"domain\", \"N/A\"),\n            \"domain_information\": {k: v for k, v in domain_data.items() if not isinstance(v, dict)}\n        }\n\n        # Risk score\n        if fetch_risk_score:\n            domain_result[\"risk_assessment\"] = {\n                \"risk_score\": domain_data.get(\"risk_score\", \"N/A\"),\n                \"risk_score_explanation\": domain_data.get(\"risk_score_explanation\", \"N/A\")\n            }\n\n        # WHOIS info\n        if fetch_whois_info:\n            whois_info = domain_data.get(\"whois_info\", {})\n            if whois_info and isinstance(whois_info, dict):\n                if \"error\" in whois_info:\n                    domain_result[\"whois_info\"] = {\"error\": whois_info[\"error\"]}\n                else:\n                    domain_result[\"whois_info\"] = whois_info\n            else:\n                domain_result[\"whois_info\"] = {\"message\": \"No WHOIS information available\"}\n\n        results.append(domain_result)\n\n    return results\n    \nif __name__ == \"__main__\":\n    main()\n","IntegrationIdentifier":"Silent Push","ScriptResultName":"ScriptResult","DynamicResultsMetadata":[{"ResultName":"JsonResult","ResultExample":"{}","ShowResult":false}],"Creator":"dc26f847-d850-429c-bc2c-59631a988301","IsEnabled":true,"IsCustom":true,"IsSystem":false,"Version":6.0,"TimeoutSeconds":600,"IsAsync":false,"AsyncPollingIntervalInSeconds":3600,"TotalIntervalTimeoutForAsyncInSeconds":86400,"Parameters":[{"CustomActionId":0,"IsMandatory":true,"DefaultValue":"silentpush.com","Description":"Comma-separated list of domains to query.","Name":"domains","Value":"silentpush.com","Type":0,"OptionalValues":null,"OptionalValuesJson":null},{"CustomActionId":0,"IsMandatory":false,"DefaultValue":"false","Description":"Whether to fetch risk scores for the domains.","Name":"fetch_risk_score","Value":"false","Type":1,"OptionalValues":null,"OptionalValuesJson":null},{"CustomActionId":0,"IsMandatory":false,"DefaultValue":"false","Description":"Whether to fetch WHOIS information for the domains.\t","Name":"fetch_whois_info","Value":"false","Type":1,"OptionalValues":null,"OptionalValuesJson":null}],"DefaultResultValue":"","PythonVersion":"None","SimulationData":{"Entities":null},"SimulationDataJson":null}