{"Name":"Get Enrichment Data","Description":"This action retrieves comprehensive enrichment information for a given resource (domain, IPv4, or IPv6).","Script":"from SiemplifyAction import SiemplifyAction\nfrom SiemplifyUtils import unix_now, convert_unixtime_to_datetime, output_handler\nfrom ScriptResult import EXECUTION_STATE_COMPLETED, EXECUTION_STATE_FAILED,EXECUTION_STATE_TIMEDOUT\n\n\nfrom constants import (INTEGRATION_NAME, GET_ENRICHMENT_DATA_SCRIPT_NAME)\nfrom SilentPushManager import SilentPushManager, RESOURCE\n\n@output_handler\ndef main():\n    siemplify = SiemplifyAction()\n    siemplify.script_name = GET_ENRICHMENT_DATA_SCRIPT_NAME \n\n    # Extract Integration config\n    server_url = siemplify.extract_configuration_param(INTEGRATION_NAME, \"Silent Push Server\")\n    api_key = siemplify.extract_configuration_param(INTEGRATION_NAME, \"API Key\")\n\n    resource = siemplify.extract_action_param(\"resource\", print_value=True)\n    value = siemplify.extract_action_param(\"value\", print_value=True)\n    explain = siemplify.extract_action_param(\"explain\", print_value=True)\n    scan_data = siemplify.extract_action_param(\"scan_data\", print_value=True)\n    if explain == \"false\":\n        explaination:bool = False\n    else:\n        explaination:bool = True\n    \n    if scan_data == \"false\":\n        scan_data_val:bool = False\n    else:\n        scan_data_val:bool = True\n    if resource not in RESOURCE:\n        raise ValueError(f\"Invalid input: {resource}. Allowed values are {RESOURCE}\")\n    \n    try:\n        sp_manager = SilentPushManager(server_url, api_key, logger=siemplify.LOGGER)\n        \n        if resource in [\"ipv4\", \"ipv6\"]:\n            validate_ip(sp_manager, resource, value)\n        \n        enrichment_data = sp_manager.get_enrichment_data(resource, value, explaination, scan_data_val)\n        \n        if not enrichment_data:\n            error_message = f\"No enrichment data found for resource: {value}\"\n            siemplify.LOGGER.error(error_message)\n            status = EXECUTION_STATE_FAILED\n            siemplify.end(error_message, \"false\", status)\n        \n        output_message = f\"value: {value}, {enrichment_data}\"\n        status = EXECUTION_STATE_COMPLETED\n        result_value = True\n        siemplify.result.add_result_json({value: enrichment_data})\n    except Exception as error:\n        result_value = False\n        status = EXECUTION_STATE_FAILED\n        output_message = f\"Failed to retrieve enrichment data found for resource: {value} for {INTEGRATION_NAME} server! Error: {error}\"\n        siemplify.LOGGER.error(output_message)\n        siemplify.LOGGER.exception(error)\n\n    for entity in siemplify.target_entities:\n        print(entity.identifier)\n\n\n\n    siemplify.LOGGER.info(\"\\n  status: {}\\n  result_value: {}\\n  output_message: {}\".format(status,result_value, output_message))\n    siemplify.end(output_message, result_value, status)\n\ndef validate_ip(client: SilentPushManager, resource: str, value: str) -> None:\n    \"\"\"\n    Validate the IP address based on the resource type.\n\n    Args:\n        client (Client): The client object to interact with the enrichment service.\n        resource (str): The resource type (ipv4 or ipv6).\n        value (str): The IP address to validate.\n\n    Raises:\n        DemistoException: If the IP address is invalid for the given resource type.\n    \"\"\"\n    is_valid_ip = client.validate_ip_address(value, allow_ipv6=(resource == \"ipv6\"))\n    if not is_valid_ip:\n        raise ValueError(f\"Invalid {resource.upper()} address: {value}\")\n\nif __name__ == \"__main__\":\n    main()\n","IntegrationIdentifier":"Silent Push","ScriptResultName":"ScriptResult","DynamicResultsMetadata":[{"ResultName":"JsonResult","ResultExample":"{}","ShowResult":false}],"Creator":"dc26f847-d850-429c-bc2c-59631a988301","IsEnabled":true,"IsCustom":true,"IsSystem":false,"Version":6.0,"TimeoutSeconds":600,"IsAsync":false,"AsyncPollingIntervalInSeconds":3600,"TotalIntervalTimeoutForAsyncInSeconds":86400,"Parameters":[{"CustomActionId":0,"IsMandatory":true,"DefaultValue":"ipv4","Description":"Type of resource for which information needs to be retrieved {e.g. domain}.","Name":"resource","Value":"ipv4","Type":0,"OptionalValues":null,"OptionalValuesJson":null},{"CustomActionId":0,"IsMandatory":true,"DefaultValue":"142.251.188.102","Description":"Value corresponding to the selected \"resource\" for which information needs to be retrieved{e.g. silentpush.com}.","Name":"value","Value":"142.251.188.102","Type":0,"OptionalValues":null,"OptionalValuesJson":null},{"CustomActionId":0,"IsMandatory":false,"DefaultValue":"false","Description":"Include explanation of data calculations.","Name":"explain","Value":"false","Type":1,"OptionalValues":null,"OptionalValuesJson":null},{"CustomActionId":0,"IsMandatory":false,"DefaultValue":"false","Description":"Include scan data (IPv4 only).","Name":"scan_data","Value":"false","Type":1,"OptionalValues":null,"OptionalValuesJson":null}],"DefaultResultValue":"","PythonVersion":"None","SimulationData":{"Entities":null},"SimulationDataJson":null}