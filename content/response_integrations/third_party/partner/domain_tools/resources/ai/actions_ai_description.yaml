GetDomainProfile:
  ai_description: >-
    ### General Description

    This action enriches Domain, Hostname, and URL entities using DomainTools Threat
    Intelligence. It retrieves comprehensive domain profile information, including
    registration details and hosting history, to provide security analysts with better
    context for investigation. The results are attached as entity tables in CSV format
    and mapped directly to entity properties for use in playbooks.


    ### Parameters

    | Parameter | Description | Type | Mandatory |

    | :--- | :--- | :--- | :--- |

    | Username | The DomainTools API username (configured at the integration level).
    | String | Yes |

    | ApiToken | The DomainTools API key (configured at the integration level). |
    String | Yes |

    | Verify SSL | Specifies whether to verify SSL certificates (configured at the
    integration level). Defaults to False. | Boolean | No |


    ### Additional Notes

    * This action requires the 'domain-profile' product license to be active in the
    DomainTools account.

    * The action flattens nested JSON responses and prefixes the keys with 'DT' before
    updating the entity properties.

    * If no profile is found for a specific domain, the entity is skipped.


    ### Flow Description

    1. **Domain Extraction:** The action extracts the base domain from the entity
    identifier, handling URLs, email addresses, and hostnames automatically.

    2. **License Validation:** It checks the integration's account information to
    ensure the 'domain-profile' product is available.

    3. **API Query:** The script sends a request to the DomainTools API to fetch the
    profile for the target domain.

    4. **Data Flattening:** The hierarchical API response is flattened into a single-level
    dictionary and converted into a CSV-compatible format.

    5. **SOAR Enrichment:** The action adds a CSV data table to the entity, updates
    the entity's 'Additional Properties' with the findings, and marks the entity as
    enriched.

    6. **Finalization:** Updates the entities in the case and outputs a summary message
    along with the raw JSON results.
  capabilities:
    can_create_case_comments: false
    can_create_case_wall_logs: false
    can_create_insight: false
    can_mutate_external_data: false
    can_mutate_internal_data: false
    can_update_entities: true
    external_data_mutation_explanation: null
    fetches_data: true
    internal_data_mutation_explanation: null
  categories:
    enrichment: true
  entity_usage:
    entity_scopes:
      - DOMAIN
      - HOSTNAME
      - DestinationURL
    filters_by_additional_properties: false
    filters_by_alert_identifier: false
    filters_by_case_identifier: false
    filters_by_creation_time: false
    filters_by_entity_type: true
    filters_by_identifier: false
    filters_by_is_artifact: false
    filters_by_is_enriched: false
    filters_by_is_internal: false
    filters_by_is_pivot: false
    filters_by_is_suspicious: false
    filters_by_is_vulnerable: false
    filters_by_modification_time: false
GetDomainRisk:
  ai_description: >-
    ### General Description

    Enriches external domain-related entities (HOSTNAME, URL, and DOMAIN) with risk
    scores and detailed risk profiles using DomainTools. This action helps security
    analysts determine the threat level of a domain by fetching intelligence from
    DomainTools endpoints and comparing the risk score against a user-defined threshold.
    Entities exceeding this threshold are automatically marked as suspicious within
    the case.


    ### Parameters Description

    | Parameter | Type | Mandatory | Description |

    | :--- | :--- | :--- | :--- |

    | Threshold | String | Yes | A numeric value (e.g., '3' or '70') used to evaluate
    the risk score. If the domain's risk score exceeds this value, the entity is marked
    as suspicious and the action result is set to true. |


    ### Additional Notes

    - The action requires valid DomainTools credentials (Username and API Key) configured
    in the integration settings.

    - The 'Threshold' must be a valid number or the action will fail.

    - Depending on the DomainTools license, data may be retrieved from either the
    'reputation' or 'risk' API endpoints.


    ### Flow Description

    1.  **Initialization**: Retrieves DomainTools API credentials and the user-defined
    risk threshold from configuration and parameters.

    2.  **Entity Filtering**: Filters the target entities in the current scope to
    only process URLs, Hostnames, and Domains.

    3.  **Domain Extraction**: Extracts the base domain from the entity identifier
    (e.g., removing 'www' or parsing from a URL).

    4.  **API Query**: Requests risk and reputation data for each domain from DomainTools.

    5.  **Risk Evaluation**: Compares the retrieved risk score against the provided
    threshold. If the score is higher, the entity is marked as suspicious.

    6.  **Data Updates**: Updates the entities with a new 'DT_Risk' property and adds
    the full risk data to the action's JSON results for downstream use.
  capabilities:
    can_create_case_comments: false
    can_create_case_wall_logs: false
    can_create_insight: false
    can_mutate_external_data: false
    can_mutate_internal_data: false
    can_update_entities: true
    external_data_mutation_explanation: null
    fetches_data: true
    internal_data_mutation_explanation: null
  categories:
    enrichment: true
  entity_usage:
    entity_scopes:
      - HOSTNAME
      - DestinationURL
      - DOMAIN
    filters_by_additional_properties: false
    filters_by_alert_identifier: false
    filters_by_case_identifier: false
    filters_by_creation_time: false
    filters_by_entity_type: true
    filters_by_identifier: false
    filters_by_is_artifact: false
    filters_by_is_enriched: false
    filters_by_is_internal: false
    filters_by_is_pivot: false
    filters_by_is_suspicious: false
    filters_by_is_vulnerable: false
    filters_by_modification_time: false
GetHostingHistory:
  ai_description: >-
    ### General Description

    Enriches Hostname and URL entities with hosting history data from DomainTools.
    This action retrieves historical records related to a domain's hosting infrastructure,
    including IP addresses, nameservers, and registrar changes. It is designed to
    provide security analysts with visibility into infrastructure shifts and historical
    associations with potentially malicious providers.


    ### Parameters

    | Parameter Name | Description | Type | Mandatory |

    | :--- | :--- | :--- | :--- |

    | None | This action does not have any action-specific parameters. It uses the
    global integration configuration for credentials (Username, ApiToken, and Verify
    SSL). | N/A | N/A |


    ### Additional Notes

    - **License Requirement**: This action requires the 'hosting-history' product
    to be available in the configured DomainTools license.

    - **Prefixing**: All enriched data points added to the entity properties are prefixed
    with 'DT' for clear identification.

    - **Data Tables**: The results are also presented as a formatted CSV table attached
    to the entity in the Google SecOps interface.


    ### Flow Description

    1. **Filter Entities**: The action identifies all Hostname and URL entities within
    the current context.

    2. **Domain Extraction**: It extracts the base domain from the entity's identifier,
    handling URLs and email formats if necessary.

    3. **API Interaction**: For each domain, it queries the DomainTools API's hosting-history
    endpoint.

    4. **Data Transformation**: The API response is flattened and converted into a
    CSV format.

    5. **Internal Enrichment**: It updates the entity's additional properties with
    the flattened history data and adds a CSV data table to the entity in Google SecOps.
  capabilities:
    can_create_case_comments: false
    can_create_case_wall_logs: false
    can_create_insight: false
    can_mutate_external_data: false
    can_mutate_internal_data: true
    can_update_entities: true
    external_data_mutation_explanation: null
    fetches_data: true
    internal_data_mutation_explanation: >-
      Updates Hostname and URL entities with hosting history metadata in their additional
      properties and attaches a CSV data table to the entities within the case.
  categories:
    enrichment: true
  entity_usage:
    entity_scopes:
      - HOSTNAME
      - DestinationURL
    filters_by_additional_properties: false
    filters_by_alert_identifier: false
    filters_by_case_identifier: false
    filters_by_creation_time: false
    filters_by_entity_type: true
    filters_by_identifier: false
    filters_by_is_artifact: false
    filters_by_is_enriched: false
    filters_by_is_internal: false
    filters_by_is_pivot: false
    filters_by_is_suspicious: false
    filters_by_is_vulnerable: false
    filters_by_modification_time: false
Ping:
  ai_description: >-
    ### General Description

    This action is used to test the connectivity between Google SecOps and the DomainTools
    API. Its primary purpose is to validate that the integration's configuration (Username
    and API Token) is correct and that the system can successfully communicate with
    DomainTools services.


    ### Parameters Description

    | Parameter Name | Description | Type | Mandatory | Notes |

    | :--- | :--- | :--- | :--- | :--- |

    | N/A | This action does not have any input parameters. | N/A | N/A | Uses global
    integration settings. |


    ### Additional Notes

    - This action performs a real API call to the DomainTools `account_information`
    endpoint during the initialization phase of the manager to verify account status.

    - While simulation data might suggest entity support, the action logic does not
    iterate over or interact with any entities.


    ### Flow Description

    1. **Setup**: The action retrieves integration configuration details, including
    the Username, API Token, and SSL verification settings.

    2. **Manager Initialization**: It instantiates the `DomainToolsManager` class.

    3. **Connectivity Verification**: Upon instantiation, the `DomainToolsManager`
    automatically executes a request to the DomainTools `account_information` API
    endpoint. This step confirms the validity of the credentials and retrieves the
    list of products available under the current license.

    4. **Completion**: If the API request succeeds, the action returns a 'Connection
    Established' message. If the API returns an error or a connection cannot be made,
    the action indicates a failure.
  capabilities:
    can_create_case_comments: false
    can_create_case_wall_logs: false
    can_create_insight: false
    can_mutate_external_data: false
    can_mutate_internal_data: false
    can_update_entities: false
    external_data_mutation_explanation: null
    fetches_data: true
    internal_data_mutation_explanation: null
  categories:
    enrichment: false
  entity_usage:
    entity_scopes: [ ]
    filters_by_additional_properties: false
    filters_by_alert_identifier: false
    filters_by_case_identifier: false
    filters_by_creation_time: false
    filters_by_entity_type: false
    filters_by_identifier: false
    filters_by_is_artifact: false
    filters_by_is_enriched: false
    filters_by_is_internal: false
    filters_by_is_pivot: false
    filters_by_is_suspicious: false
    filters_by_is_vulnerable: false
    filters_by_modification_time: false
RecentDomains:
  ai_description: "### General Description\r\nSearches for newly registered domains\
    \ that contain a specific word or phrase using the DomainTools PhishEye service.\
    \ This action is primarily used for identifying potential typosquatting or phishing\
    \ domains shortly after they are registered. Note: This action is officially marked\
    \ as deprecated as the PhishEye product is being phased out by the provider.\r\
    \n\r\n### Parameters Description\r\n| Parameter | Type | Mandatory | Description\
    \ |\r\n| :--- | :--- | :--- | :--- |\r\n| String Query | String | Yes | The keyword\
    \ or substring to search for within newly registered domain names. |\r\n\r\n###\
    \ Flow Description\r\n1. **Configuration**: The action initializes the DomainTools\
    \ manager using the Username and API Token from the integration settings.\r\n\
    2. **License Validation**: The system checks if the user's license includes the\
    \ 'phisheye' product.\r\n3. **Query Execution**: A search request is sent to the\
    \ DomainTools API for domains matching the provided 'String Query'.\r\n4. **Result\
    \ Processing**: If domains are found, the hierarchical API response is flattened\
    \ and converted into a CSV-style format for display.\r\n5. **Output**: The action\
    \ generates a data table containing the search results and returns a success status.\r\
    \n\r\n### Additional Notes\r\n- This action does not operate on case entities\
    \ (e.g., IPs or Domains); it relies entirely on the manual 'String Query' input.\r\
    \n- Because the underlying service is deprecated, results may be limited or the\
    \ action may eventually cease to function."
  capabilities:
    can_create_case_comments: false
    can_create_case_wall_logs: false
    can_create_insight: false
    can_mutate_external_data: false
    can_mutate_internal_data: false
    can_update_entities: false
    external_data_mutation_explanation: null
    fetches_data: true
    internal_data_mutation_explanation: null
  categories:
    enrichment: true
  entity_usage:
    entity_scopes: [ ]
    filters_by_additional_properties: false
    filters_by_alert_identifier: false
    filters_by_case_identifier: false
    filters_by_creation_time: false
    filters_by_entity_type: false
    filters_by_identifier: false
    filters_by_is_artifact: false
    filters_by_is_enriched: false
    filters_by_is_internal: false
    filters_by_is_pivot: false
    filters_by_is_suspicious: false
    filters_by_is_vulnerable: false
    filters_by_modification_time: false
ReverseDomain:
  ai_description: >-
    ### General Description

    This action enriches Hostname, URL, and Domain entities by querying DomainTools
    to find IP addresses that point to a particular domain (Reverse DNS) or domains
    that share a common IP address. It is primarily used to map out the infrastructure
    associated with a specific entity and identify potential overlaps or related assets.


    ### Parameters Description

    | Parameter | Type | Mandatory | Description |

    | :--- | :--- | :--- | :--- |

    | No Action Parameters | N/A | No | This action does not have specific input parameters.
    It utilizes the integration-level configuration for Username, ApiToken, and SSL
    verification. |


    ### Additional Notes

    - The action automatically handles domain extraction from complex strings like
    URLs or email addresses before querying the API.

    - Enrichment data is prefixed with 'DT' in the entity's additional properties.


    ### Flow Description

    1. **Filter Entities**: The action identifies all Hostname, URL, and Domain entities
    within the current scope.

    2. **Domain Extraction**: For each valid entity, the script extracts the base
    domain name (e.g., stripping 'www' or protocol prefixes).

    3. **API Query**: It calls the DomainTools `reverse_ip` or `host_domains` endpoint
    via the DomainToolsManager to retrieve hosting and IP relationship data.

    4. **Internal Updates**: If data is retrieved, the entity's additional properties
    are updated with the raw results, and a data table is attached to the entity for
    visibility in the Case Wall.

    5. **Result Compilation**: The script collects JSON results for all processed
    entities and performs a bulk update to save changes in Google SecOps.
  capabilities:
    can_create_case_comments: false
    can_create_case_wall_logs: false
    can_create_insight: false
    can_mutate_external_data: false
    can_mutate_internal_data: false
    can_update_entities: true
    external_data_mutation_explanation: null
    fetches_data: true
    internal_data_mutation_explanation: null
  categories:
    enrichment: true
  entity_usage:
    entity_scopes:
      - HOSTNAME
      - DestinationURL
      - DOMAIN
    filters_by_additional_properties: false
    filters_by_alert_identifier: false
    filters_by_case_identifier: false
    filters_by_creation_time: false
    filters_by_entity_type: true
    filters_by_identifier: false
    filters_by_is_artifact: false
    filters_by_is_enriched: false
    filters_by_is_internal: false
    filters_by_is_pivot: false
    filters_by_is_suspicious: false
    filters_by_is_vulnerable: false
    filters_by_modification_time: false
ReverseEmail:
  ai_description: >-
    ### General Description

    This action enriches Email entities (mapped as `USERUNIQNAME`) by querying the
    DomainTools Iris API to find domains associated with that email address in Whois
    records. It is used to identify other assets or infrastructure linked to a specific
    user or threat actor's email address.


    ### Parameters Description

    There are no parameters for this action.


    ### Additional Notes

    - This action requires a valid DomainTools license that includes access to the
    'Iris' product.

    - Enrichment data is added to the entity's 'additional_data' property with the
    prefix 'DT'.

    - The results are also presented as an entity table in the Google SecOps case
    wall for easier readability.


    ### Flow Description

    1. **Initialization**: Connects to the DomainTools API using the provided username
    and API key from the integration configuration.

    2. **Entity Filtering**: Identifies all `USERUNIQNAME` (Email) entities within
    the action's scope.

    3. **API Query**: For each email address, it calls the DomainTools Iris endpoint
    to search for domains where the email address is listed in the Whois record.

    4. **Data Transformation**: The API response is flattened and converted into a
    CSV-compatible format for display.

    5. **Internal Enrichment**: The flattened data is appended to the entity's additional
    data fields with the 'DT' prefix.

    6. **UI Presentation**: Adds a data table to the specific entity in the Google
    SecOps platform displaying the found domain relationships.

    7. **Finalization**: Updates the entities within the system and completes the
    action with a summary message.
  capabilities:
    can_create_case_comments: false
    can_create_case_wall_logs: false
    can_create_insight: false
    can_mutate_external_data: false
    can_mutate_internal_data: false
    can_update_entities: true
    external_data_mutation_explanation: null
    fetches_data: true
    internal_data_mutation_explanation: null
  categories:
    enrichment: true
  entity_usage:
    entity_scopes:
      - USERUNIQNAME
    filters_by_additional_properties: false
    filters_by_alert_identifier: false
    filters_by_case_identifier: false
    filters_by_creation_time: false
    filters_by_entity_type: true
    filters_by_identifier: false
    filters_by_is_artifact: false
    filters_by_is_enriched: false
    filters_by_is_internal: false
    filters_by_is_pivot: false
    filters_by_is_suspicious: false
    filters_by_is_vulnerable: false
    filters_by_modification_time: false
ReverseIP:
  ai_description: >-
    ### General Description

    This action enriches IP address entities by identifying domain names that share
    the same IP address using the DomainTools service. It leverages the DomainTools
    Iris API to perform a reverse IP lookup, providing security analysts with visibility
    into potential hosting adjacencies or infrastructure clustering associated with
    a specific IP.


    ### Parameters Description

    This action does not require any additional input parameters. It uses the integration's
    global configuration (Username and API Key) and runs automatically on all supported
    entities in the current scope.


    ### Flow Description

    1. **Initialization:** The action initializes the DomainTools manager using the
    provided credentials (Username and API Key) and SSL verification settings from
    the integration configuration.

    2. **Entity Filtering:** It identifies all `ADDRESS` (IP) entities in the current
    scope that are not marked as internal.

    3. **Data Retrieval:** For each identified entity, the action queries the DomainTools
    Iris API using the IP address to find associated domains.

    4. **Data Processing:** If domains are found, the API response is flattened and
    converted into a CSV-compatible format for display.

    5. **Internal Enrichment:** The action updates the entity's `additional_properties`
    with the retrieved data (prefixed with 'DT') and adds a data table to the entity's
    view in the SecOps platform.

    6. **Final Update:** The processed entities are updated in the system, and the
    action concludes with a summary of the enrichment results.
  capabilities:
    can_create_case_comments: false
    can_create_case_wall_logs: false
    can_create_insight: false
    can_mutate_external_data: false
    can_mutate_internal_data: false
    can_update_entities: true
    external_data_mutation_explanation: null
    fetches_data: true
    internal_data_mutation_explanation: null
  categories:
    enrichment: true
  entity_usage:
    entity_scopes:
      - ADDRESS
    filters_by_additional_properties: false
    filters_by_alert_identifier: false
    filters_by_case_identifier: false
    filters_by_creation_time: false
    filters_by_entity_type: true
    filters_by_identifier: false
    filters_by_is_artifact: false
    filters_by_is_enriched: false
    filters_by_is_internal: true
    filters_by_is_pivot: false
    filters_by_is_suspicious: false
    filters_by_is_vulnerable: false
    filters_by_modification_time: false
