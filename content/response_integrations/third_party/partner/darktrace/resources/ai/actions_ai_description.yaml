Add Comment To Model Breach:
  ai_description: >-
    ### General Description

    Adds a user-specified comment to a Model Breach alert in the Darktrace platform.
    This action is designed for incident response workflows where analysts need to
    document findings, status updates, or internal notes directly within the Darktrace
    console from within Google SecOps.


    ### Parameters Description

    | Name | Type | Mandatory | Description |

    | :--- | :--- | :--- | :--- |

    | Model Breach ID | String | Yes | The unique identifier (pbid) of the model breach
    in Darktrace that you want to comment on. |

    | Comment | String | Yes | The text content of the comment to be added to the
    model breach. |


    ### Additional Notes

    - This action uses the Darktrace API's POST method to attach the comment.

    - If the provided `Model Breach ID` is not found, the action will return a failure
    status with a specific error message.


    ### Flow Description

    1. **Initialization**: The action initializes the Darktrace Manager using the
    provided API Root, Token, and Private Token configuration.

    2. **Parameter Extraction**: It retrieves the `Model Breach ID` and the `Comment`
    text from the input parameters.

    3. **API Call**: It executes a POST request to the Darktrace `/modelbreaches/{model_breach_id}/comments`
    endpoint with the comment message.

    4. **Error Handling**: The script checks for `NotFoundException` (404) to provide
    a user-friendly error if the ID is incorrect. It also captures general exceptions.

    5. **Completion**: If successful, it adds the API response to the action results
    and completes with a success message.
  capabilities:
    can_create_case_comments: false
    can_create_case_wall_logs: false
    can_create_insight: false
    can_mutate_external_data: true
    can_mutate_internal_data: false
    can_update_entities: false
    external_data_mutation_explanation: >-
      Adds a new comment string to an existing Model Breach alert in the Darktrace
      system via a POST request.
    fetches_data: false
    internal_data_mutation_explanation: null
  categories:
    enrichment: false
  entity_usage:
    entity_scopes: []
    filters_by_additional_properties: false
    filters_by_alert_identifier: false
    filters_by_case_identifier: false
    filters_by_creation_time: false
    filters_by_entity_type: false
    filters_by_identifier: false
    filters_by_is_artifact: false
    filters_by_is_enriched: false
    filters_by_is_internal: false
    filters_by_is_pivot: false
    filters_by_is_suspicious: false
    filters_by_is_vulnerable: false
    filters_by_modification_time: false
Enrich Entities:
  ai_description: "Enriches IP, Hostname, MacAddress, and URL entities using information\
    \ from Darktrace. This action retrieves detailed device or endpoint metadata including\
    \ OS, first/last seen timestamps, and associated labels. It can optionally fetch\
    \ connection history and generate detailed SOAR insights for internal endpoints.\n\
    \n### Parameters\n\n| Parameter | Type | Mandatory | Default | Description |\n\
    | :--- | :--- | :--- | :--- | :--- |\n| Fetch Connection Data | boolean | No |\
    \ true | If enabled, retrieves additional information about network connections\
    \ related to internal Darktrace endpoints. |\n| Max Hours Backwards | string |\
    \ No | 24 | Specifies the time window (in hours) for fetching connection data.\
    \ If set to less than 1, it defaults back to 24. |\n| Create Endpoint Insight\
    \ | boolean | No | true | If enabled, creates a visual insight in the Google SecOps\
    \ case wall containing summary information about the endpoint. |\n\n### Flow Description\n\
    \n1. **Initialization**: Validates the Darktrace API configuration (Root, Token,\
    \ Private Token) and retrieves action parameters.\n2. **Entity Filtering**: Identifies\
    \ supported entities (ADDRESS, HOSTNAME, MacAddress, DestinationURL) from the\
    \ current case scope. For URL entities, the domain is extracted.\n3. **Data Retrieval**:\
    \ \n    - For IPs and MACs: Queries the Darktrace `/devices` or `/endpointdetails`\
    \ endpoints.\n    - For Hostnames: Searches for the device to resolve its IP or\
    \ MAC, then fetches full details.\n4. **Connection Enrichment**: If `Fetch Connection\
    \ Data` is enabled, it calls the `/deviceinfo` endpoint to retrieve historical\
    \ network activity for the specified time range.\n5. **Internal Enrichment**:\
    \ Updates the entities with enrichment prefixes, populates entity tables for individual\
    \ entity views, and adds broader data tables for interacted devices and connection\
    \ logs.\n6. **Insight Generation**: If `Create Endpoint Insight` is active, it\
    \ generates a formatted HTML insight for the entity.\n7. **Completion**: Commits\
    \ the enrichment data and results to the Google SecOps case."
  capabilities:
    can_create_case_comments: false
    can_create_case_wall_logs: false
    can_create_insight: true
    can_mutate_external_data: false
    can_mutate_internal_data: false
    can_update_entities: true
    external_data_mutation_explanation: null
    fetches_data: true
    internal_data_mutation_explanation: null
  categories:
    enrichment: true
  entity_usage:
    entity_scopes:
    - ADDRESS
    - HOSTNAME
    - MacAddress
    - DestinationURL
    filters_by_additional_properties: false
    filters_by_alert_identifier: false
    filters_by_case_identifier: false
    filters_by_creation_time: false
    filters_by_entity_type: true
    filters_by_identifier: false
    filters_by_is_artifact: false
    filters_by_is_enriched: false
    filters_by_is_internal: false
    filters_by_is_pivot: false
    filters_by_is_suspicious: false
    filters_by_is_vulnerable: false
    filters_by_modification_time: false
Execute Custom Search:
  ai_description: >-
    ### General Description

    The **Execute Custom Search** action allows users to perform advanced queries
    against the Darktrace platform to retrieve specific event data or 'hits' based
    on a defined timeframe. It is primarily used for deep-dive investigation or threat
    hunting within the Darktrace environment by leveraging its Advanced Search API.


    ### Parameters Description


    | Parameter | Type | Mandatory | Description |

    | :--- | :--- | :--- | :--- |

    | **Query** | String | Yes | The specific search query logic to be executed in
    Darktrace. |

    | **Time Frame** | DDL | No | Defines the temporal range for the search. Options
    include relative ranges (e.g., 'Last Hour'), absolute ranges ('Custom'), or alert-relative
    ranges (e.g., '30 Minutes Around Alert Time'). Defaults to 'Last Hour'. |

    | **Start Time** | String | No | The ISO 8601 start time for the search. This
    is **mandatory** if 'Time Frame' is set to 'Custom'. |

    | **End Time** | String | No | The ISO 8601 end time for the search. If left empty
    while 'Time Frame' is 'Custom', it defaults to the current time. |

    | **Max Results To Return** | Integer | No | The maximum number of search hits
    to return. Defaults to 50. |


    ### Flow Description

    1.  **Initialization**: The action initializes the Darktrace manager using API
    credentials (Token and Private Token) and determines the execution context.

    2.  **Time Resolution**: It calculates the search window. If a relative timeframe
    like '30 Minutes Around Alert Time' is selected, it uses the `StartTime` and `EndTime`
    from the current alert's additional properties to set the bounds.

    3.  **API Execution**: The query and time parameters are JSON-encoded and then
    Base64-encoded to form the request URL for the Darktrace `advanced_search` endpoint.

    4.  **Data Processing**: The results (hits) are retrieved and parsed into a structured
    JSON format.

    5.  **Output**: The action attaches the raw results to the case as `JsonResult`
    and provides a summary message indicating the number of results found.


    ### Additional Notes

    - Either a predefined **Time Frame** or a combination of **Time Frame: Custom**
    and **Start Time** must be provided.

    - The action requires alert context (specifically `StartTime` and `EndTime` in
    `additional_properties`) to function correctly with 'Around Alert Time' selections.
  capabilities:
    can_create_case_comments: false
    can_create_case_wall_logs: false
    can_create_insight: false
    can_mutate_external_data: false
    can_mutate_internal_data: false
    can_update_entities: false
    external_data_mutation_explanation: null
    fetches_data: true
    internal_data_mutation_explanation: null
  categories:
    enrichment: false
  entity_usage:
    entity_scopes: []
    filters_by_additional_properties: false
    filters_by_alert_identifier: false
    filters_by_case_identifier: false
    filters_by_creation_time: false
    filters_by_entity_type: false
    filters_by_identifier: false
    filters_by_is_artifact: false
    filters_by_is_enriched: false
    filters_by_is_internal: false
    filters_by_is_pivot: false
    filters_by_is_suspicious: false
    filters_by_is_vulnerable: false
    filters_by_modification_time: false
List Endpoint Events:
  ai_description: "### General Description\nThis action retrieves the latest events\
    \ related to specific endpoints from Darktrace. It is used to provide visibility\
    \ into network activity such as connections, unusual connections, notices, and\
    \ model breaches associated with IP Address, Hostname, or MAC Address entities.\n\
    \n### Parameters Description\n\n| Parameter | Type | Mandatory | Description |\n\
    | :--- | :--- | :--- | :--- |\n| **Event Type** | String | Yes | A comma-separated\
    \ list of Darktrace event types to return. Supported values include: `connection`,\
    \ `unusualconnection`, `newconnection`, `notice`, `devicehistory`, `modelbreach`.\
    \ |\n| **Time Frame** | DDL | Yes | The time range for the search. Options include\
    \ 'Last Hour', 'Last 6 Hours', 'Last 24 Hours', 'Last Week', 'Last Month', or\
    \ 'Custom'. |\n| **Start Time** | String | No | Mandatory if 'Time Frame' is set\
    \ to 'Custom'. Specifies the beginning of the search in ISO 8601 format. |\n|\
    \ **End Time** | String | No | Specifies the end of the search in ISO 8601 format.\
    \ If omitted and 'Custom' is selected, the current time is used. |\n| **Max Events\
    \ To Return** | String/Integer | No | The maximum number of events to return per\
    \ event type for each entity. Default is 50. |\n\n### Flow Description\n1. **Initialization:**\
    \ Validates API credentials (Root URL, Tokens) and parameters, including checking\
    \ if the limit is a positive number and if event types are valid.\n2. **Time Calculation:**\
    \ Determines the specific start and end timestamps based on the selected 'Time\
    \ Frame' and provided 'Start/End Time' strings.\n3. **Entity Filtering:** Filters\
    \ the target entities to identify those supported by the action (IP Address, Hostname,\
    \ and MAC Address).\n4. **Device Resolution:** For each valid entity, the action\
    \ queries Darktrace to find the corresponding internal Device ID (`did`).\n5.\
    \ **Event Fetching:** For every resolved device, the action iterates through the\
    \ specified 'Event Types' and fetches the most recent events within the calculated\
    \ time window up to the specified limit.\n6. **Data Presentation:** \n    *  \
    \ Constructs individual data tables for each entity and event type found.\n  \
    \  *   Aggregates all retrieved event data into a structured JSON result.\n  \
    \  *   Reports success for entities where events were found and identifies entities\
    \ that could not be resolved or had no data.\n\n### Additional Notes\nIf the 'Time\
    \ Frame' is set to 'Custom', the 'Start Time' parameter must be filled; otherwise,\
    \ the action will fail."
  capabilities:
    can_create_case_comments: false
    can_create_case_wall_logs: false
    can_create_insight: false
    can_mutate_external_data: false
    can_mutate_internal_data: false
    can_update_entities: false
    external_data_mutation_explanation: null
    fetches_data: true
    internal_data_mutation_explanation: null
  categories:
    enrichment: true
  entity_usage:
    entity_scopes:
    - ADDRESS
    - HOSTNAME
    - MacAddress
    filters_by_additional_properties: false
    filters_by_alert_identifier: false
    filters_by_case_identifier: false
    filters_by_creation_time: false
    filters_by_entity_type: true
    filters_by_identifier: false
    filters_by_is_artifact: false
    filters_by_is_enriched: false
    filters_by_is_internal: false
    filters_by_is_pivot: false
    filters_by_is_suspicious: false
    filters_by_is_vulnerable: false
    filters_by_modification_time: false
List Similar Devices:
  ai_description: >-
    ### General Description

    Enriches endpoint entities including IP addresses, hostnames, and MAC addresses
    by identifying similar devices within the Darktrace platform. This action leverages
    Darktrace's behavioral analysis to find other endpoints that exhibit similar network
    characteristics or profiles, providing broader context during investigations.


    ### Parameters Description

    | Parameter | Type | Mandatory | Default | Description |

    | :--- | :--- | :--- | :--- | :--- |

    | Max Devices To Return | Integer | No | 50 | Specifies the maximum number of
    similar devices to retrieve for each processed entity. Value must be greater than
    0. |


    ### Flow Description

    1. **Connectivity Check**: Establishes a connection with Darktrace and validates
    the API credentials (API Root, Token, and Private Token).

    2. **Entity Filtering**: Processes the target entities, selecting only those of
    type ADDRESS, HOSTNAME, or MacAddress.

    3. **Device Identification**: For each supported entity, the action queries Darktrace
    to find its unique internal Device ID (`did`).

    4. **Similarity Retrieval**: Uses the `did` to request a list of similar devices
    from the `/similardevices` endpoint, capped by the 'Max Devices To Return' parameter.

    5. **Data Enrichment**: For every device found, it constructs a detailed data
    table containing attributes like IP, MAC, OS, and Hostname. It also attaches the
    raw results as a JSON object to the action.


    ### Additional Notes

    - The action requires valid API credentials and a valid SSL configuration to communicate
    with the Darktrace instance.

    - If a specific entity cannot be matched to a device in Darktrace, it will be
    skipped and reported in the failed entities list.
  capabilities:
    can_create_case_comments: false
    can_create_case_wall_logs: false
    can_create_insight: false
    can_mutate_external_data: false
    can_mutate_internal_data: false
    can_update_entities: false
    external_data_mutation_explanation: null
    fetches_data: true
    internal_data_mutation_explanation: null
  categories:
    enrichment: true
  entity_usage:
    entity_scopes:
    - ADDRESS
    - HOSTNAME
    - MacAddress
    filters_by_additional_properties: false
    filters_by_alert_identifier: false
    filters_by_case_identifier: false
    filters_by_creation_time: false
    filters_by_entity_type: true
    filters_by_identifier: false
    filters_by_is_artifact: false
    filters_by_is_enriched: false
    filters_by_is_internal: false
    filters_by_is_pivot: false
    filters_by_is_suspicious: false
    filters_by_is_vulnerable: false
    filters_by_modification_time: false
Ping:
  ai_description: >-
    ### General Description

    This action tests the connectivity between Google SecOps and the Darktrace server.
    It validates the provided authentication credentials and API endpoint configuration
    by making a health check request to the Darktrace `/status` endpoint.


    ### Parameters Description

    | Parameter | Type | Mandatory | Description |

    | :--- | :--- | :--- | :--- |

    | **API Root** | String | Yes | The base URL of the Darktrace API (e.g., `https://darktrace-server.example.com`).
    |

    | **API Token** | String | Yes | The public API token used for authentication.
    |

    | **API Private Token** | String | Yes | The private API token used to generate
    secure request signatures. |

    | **Verify SSL** | Boolean | No | If enabled, the action will verify the SSL certificate
    of the Darktrace server. Defaults to `false` if not specified. |


    ### Flow Description

    1. **Initialization**: The action retrieves the integration configuration parameters
    (API Root, Tokens, and SSL settings).

    2. **Manager Setup**: A `DarktraceManager` instance is created using the provided
    credentials.

    3. **Connectivity Test**: The manager executes a `GET` request to the `/status`
    endpoint of the Darktrace API. This request involves generating a secure HMAC
    signature using the API tokens and current UTC timestamp.

    4. **Validation**: The response from the server is validated. If the server returns
    a successful response code (and no internal error messages), the connection is
    considered successful.

    5. **Completion**: The action reports a success message if the connection is established
    or a detailed error message if the connection fails (e.g., due to invalid credentials,
    network issues, or SSL errors).
  capabilities:
    can_create_case_comments: false
    can_create_case_wall_logs: false
    can_create_insight: false
    can_mutate_external_data: false
    can_mutate_internal_data: false
    can_update_entities: false
    external_data_mutation_explanation: null
    fetches_data: true
    internal_data_mutation_explanation: null
  categories:
    enrichment: false
  entity_usage:
    entity_scopes: []
    filters_by_additional_properties: false
    filters_by_alert_identifier: false
    filters_by_case_identifier: false
    filters_by_creation_time: false
    filters_by_entity_type: false
    filters_by_identifier: false
    filters_by_is_artifact: false
    filters_by_is_enriched: false
    filters_by_is_internal: false
    filters_by_is_pivot: false
    filters_by_is_suspicious: false
    filters_by_is_vulnerable: false
    filters_by_modification_time: false
Update Model Breach Status:
  ai_description: >-
    Updates the acknowledgment status of a specific model breach within the Darktrace
    platform. This action allows analysts to programmatically mark a model breach
    as either 'Acknowledged' or 'Unacknowledged', facilitating workflow automation
    for incident response.


    ### Parameters Description


    | Parameter | Type | Mandatory | Description |

    | :--- | :--- | :--- | :--- |

    | Status | String (DDL) | Yes | The target status to set for the model breach.
    Options are 'Acknowledged' or 'Unacknowledged'. |

    | Model Breach ID | String | Yes | The unique identifier of the specific model
    breach to update. |


    ### Flow Description


    1.  **Parameter Extraction:** The action retrieves the Darktrace API configuration
    and the required parameters: `Status` and `Model Breach ID`.

    2.  **Current State Validation:** It fetches the current state of the specified
    model breach from Darktrace. If the breach's current status already matches the
    target `Status`, the action terminates successfully without making further changes.

    3.  **Update Execution:** If the status needs updating, the action sends a POST
    request to the Darktrace API to either acknowledge or unacknowledge the breach
    based on the user input.

    4.  **Completion:** Upon success, a confirmation message is returned to the Google
    SecOps case wall.


    ### Additional Notes


    *   This action does not operate on entity scopes; it requires the specific `Model
    Breach ID` to be provided as a parameter.
  capabilities:
    can_create_case_comments: false
    can_create_case_wall_logs: false
    can_create_insight: false
    can_mutate_external_data: true
    can_mutate_internal_data: false
    can_update_entities: false
    external_data_mutation_explanation: >-
      Updates the status of a model breach in Darktrace by sending a POST request
      to the acknowledge or unacknowledge endpoints.
    fetches_data: true
    internal_data_mutation_explanation: null
  categories:
    enrichment: false
  entity_usage:
    entity_scopes: []
    filters_by_additional_properties: false
    filters_by_alert_identifier: false
    filters_by_case_identifier: false
    filters_by_creation_time: false
    filters_by_entity_type: false
    filters_by_identifier: false
    filters_by_is_artifact: false
    filters_by_is_enriched: false
    filters_by_is_internal: false
    filters_by_is_pivot: false
    filters_by_is_suspicious: false
    filters_by_is_vulnerable: false
    filters_by_modification_time: false
