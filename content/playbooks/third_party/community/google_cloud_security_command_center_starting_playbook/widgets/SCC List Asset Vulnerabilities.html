<!-- Custom Widget / Integration Version when it was updated 11.0 -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700,700i"
        rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css?family=Source Sans Pro"
        rel="stylesheet"/>
  <title>List Asset Vulnerabilities </title>
  <style>
      /* Root Variables */
      :root {
          --dark-gray-100: hsl(0, 0%, 1000%);
          --widget-bg: rgb(33, 44, 68);
          --widget-font-family: 'Source Sans Pro', sans-serif;
          --widget-text-color: rgb(255, 255, 255);
          --widget-row-highlight-bg: rgb(47 61 91);
          --font-weight-bold: 700;
          --font-weight-semibold: 600;

          /*Logo styles*/
          --logo-size: 48px;
          --logo-color: rgb(255, 255, 255);
          /*Logo styles*/

          --divider-border-colcor: rgb(98, 117, 163);
          --divider-border-width: 1px;

          --header-title-font: 600 16px/22px var(--widget-font-family);

          /*Sidebar styles*/
          --sidebar-width: 167px;
          --sidebar-item-text-style: 400 14px/18px var(--widget-font-family);
          --sidebar-item-text-style-active: 600 14px/16px var(--widget-font-family);
          --sidebar-item-active-bg: rgb(58, 74, 108);
          --sidebar-item-padding: 10px;

          /*Table styles*/
          --table-color-even-row: rgb(26 32 50);
          --table-title-size: 600 14px/18px var(--widget-font-family);
          --table-th-size: 600 14px/18px var(--widget-font-family);
          --table-td-size: 400 14px/18px var(--widget-font-family);
      }

      /*Normalize CSS */
      * {
          margin: 0;
          padding: 0;
          outline: none;
          box-sizing: border-box;
      }

      *:hover, *:focus, *:active {
          outline: none;
      }

      table {
          width: 100%;
          border-collapse: collapse;
          border-spacing: 0;
      }

      button {
          font-family: inherit;
          background: transparent;
          border: 0;
          color: inherit;
          text-align: left;
      }

      button, a[href] {
          cursor: pointer;
      }

      /*Normalize CSS */


      /* Custom Scrollbar */
      ::-webkit-scrollbar {
          width: 18px;
          height: 18px;
      }

      ::-webkit-scrollbar-thumb {
          background: rgba(137, 151, 180, 1);
          border: 6px solid var(--widget-bg);
          border-radius: 63px;
      }

      ::-webkit-scrollbar-track {
          background: transparent;
          border: 4px solid transparent;
          border-radius: 44px;
      }

      ::-webkit-scrollbar-corner {
          background-color: transparent;
          border-color: transparent;
      }

      body {
          font-family: var(--widget-font-family), serif;
          color: var(--widget-text-color);
          background-color: var(--widget-bg);
          overflow: hidden;
      }

      /*Global styles*/
      .text-ellipsis {
          overflow: hidden;
          text-overflow: ellipsis;
          white-space: nowrap;
      }

      .divider-border-style {
          border: 0;
          border-color: var(--divider-border-colcor);
          border-style: solid;
      }

      .tooltip {
          max-width: 100%;
          position: absolute;
          padding: 8px 16px 8px 16px;
          border-radius: 4px;
          background-color: rgb(204 204 218);
          color: rgb(22, 22, 37);
          font: 400 14px/18px var(--widget-font-family);
          z-index: 9;
          word-wrap: break-word;
      }

      .tooltip-triangle {
          position: absolute;
          top: 100%;
          border-top: solid 8px rgb(195, 210, 232);
          border-left: solid 8px transparent;
          border-right: solid 8px transparent;
      }

      /*Global styles*/

      .wrapper {
          display: flex;
          height: 100vh;
      }

      /*left sidebar*/
      .left-side {
          min-width: var(--sidebar-width);
          max-width: var(--sidebar-width);
          overflow-y: auto;
          padding-right: 6px;
          border-right-width: var(--divider-border-width);
      }

      .left-side-item {
          width: 100%;
          padding: var(--sidebar-item-padding);
          font: var(--sidebar-item-text-style);
      }

      .left-side-item.active {
          background-color: var(--sidebar-item-active-bg);
          font: var(--sidebar-item-text-style-active);
      }

      /*left sidebar*/

      .right-side {
          width: calc(100% - 168px);
          display: flex;
          flex-direction: column;
      }

      .header {
          display: flex;
          align-items: center;
          justify-content: space-between;
          gap: 12px;
          margin-bottom: 12px;
          border-bottom-width: var(--divider-border-width);
      }

      .header-title {
          font: var(--header-title-font);
          word-break: break-word;
          padding: 0 6px;
      }

      .header-title {
          font: var(--header-title-font);
          word-break: break-word;
          padding: 0 6px;
      }

      .logo {
          min-width: var(--logo-size);
          min-height: var(--logo-size);
          max-width: var(--logo-size);
          max-height: var(--logo-size);
          color: var(--logo-color);
          margin-left: auto;
      }

      .main-content {
          flex: 1;
          overflow: auto;
      }

      .counter {
          padding: 12px;
      }

      .counter-number {
          font-weight: var(--font-weight-bold);
          color: var(--dark-gray-100);
          font-size: 64px;
          line-height: 64px;
          text-align: center;
      }

      .counter-title {
          font-weight: var(--font-weight-semibold);
          color: var(--dark-gray-100);
          font-size: 20px;
          text-transform: uppercase;
          text-align: center;
      }

      .issue-severities {
          display: flex;
          justify-content: center;
          align-items: center;
          width: 100%;
          margin-bottom: 15px;
          flex-wrap: wrap;
          gap: 10px;
      }

      .issue-severities p {
          font-size: 14px;
          font-weight: bold;
          color: var(--dark-gray-100);
      }

      .issue-severities svg {
          margin-right: 5px;
      }

      .issue-severities p:first-child {
          color: var(--dark-gray-100);
      }

      .issue-severities > div {
          display: flex;
          align-items: center;
          color: var(--dark-gray-100);
      }

      .severity-level-count {
          display: flex;
      }

      .severity-level-count p {
          margin-right: 5px;
      }

      /*Table*/
      .table-wrapper {
          padding: 0 6px;
      }

      .table-wrapper + .table-wrapper {
          margin-top: 8px;
      }

      .table-row-count {
          display: flex;
          margin-right: auto;
          align-items: center;
          white-space: nowrap;
          gap: 6px;
          font: var(--table-title-size);
      }

      .table-container {
          overflow: auto;
      }

      .table {
          table-layout: fixed;
      }

      .table thead {
          position: sticky;
          top: 0;
          z-index: 9;
      }

      .table th {
          width: 250px;
          background-color: var(--widget-row-highlight-bg);
          color: var(--widget-text-color);
          font: var(--table-th-size);
          padding: 6px 12px;
          text-transform: uppercase;
          vertical-align: top;
          text-align: left;
      }


      .table th:nth-of-type(1) {
          min-width: 100px;
          max-width: 150px;
      }

      .table th:nth-of-type(4) {
          width: 300px;
      }

      .table td svg {
          padding-right: 5px;
      }

      .table tr:nth-child(even) {
          background-color: var(--table-color-even-row);
      }

      .table-resizable-line {
          position: absolute;
          inset: 3px 6px 3px auto;
          width: 2px;
          cursor: col-resize;
          user-select: none;
          background-color: rgb(98, 117, 163);
          z-index: 9;
      }

      .table-resizable-line::before, .table-resizable-line::after {
          content: '';
          position: absolute;
          inset: 0 auto;
          width: 6px;
      }

      .table-resizable-line::before {
          left: -6px;
      }

      .table-resizable-line::after {
          right: -6px;
      }

      .table td {
          padding: 8px 12px;
          font: var(--table-td-size);
          color: var(--widget-text-color);
          vertical-align: top;
      }

      .table-button {
          display: flex;
          align-items: center;
          gap: 6px;
      }

      .table-button-text {
          text-decoration: underline;
          line-height: 20px;
      }

      .table-button-icon {
          width: 20px;
          height: 20px;
      }

      .issue-type-accordion-item {
          margin-bottom: 10px;
      }

      .issue-type-accordion-toggle {
          display: flex;
          align-items: center;
          justify-content: space-between;
          width: 100%;
          padding: 10px;
          background-color: var(--sidebar-item-active-bg);
          border: none;
          cursor: pointer;
          text-align: left;
          position: relative;
          font-size: 14px;
          font: var(--sidebar-item-text-style);
          transition: background 0.3s;
      }

      .issue-type-accordion-toggle:hover {
          background: var(--divider-border-colcor);
      }

      .issue-type-accordion-toggle svg {
          margin-right: 10px;
      }

      .issue-type-accordion-content {
          display: block;
      }

      .issue-type-accordion-content.show {
          display: none;
      }

      .issue-type-accordion-toggle.active svg {
          transform: rotate(180deg);
      }

  </style>
</head>
<body>
<div class="wrapper">
  <div class="left-side divider-border-style" id="leftSide"></div>
  <div class="right-side" id="rightSide">
    <div class="header divider-border-style">
      <h1 class="header-title" id="headerTitle"></h1>
      <svg class="logo" fill="currentColor" xmlns="http://www.w3.org/2000/svg"
           viewBox="0 0 25 25">
        <path
          d="M23.8,11.73L18.8,2.78c-.27-.47-.76-.78-1.3-.78H7.49c-.54,0-1.03,.31-1.3,.78L1.2,11.73c-.27,.47-.27,1.06,0,1.53l5.02,8.95c.27,.47,.76,.75,1.3,.78h9.99c.54,0,1.03-.31,1.3-.78l4.99-8.95c.27-.47,.27-1.06,0-1.53ZM6,7.43l5.51-2.43v3.64c-1.39,.36-2.48,1.43-2.84,2.81h-2.67V7.43Zm5.5,12.57c-2.77-1.18-4.76-3.63-5.33-6.56h2.5c.36,1.38,1.45,2.45,2.84,2.81v3.75Zm.99-5.59c-1.1,0-1.98-.88-1.98-1.97h0c0-1.1,.89-1.97,1.99-1.97h0c1.1,0,1.98,.88,1.98,1.97h0c0,1.09-.89,1.97-1.99,1.97h0Zm1,5.59v-3.75c1.39-.36,2.48-1.43,2.84-2.81h2.5c-.57,2.93-2.57,5.39-5.34,6.56Zm5.51-8.54h-2.66c-.36-1.38-1.45-2.46-2.84-2.81v-3.65l5.5,2.43v4.03Z"
          fill-rule="evenodd"/>
      </svg>
    </div>
    <section class="main-content" id="mainContent">
    </section>
  </div>
</div>
</body>
<script>
    // JSON placeholder
    const actionListData = [{stepInstanceName}.JsonResult];

    const refactoredActionListData = formatInitialData(actionListData);

    // Constants for tooltip positioning
    const tooltipGap = 25;
    const tooltipTriangleHeight = 8;
    const tooltipTriangleMinGap = 5;
    const triangleWidth = 16;

    const tooltipDetectResizeObserver = new ResizeObserver((entries) => {
        for (const entry of entries) {
            const target = entry.target;
            if (target) {
                const {offsetWidth, scrollWidth} = target;
                if (scrollWidth > offsetWidth) {
                    target.addEventListener("mouseover", createTooltipListener);
                    target.addEventListener("mouseout", removeTooltipListener);
                } else {
                    target.removeEventListener("mouseover", createTooltipListener);
                    target.removeEventListener("mouseout", removeTooltipListener);
                }
            }
        }
    });

    // Constants for severity levels
    const issueNameVariants = {
        "vulnerabilities": {
            "singular": "vulnerability",
            "plural": "vulnerabilities",
        },
        "misconfigurations": {
            "singular": "misconfiguration",
            "plural": "misconfigurations",
        },
    };
    const severityIcons = {
        "unspecified": `
                <svg width="27" height="6" viewBox="0 0 27 6" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="3" cy="3" r="3" fill="#B2B6BD"/>
                <circle cx="10" cy="3" r="3" fill="#B2B6BD"/>
                <circle cx="17" cy="3" r="3" fill="#B2B6BD"/>
                <circle cx="24" cy="3" r="3" fill="#B2B6BD"/>
                </svg>
              `,
        "low": `
                <svg width="27" height="6" viewBox="0 0 27 6" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="3" cy="3" r="3" fill="#78D9EC"/>
                <circle cx="10" cy="3" r="3" fill="#B2B6BD"/>
                <circle cx="17" cy="3" r="3" fill="#B2B6BD"/>
                <circle cx="24" cy="3" r="3" fill="#B2B6BD"/>
                </svg>
              `,
        "medium": `
                <svg width="27" height="6" viewBox="0 0 27 6" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="3" cy="3" r="3" fill="#FFF371"/>
                <circle cx="10" cy="3" r="3" fill="#FFF371"/>
                <circle cx="17" cy="3" r="3" fill="#B2B6BD"/>
                <circle cx="24" cy="3" r="3" fill="#B2B6BD"/>
                </svg>
              `,
        "high": `
                <svg width="27" height="6" viewBox="0 0 27 6" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="3" cy="3" r="3" fill="#FA903E"/>
                <circle cx="10" cy="3" r="3" fill="#FA903E"/>
                <circle cx="17" cy="3" r="3" fill="#FA903E"/>
                <circle cx="24" cy="3" r="3" fill="#B2B6BD"/>
                </svg>
              `,
        "critical": `
                <svg width="27" height="6" viewBox="0 0 27 6" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="3" cy="3" r="3" fill="#EC453B"/>
                <circle cx="10" cy="3" r="3" fill="#EC453B"/>
                <circle cx="17" cy="3" r="3" fill="#EC453B"/>
                <circle cx="24" cy="3" r="3" fill="#EC453B"/>
                </svg>
              `,
    };

    const tableColumns = ["severity", "category", "eventTime", "description", "nextSteps"];

    // Get all elements "table"
    const tables = document.getElementsByClassName("table");

    // Convert the Set to an array
    const entityNamesArray = Object.keys(refactoredActionListData);

    let activeEntityName = entityNamesArray[0];
    headerTitle.textContent = activeEntityName;

    // Generate and display the left sidebar with buttons for each entity
    function generateLeftSideBar() {
        Array.from(entityNamesArray).map((key, index) => {
            const cleanDisplayValue = removeSpecialSymbols(key);
            const button = document.createElement("button");
            button.id = cleanDisplayValue;
            button.classList.add("left-side-item");
            button.setAttribute("data-menu", "item");
            if (index === 0) {
                button.classList.add("active");
            }
            renderWithTooltip(button, key);
            leftSide.append(button);
        });
        initializeSidebarEventsListener();
    }

    // Add event listener for left side menu item clicks
    function initializeSidebarEventsListener() {
        // Handle cases with a single entity
        if (entityNamesArray.length === 1) {
            leftSide.style.display = "none";
            rightSide.style.width = "100%";
            return;
        }

        // Handle clicks on left side menu items
        leftSide.addEventListener("click", event => {
            const target = event.target.closest("[data-menu='item']");
            if (!target) return;

            // Clear main content and create accordion items
            mainContent.innerHTML = "";

            // Update active entity and header title
            activeEntityName = target.innerText;
            headerTitle.textContent = activeEntityName;

            createAndAppendAccordionItems();

            // Render tooltip and update active menu item
            const firstMenuItem = document.querySelector(".left-side-item");
            if (firstMenuItem) {
                renderWithTooltip(firstMenuItem, firstMenuItem.innerText);
            }

            document.querySelectorAll("[data-menu='item']").forEach(item => item.classList.remove("active"));
            target.classList.add("active");

            // Scroll to the top of main content
            mainContent.scrollTop = 0;
        });
    }


    function addListItemsTooltip() {
        document.querySelectorAll(".left-side")[0].childNodes.forEach(button => {
            renderWithTooltip(button, button.innerText);
        });
    }

    function generateMainContent(activeEntityName, issueType) {
        const entityData = refactoredActionListData[activeEntityName][issueType];

        if (!entityData) return;
        updateCounter(issueType, entityData);
        getIssueSeveritiesView(issueType, entityData.statistics);
        if (Array.isArray(entityData.data) && entityData.data.length > 0) {
            generateTable(issueType, entityData.data);
        }
        for (let i = 0; i < tables.length; i++) {
            resizableGrid(tables[i]);
        }
    }

    function updateCounter(issueType, data) {
        const counter = document.createElement("div");
        counter.className = "counter";

        const counterNumber = document.createElement("h1");
        counterNumber.className = "counter-number";
        counterNumber.id = "counterNumber";

        const counterTitle = document.createElement("h2");
        counterTitle.className = "counter-title";
        counterTitle.id = "counterTitle";

        const rowCount = (data.data && data.data.length > 0) ? data.data.length : calculateCounterNumber(data.statistics) || 0;
        const issueLabel = rowCount === 1 ? issueNameVariants[issueType].singular : issueNameVariants[issueType].plural;
        counterTitle.innerText = `${issueLabel} FOUND`;
        counterNumber.innerText = rowCount;

        counter.appendChild(counterNumber);
        counter.appendChild(counterTitle);
        accordionItemId = document.getElementById(`${issueType}Content`);
        accordionItemId.appendChild(counter);
    }

    function calculateCounterNumber(statistics) {
        let sum = 0;
        for (let key in statistics) {
            if (statistics.hasOwnProperty(key)) {
                sum += statistics[key];
            }
        }
        return sum;
    }

    function generateTable(issueType, data) {
        // Create a new <div> element
        const tableContainer = document.createElement("div");
        tableContainer.id = "tableContainer";
        tableContainer.className = "table-container";
        tableContainer.innerHTML = "";
        const table = document.createElement("table");
        table.classList.add("table");
        tableContainer.append(table);
        const thead = document.createElement("thead");
        const tbody = document.createElement("tbody");
        const headerRow = document.createElement("tr");

        // Create table headers
        tableColumns.forEach(element => {
            const th = document.createElement("th");
            th.textContent = convertCamelCaseToTitleCase(element);
            headerRow.appendChild(th);
            th.setAttribute("data-tooltip", convertCamelCaseToTitleCase(element));
            th.setAttribute("data-item", "tooltip");
            th.classList.add("text-ellipsis");
        });
        thead.appendChild(headerRow);

        // Create table body rows
        data.forEach(result => {
            const bodyRow = document.createElement("tr");
            tableColumns.forEach(column => {
                const td = document.createElement("td");
                if (column === "severity") {
                    td.innerHTML = severityIcons[result[column].toLowerCase()];
                    const text = document.createElement("span");
                    text.textContent = convertCamelCaseToTitleCase(result[column]) || "N/A";
                    td.style.display = "flex";
                    td.style.alignItems = "center";
                    td.appendChild(text);
                } else {
                    td.textContent = result[column] || "N/A";
                    renderWithTooltip(td, td.innerText);
                }
                bodyRow.appendChild(td);
            });
            tbody.appendChild(bodyRow);
        });
        table.appendChild(thead);
        table.appendChild(tbody);
        tableContainer.appendChild(table);
        document.getElementById(`${issueType}Content`).appendChild(tableContainer);
    }

    /**
     * Converts camelCaseName to Title Case.
     */
    function convertCamelCaseToTitleCase(camelCaseName) {
        return camelCaseName
            .split(/(?<=[a-z])(?=[A-Z])/)
            .map((word, index) => {
                if (index === 0) {
                    return word.charAt(0).toUpperCase() + word.slice(1).toLowerCase();
                } else {
                    return word;
                }
            })
            .join(" ");
    }

    /**
     * Creates a tooltip with given text and position.
     */
    function createTooltip(text, x, y, trianglePointX, placeAtBottom, contentOverflowWindow) {
        removeTooltip();
        const tooltip = document.createElement("div");
        tooltip.classList.add("tooltip");
        tooltip.textContent = text;
        tooltip.style.left = `${x}px`;
        tooltip.style.top = `${y}px`;
        if (contentOverflowWindow) {
            tooltip.style.right = `${tooltipGap}px`;
        }
        const tooltipTriangle = document.createElement("span");
        tooltipTriangle.classList.add("tooltip-triangle");
        tooltipTriangle.style.left = `${trianglePointX}px`;
        if (placeAtBottom) {
            tooltipTriangle.style.top = "-8px";
            tooltipTriangle.style.borderTop = "0";
            tooltipTriangle.style.borderBottom = "solid 8px rgb(195, 210, 232)";
        }
        tooltip.append(tooltipTriangle);
        document.body.append(tooltip);
    }

    /**
     * Removes any existing tooltip from the DOM.
     */
    function removeTooltip() {
        const tooltip = document.querySelectorAll(".tooltip");
        tooltip.forEach((item) => {
            if (item) {
                item.remove();
            }
        });
    }

    /**
     * Sets a timeout to calculate and show tooltip position after a delay.
     */
    function createTooltipListener(event) {
        tooltipTimeout = setTimeout(() => calculateTooltipPosition(event), 1000);
    }

    /**
     * Clears any existing tooltip timeout and removes the tooltip.
     */
    function removeTooltipListener() {
        if (tooltipTimeout) {
            clearTimeout(tooltipTimeout);
        }
        removeTooltip();
    }

    /**
     * Calculates and positions the tooltip relative to the event target.
     */
    function calculateTooltipPosition(event) {
        const target = event.target;
        if (!target) {
            return;
        }
        const viewportWidth = window.innerWidth;
        const rect = target.getBoundingClientRect();
        const tooltipContent = document.createElement("div");
        tooltipContent.classList.add("tooltip");
        tooltipContent.style.top = "0";
        tooltipContent.textContent = target.textContent;
        document.body.appendChild(tooltipContent);
        let contentOverflowWindow = false;
        // Determine if window width would not be enough for content of tooltip
        if (tooltipGap * 2 + tooltipContent.offsetWidth >= viewportWidth) {
            // setting left, right positions to get correct tooltipContentWidth and tooltipContentHeight
            tooltipContent.style.left = `${tooltipGap}px`;
            tooltipContent.style.right = `${tooltipGap}px`;
            contentOverflowWindow = true;
        }
        const tooltipContentWidth = tooltipContent.offsetWidth;
        const tooltipContentHeight = tooltipContent.offsetHeight;
        tooltipContent.remove();
        const elementMidX = rect.left + (rect.width / 2);
        const placeOnRight = elementMidX + tooltipContentWidth / 2 + tooltipGap > viewportWidth;
        const x = Math.max(tooltipGap, placeOnRight ? viewportWidth - tooltipContentWidth - tooltipGap : elementMidX - tooltipContentWidth / 2);
        const placeAtBottom = rect.top < tooltipContentHeight;
        const y = placeAtBottom ? rect.bottom + tooltipTriangleHeight : rect.top - tooltipContentHeight;
        // Calculating trianglePointX relative to window width, to guarantee that it is not out of window
        const trianglePointX = Math.min(Math.max(elementMidX - x, tooltipTriangleMinGap), tooltipContentWidth - tooltipTriangleMinGap - triangleWidth);
        createTooltip(target.textContent, x, y, trianglePointX, placeAtBottom, contentOverflowWindow);
    }

    /**
     * Renders an item with text and sets up tooltip behavior.
     */
    function renderWithTooltip(item, text) {
        item.innerText = text;
        item.classList.add("text-ellipsis");
        tooltipDetectResizeObserver.observe(item);
    }

    /**
     * Function to make a table resizable
     */
    function resizableGrid(table) {
        const row = table.getElementsByTagName("tr")[0],
            cols = row ? row.children : undefined;
        if (!cols) return;

        for (let i = 0; i < cols.length; i++) {
            const div = createDiv();
            cols[i].appendChild(div);
            cols[i].style.position = "relative";
            setListeners(div);
        }

        function setListeners(div) {
            let pageX, curCol, nxtCol, curColWidth, nxtColWidth, tableWidth;

            div.addEventListener("mousedown", function (e) {
                curCol = e.target.parentElement;
                nxtCol = curCol.nextElementSibling;
                pageX = e.pageX;

                const padding = paddingDiff(curCol);

                curColWidth = curCol.offsetWidth - padding;
                if (nxtCol) {
                    nxtColWidth = nxtCol.offsetWidth - padding;
                }
            });

            document.addEventListener("mousemove", function (e) {
                if (curCol) {
                    const diffX = e.pageX - pageX;
                    if (nxtCol) {
                        nxtCol.style.width = nxtColWidth - diffX + "px";
                    }
                    curCol.style.width = curColWidth + diffX + "px";
                    table.style.width = tableWidth + diffX + "px";
                    removeTooltipListener();
                }
            });

            document.addEventListener("mouseup", function () {
                curCol = undefined;
                nxtCol = undefined;
                pageX = undefined;
                nxtColWidth = undefined;
                curColWidth = undefined;
                tableWidth = undefined;
            });
        }

        function createDiv() {
            const div = document.createElement("div");
            div.classList.add("table-resizable-line");
            return div;
        }

        function paddingDiff(col) {
            if (getStyleVal(col, "box-sizing") === "border-box") {
                return 0;
            }

            const padLeft = getStyleVal(col, "padding-left");
            const padRight = getStyleVal(col, "padding-right");
            return parseInt(padLeft) + parseInt(padRight);
        }

        function getStyleVal(elm, css) {
            return window.getComputedStyle(elm, null).getPropertyValue(css);
        }
    }

    for (let i = 0; i < tables.length; i++) {
        resizableGrid(tables[i]);
    }

    /**
     * Removes special symbols from a string.
     */
    function removeSpecialSymbols(str) {
        return str.replace(/[^\w\s]/gi, "");
    }

    function getIssueSeveritiesView(issueType, severities) {
        const issueSeverities = document.createElement("div");
        issueSeverities.className = "issue-severities";
        issueSeverities.id = "issueSeverities";
        for (const level in severities) {
            const severityLevelContainer = document.createElement("div");
            severityLevelContainer.className = `severity-${level}`;
            severityLevelContainer.innerHTML = severityIcons[getFirstPartBeforeUnderscore(level)];
            severityLevelCountContainer = document.createElement("div");
            severityLevelCountContainer.className = "severity-level-count";
            severityName = document.createElement("p");
            severityName.innerText = getFirstPartBeforeUnderscore(level).charAt(0).toUpperCase() + getFirstPartBeforeUnderscore(level).slice(1);
            severityCount = document.createElement("p");
            severityCount.innerText = severities[level];
            severityLevelCountContainer.appendChild(severityName);
            severityLevelCountContainer.appendChild(severityCount);
            severityLevelContainer.appendChild(severityLevelCountContainer);
            issueSeverities.appendChild(severityLevelContainer);
        }
        document.getElementById(`${issueType}Content`).appendChild(issueSeverities);
    }

    function getFirstPartBeforeUnderscore(string) {
        const regex = /severity_([^\s]+)/g;
        if (regex.test(string)) {
            return string.replace(regex, "$1");
        }
        return string;
    }

    // Helper function to merge statistics
    function mergeStatistics(statistics1, statistics2) {
        return {
            critical: (statistics1.critical || 0) + (statistics2.critical || 0),
            high: (statistics1.high || 0) + (statistics2.high || 0),
            medium: (statistics1.medium || 0) + (statistics2.medium || 0),
            low: (statistics1.low || 0) + (statistics2.low || 0),
            severity_unspecified: (statistics1.severity_unspecified || 0) + (statistics2.severity_unspecified || 0),
        };
    }

    // Helper function to merge arrays
    function mergeDatasets(array1, array2) {
        return [...array1, ...array2];
    }

    // Transforming data
    function formatInitialData(actionListData) {
        return actionListData.reduce((groupedData, item) => {
            const displayName = item.results.siemplify_asset_display_name;

            if (!groupedData[displayName]) {
                groupedData[displayName] = {};
            }

            if (item.results.vulnerabilities) {
                if (!groupedData[displayName].vulnerabilities) {
                    groupedData[displayName].vulnerabilities = item.results.vulnerabilities;
                } else {
                    groupedData[displayName].vulnerabilities.statistics = mergeStatistics(
                        groupedData[displayName].vulnerabilities.statistics,
                        item.results.vulnerabilities.statistics,
                    );
                    groupedData[displayName].vulnerabilities.data = mergeDatasets(
                        groupedData[displayName].vulnerabilities.data,
                        item.results.vulnerabilities.data,
                    );
                }
            }

            if (item.results.misconfigurations) {
                if (!groupedData[displayName].misconfigurations) {
                    groupedData[displayName].misconfigurations = item.results.misconfigurations;
                } else {
                    groupedData[displayName].misconfigurations.statistics = mergeStatistics(
                        groupedData[displayName].misconfigurations.statistics,
                        item.results.misconfigurations.statistics,
                    );
                    groupedData[displayName].misconfigurations.data = mergeDatasets(
                        groupedData[displayName].misconfigurations.data,
                        item.results.misconfigurations.data,
                    );
                }
            }

            return groupedData;
        }, {});
    }

    if (refactoredActionListData.length > 1) {
        addListItemsTooltip();
    }

    // Function to create accordion item
    function createAccordionItem(issueType) {
        const itemId = issueType + "Item";
        const buttonId = issueType;
        const contentId = issueType + "Content";

        const accordionItem = document.createElement("div");
        accordionItem.className = "issue-type-accordion-item";
        accordionItem.id = itemId;

        const button = document.createElement("button");
        button.className = "issue-type-accordion-toggle";
        button.id = buttonId;

        const span = document.createElement("span");
        span.className = "accordion-title";
        span.textContent = issueType.charAt(0).toUpperCase() + issueType.slice(1);

        // SVG content
        const svgContent = `<svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd" clip-rule="evenodd" d="M14.0943 11.8443C13.7868 12.1519 13.2882 12.1519 12.9807 11.8443L9.0375 7.90119L5.09435 11.8443C4.78681 12.1519 4.28819 12.1519 3.98065 11.8443C3.67312 11.5368 3.67312 11.0382 3.98065 10.7307L8.48065 6.23065C8.78819 5.92312 9.28681 5.92312 9.59435 6.23065L14.0943 10.7307C14.4019 11.0382 14.4019 11.5368 14.0943 11.8443Z" fill="#C3D2E8"/>
        </svg>`;

        // Insert the SVG directly into the button as HTML content
        button.innerHTML = `${span.outerHTML}${svgContent}`;

        const content = document.createElement("div");
        content.className = "issue-type-accordion-content";
        content.id = contentId;

        accordionItem.appendChild(button);
        accordionItem.appendChild(content);

        return accordionItem;
    }

    function createAndAppendAccordionItems() {
        Object.keys(refactoredActionListData[activeEntityName]).forEach(issueType => {
            const accordionItem = createAccordionItem(issueType);
            mainContent.appendChild(accordionItem);
            generateMainContent(activeEntityName, issueType);
        });
        setupAccordionToggleEventListeners();
    }

    /**
     * Sets up click event listeners for accordion toggle buttons.
     */
    function setupAccordionToggleEventListeners() {
        document.querySelectorAll(".issue-type-accordion-toggle").forEach(button => {
            button.addEventListener("click", () => {
                const contentId = button.id + "Content";
                const content = document.getElementById(contentId);

                button.classList.toggle("active");
                button.classList.toggle("show");

                if (content) {
                    content.classList.toggle("show");
                }
            });
        });
    }

    generateLeftSideBar();
    createAndAppendAccordionItems();
</script>
</html>