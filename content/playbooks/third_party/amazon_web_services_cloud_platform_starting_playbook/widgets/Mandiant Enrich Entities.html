<!-- Custom Widget / Integration Version when it was updated 12.0 -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700,700i"
        rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css?family=Source Sans Pro"
        rel="stylesheet"/>
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/flag-icon-css/css/flag-icon.min.css"/>
  <title>Enrich Entities</title>
  <style>
    /* Root Variables */
    :root {
      --widget-bg: rgb(33, 44, 68);
      --widget-font-family: 'Source Sans Pro', sans-serif;
      --widget-text-color: rgb(255, 255, 255);
      --widget-scrollbar-size: 12px;
      --widget-row-highlight-bg: rgb(47 61 91);

      /*Logo styles*/
      --logo-size: 48px;
      --logo-color: rgb(255, 255, 255);
      /*Logo styles*/

      --divider-border-colcor: rgb(98, 117, 163);
      --divider-border-width: 1px;

      --header-title-font: 600 16px/22px var(--widget-font-family);
      --list-item-key-font: 600 14px/18px var(--widget-font-family);
      --list-item-value-font: 400 14px/18px var(--widget-font-family);
      --additional-title-font: 600 14px/18px var(--widget-font-family);

      /*Sidebar styles*/
      --sidebar-width: 167px;
      --sidebar-item-text-style: 400 14px/18px var(--widget-font-family);
      --sidebar-item-text-style-active: 600 14px/16px var(--widget-font-family);
      --sidebar-item-active-bg: rgb(58, 74, 108);
      --sidebar-item-padding: 10px;

      /*Table styles*/
      --table-color-even-row: rgb(26 32 50);
      --table-title-size: 600 14px/18px var(--widget-font-family);
      --table-th-size: 600 12px/16px var(--widget-font-family);
      --table-td-size: 400 12px/16px var(--widget-font-family);
    }

    /*Normalize CSS */
    * {
      margin: 0;
      padding: 0;
      outline: none;
      box-sizing: border-box;
    }

    *:hover, *:focus, *:active {
      outline: none;
    }

    .list-item table {
      border-spacing: 6px;
    }

    ol, ul {
      list-style: none;
    }

    button,
    input,
    textarea {
      font-family: inherit;
      background: transparent;
      border: 0;
      color: inherit;
      text-align: left;
    }

    button, a[href] {
      cursor: pointer;
    }

    /*Normalize CSS */


    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 18px;
      height: 18px;
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(137, 151, 180, 1);
      border: 6px solid var(--widget-bg);
      border-radius: 63px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
      border: 4px solid transparent;
      border-radius: 44px;
    }

    ::-webkit-scrollbar-corner {
      background-color: transparent;
      border-color: transparent;
    }

    body {
      font-family: var(--widget-font-family), serif;
      color: var(--widget-text-color);
      background-color: var(--widget-bg);
      overflow: hidden;
    }

    /*Global styles*/
    .text-ellipsis {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .divider-border-style {
      border: 0;
      border-color: var(--divider-border-colcor);
      border-style: solid;
    }

    .tooltip {
      max-width: 100%;
      position: absolute;
      padding: 8px 16px 8px 16px;
      border-radius: 4px;
      background-color: rgb(204 204 218);
      color: rgb(22, 22, 37);
      font: 400 14px/18px var(--widget-font-family);
      z-index: 9;
      word-wrap: break-word;
    }

    .tooltip-triangle {
      position: absolute;
      top: 100%;
      border-top: solid 8px rgb(195, 210, 232);
      border-left: solid 8px transparent;
      border-right: solid 8px transparent;
    }

    .order-1 {
      order: 1;
    }

    .link, a {
      color: #669DF6;
      text-decoration-line: underline;
    }

    .link-icon {
      min-width: 14px;
      max-height: 14px
    }

    /*Global styles*/

    .wrapper {
      display: flex;
      height: 100vh;
    }

    /*left sidebar*/
    .left-side {
      min-width: var(--sidebar-width);
      max-width: var(--sidebar-width);
      padding-right: 6px;
      border-right-width: var(--divider-border-width);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      position: relative;
    }

    .left-side.collapsed {
      min-width: 0;
      max-width: 0;
    }

    .left-side-list {
      overflow-y: auto;
      flex: 1 auto;
    }

    .left-side-item {
      width: 100%;
      padding: var(--sidebar-item-padding);
      font: var(--sidebar-item-text-style);
    }

    .left-side-item.active {
      background-color: var(--sidebar-item-active-bg);
      font: var(--sidebar-item-text-style-active);
    }

    .left-side-toggle {
      width: 18px;
      height: 70px;
      position: absolute;
      right: -19px;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: rgba(38, 51, 79, 1);
      border-radius: 0 12px 12px 0;
    }

    .left-side-toggle-icon {
      width: 12px;
      height: 12px;
    }

    .left-side-toggle-icon.collapsed {
      transform: rotate(180deg);
    }

    /*left sidebar*/

    .right-side {
      display: flex;
      flex-direction: column;
      flex: 1 auto;
      width: calc(100% - 168px);
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 12px;
      padding-left: 6px;
      border-bottom-width: var(--divider-border-width);
    }

    .header-info {
      flex: 1 auto;
    }

    .header-title {
      font: var(--header-title-font);
      word-break: break-word;
      padding: 0 6px;
    }

    .header-info-type {
      font: 400 16px/22px var(--widget-font-family);
    }

    .header-info-title {
      display: flex;
      align-items: center;
      margin: 6px 0;
    }

    .header-info-title-logo {
      width: 24px;
      height: 24px;
    }

    .header-info-title-logo .flag-icon {
      max-width: 100%;
      max-height: 100%;
      width: 100%;
      height: 100%;
    }

    .header-info-activity {
      display: flex;
      align-items: center;
      gap: 12px;
      padding-bottom: 6px;
    }

    @media screen and (max-width: 700px) {
      .header-info-activity-item:nth-child(n+5) {
        display: none;
      }
    }

    @media screen and (max-width: 600px) {
      .header-info-activity-item:nth-child(n+3) {
        display: none;
      }
    }

    .header-info-activity-item-key {
      font: 600 14px/18px var(--widget-font-family);
    }

    .header-info-activity-item-value {
      font: 400 12px/16px var(--widget-font-family);
      display: flex;
      align-items: center;
      gap: 3px;
    }

    .header-info-activity-item-value-link {
      width: 12px;
      height: 12px;
    }

    .logo {
      min-width: var(--logo-size);
      min-height: var(--logo-size);
      max-width: var(--logo-size);
      max-height: var(--logo-size);
      color: var(--logo-color);
    }

    .main-content {
      flex: 1;
      overflow: auto;
    }

    .list {
      display: flex;
      flex-direction: column;
    }

    .list-item + .list-item {
      margin-top: 16px;
    }

    .list-item-button {
      padding: 0 6px;
      margin-top: 6px
    }

    .list-item-text-key {
      padding: 6px;
      margin-bottom: 8px;
      font: var(--list-item-key-font);
      background-color: rgb(47 61 91);
      position: sticky;
      top: 0;
      z-index: 9;
      text-transform: uppercase;
    }

    .list-item-text.collapsing {
      max-height: 40px;
      position: relative;
      overflow: hidden;
    }

    .list-item-text.collapsing::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 20px;
      background: linear-gradient(transparent, rgb(35 44 66));
    }

    .list-item-text-value {
      padding: 0 6px;
      font: var(--list-item-value-font);
    }

    .list-item-text-value ul {
      list-style: disc;
      padding-left: 16px
    }

    .tag {
      display: grid;
      grid-template-columns: repeat(4, auto);
      gap: 8px;
    }

    .tag-item {
      display: flex;
      align-items: center;
      overflow: hidden;
    }

    .tag-item-icon {
      min-width: 18px;
      min-height: 18px;
    }

    .flag-icon {
      min-width: 14px;
      min-height: 14px;
      max-width: 14px;
      max-height: 14px;
      border-radius: 50px;
      background-size: cover;
    }

    .confirmed-icon {
      width: 16px;
      min-width: 16px;
      height: 16px;
      min-height: 16px;
      color: rgb(152 205 193);
    }

    .list-item .table-score th {
      color: var(--widget-text-color);
      font: var(--table-th-size);
      padding: 3px 6px;
      text-transform: uppercase;
      vertical-align: top;
      text-align: center;
    }

    .list-item .table-score td {
      width: 200px;
      padding: 3px 6px;
      font: var(--table-th-size);
      color: var(--widget-text-color);
      vertical-align: top;
    }

    .list-item .table-score td.level-cell {
      background-color: var(--table-color-even-row);
    }

    .list-item .table-score td.level-cell.highlight, .list-item .table-score td.level-cell.highlighted {
      opacity: .2;
    }

    .list-item .table-score td.level-cell.highlighted.highlight {
      opacity: 1;
    }

    /*  indicator progress */

    .mscore-value-wrapper {
      display: flex;
      padding-top: 6px;
    }

    .mscore-value {
      font: 600 24px/28px var(--widget-font-family);
      display: flex;
      align-items: center;
      justify-content: center;
      max-width: 70px;
      flex: 1;
    }

    .mscore-wrapper {
      padding: 0 16px;
      border-left: 1px solid rgb(87 107 149);
      flex: 1;
    }

    .progress-verdict {
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .progress-verdict-logo {
      width: 18px;
      height: 18px;
    }

    .progress-verdict-info-title {
      font: 600 14px/18px var(--widget-font-family);
    }

    .progress-verdict-info-wrapper {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .progress-verdict-info-wrapper-title {
      font: 600 10px/14px var(--widget-font-family);
      color: rgb(87 107 149);
    }

    .progress-verdict-info-wrapper-date {
      font: 400 10px/14px var(--widget-font-family);
    }

    .progress-bar-container-text {
      font: 400 10px/18px var(--widget-font-family);
      display: flex;
      justify-content: space-between;
    }

    .progress-bar-container {
      width: 100%;
      height: 16px;
      border: 1px solid rgb(87 107 149);
      position: relative;
    }

    .progress-bar-wrapper {
      position: relative;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      position: absolute;
      top: 0;
    }

    .indicator-icon {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 2px;
      background-color: white;
      z-index: 1;
    }

    .indicator-icon::after {
      content: "";
      position: absolute;
      width: 0;
      height: 0;
      border-left: 8px solid transparent;
      border-right: 8px solid transparent;
      border-top: 8px solid white;
      top: -6px;
      left: -7px;
    }

    /*Table*/
    .table-wrapper {
      margin-top: 16px
    }

    .table-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 12px;
    }

    .table-container {
      overflow: auto;
    }

    .table {
      width: 100%;
      border-collapse: collapse;
    }

    .table thead {
      position: sticky;
      top: 0;
      z-index: 9;
    }

    .table th {
      width: 250px;
      background-color: var(--widget-row-highlight-bg);
      color: var(--widget-text-color);
      font: var(--table-th-size);
      padding: 6px 12px;
      text-transform: uppercase;
      vertical-align: top;
      text-align: left;
    }

    .table tr:nth-child(even) {
      background-color: var(--table-color-even-row);
    }

    .table-resizable-line {
      position: absolute;
      inset: 3px 6px 3px auto;
      width: 2px;
      cursor: col-resize;
      user-select: none;
      background-color: rgb(98, 117, 163);
      z-index: 9;
    }

    .table-resizable-line::before, .table-resizable-line::after {
      content: '';
      position: absolute;
      inset: 0 auto;
      width: 6px;
    }

    .table-resizable-line::before {
      left: -6px;
    }

    .table-resizable-line::after {
      right: -6px;
    }

    .table td {
      padding: 8px 12px;
      font: var(--table-td-size);
      color: var(--widget-text-color);
      vertical-align: top;
    }

    .table-button {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .table-button-text {
      text-decoration: underline;
      line-height: 20px;
    }

    .table-button-icon {
      width: 20px;
      height: 20px;
    }
  </style>
</head>
<body>
<div class="wrapper">
  <div class="left-side divider-border-style" id="leftSide">
    <div class="left-side-list" id="leftSideList"></div>
    <button class="left-side-toggle" id="leftSideToggle">
      <svg class="left-side-toggle-icon" id="leftSideToggleIcon" width="12" height="12"
           viewBox="0 0 12 12" fill="none"
           xmlns="http://www.w3.org/2000/svg">
        <rect width="12" height="12" fill="#26334F"/>
        <path d="M8.205 2.705L7.5 2L3.5 6L7.5 10L8.205 9.295L4.915 6" fill="white"/>
      </svg>
    </button>
  </div>
  <div class="right-side" id="rightSide">
    <div class="header divider-border-style">
      <div class="header-info">
        <div class="header-info-title">
          <span class="header-info-title-logo" id="headerInfoTitleLogo"></span>
          <h1 class="header-title" id="headerTitle"></h1>
        </div>
        <div class="header-info-activity" id="headerInfoActivity"></div>
      </div>
      <svg class="logo" fill="currentColor" id="a" viewbox="0 0 25 25"
           xmlns="http://www.w3.org/2000/svg">
        <path
          d="M19.6,13.11v8.85h3.37V9.61c-.91,0-1.75,.38-2.39,1.01-.64,.66-.98,1.54-.98,2.48Zm1.78-5.67c.47-.24,1.01-.31,1.55-.24h.03l.03-4.2h-3.33l-7.5,10.71L4.69,3H2V22h3.43V9.54l5.72,8.19h2.02l5.22-7.45c.34-.49,.74-.94,1.14-1.36l.03-.03c.5-.56,1.14-1.12,1.82-1.43Z">
        </path>
      </svg>
    </div>
    <section class="main-content" id="mainContent"></section>
  </div>
</div>
<script>
  // JSON placeholder [{stepInstanceName}.JsonResult]
  const actionListData = [{stepInstanceName}.JsonResult];

  // Constant for fields that are allowed to be modified
  const allowlistedFields = ["attributed_associations", "mscore", "date_of_disclosure", "exploitation_state", "mve_id", "risk_rating", "report_link", "type", "observed", "description", "aliases", "motivations", "industries", "malware", "tools", "locations", "cve", "associated_uncs", "executive_summary", "analysis", "exploitation_consequence", "exploitation_vectors", "vendor_fix_references", "sources"];

  // Constants for tooltip positioning
  const tooltipGap = 25;
  const tooltipTriangleHeight = 8;
  const tooltipTriangleMinGap = 5;
  const triangleWidth = 16;
  let tooltipTimeout = undefined;

  const tooltipDetectResizeObserver = new ResizeObserver((entries) => {
    for (const entry of entries) {
      const target = entry.target;
      if (target) {
        const {offsetWidth, scrollWidth} = target;
        if (scrollWidth > offsetWidth) {
          target.addEventListener("mouseover", createTooltipListener);
          target.addEventListener("mouseout", removeTooltipListener);
        } else {
          target.removeEventListener("mouseover", createTooltipListener);
          target.removeEventListener("mouseout", removeTooltipListener);
        }
      }
    }
  });

  // Filter actionListData based on allowlistedFields
  const filteredActionListData = actionListData
    .filter(el => el.Entity.trim() !== "" && Object.keys(el.EntityResult).length > 0)
    .map(el => {
      const filteredEntityResult = filterKeys(el.EntityResult, allowlistedFields);
      return {...el, EntityResult: filteredEntityResult};
    })
    .filter(el => Object.keys(el.EntityResult).length > 0);

  const RiskRatingColors = {
    Low: "rgba(120, 217, 236, 1)",
    Medium: "rgba(255, 243, 113, 1)",
    High: "rgba(250, 144, 62, 1)",
    Critical: "rgba(236, 69, 59, 1)",
  };

  function updateHeaderInfo(entityData) {
    const entityResult = entityData.EntityResult;

    if (entityResult.type === "threat-actor") {
      const sourceRegion = entityResult.locations.source[0].country;
      if (headerInfoTitleLogo && sourceRegion.iso2) {
        headerInfoTitleLogo.innerHTML = `<span class="flag-icon flag-icon-${sourceRegion.iso2.toLowerCase()}"></span>`;
      }

      const firstObserved = entityResult.observed[0];
      const firstActivity = firstObserved.earliest || "N/A";
      const lastActivity = firstObserved.recent || "N/A";
      const sourceRegionName = sourceRegion.name || "N/A";
      const reportLink = entityResult.report_link || "N/A";

      headerInfoActivity.innerHTML = `
      <div class="header-info-activity-item"><div class="header-info-activity-item-key">First Activity</div> <div class="header-info-activity-item-value">${formatDate(firstActivity)}</div></div>
      <div class="header-info-activity-item"><div class="header-info-activity-item-key">Last Activity</div> <div class="header-info-activity-item-value">${formatDate(lastActivity)}</div></div>
      <div class="header-info-activity-item"><div class="header-info-activity-item-key">Source Region</div> <div class="header-info-activity-item-value">${sourceRegionName}</div></div>
      <div class="header-info-activity-item"><div class="header-info-activity-item-key">View Report</div><div class="header-info-activity-item-value"><a class="link" href="${reportLink}" target="_blank">Report link</a><svg class="header-info-activity-item-value-link" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.3746 14.25H3.87494V3.75H9.12475V2.25H3.87494C3.04247 2.25 2.375 2.925 2.375 3.75V14.25C2.375 15.075 3.04247 15.75 3.87494 15.75H14.3746C15.1995 15.75 15.8745 15.075 15.8745 14.25V9H14.3746V14.25Z" fill="#8AB4F8"/><path d="M10.6252 2.25V3.75H13.3176L5.94537 11.1225L7.00283 12.18L14.3751 4.8075V7.5H15.875V2.25H10.6252Z" fill="#8AB4F8"/></svg></div></div>
`;
    } else if (entityResult.type === "vulnerability") {
      if (headerInfoTitleLogo) {
        headerInfoTitleLogo.innerHTML = `
        <svg class="header-info-title-logo" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 24 24">
          <path fill-rule="evenodd" d="M20.5 12a8.5 8.5 0 1 1-17 0 8.5 8.5 0 0 1 17 0Zm1.5 0c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2s10 4.477 10 10ZM9.205 17a1.14 1.14 0 0 1-.85-.367A1.225 1.225 0 0 1 8 15.75v-4.356c0-.343.118-.637.354-.882a1.14 1.14 0 0 1 .851-.367H9.4V8.709c0-.754.254-1.394.761-1.92A2.477 2.477 0 0 1 12.013 6c.728 0 1.345.263 1.852.79.508.525.762 1.165.762 1.919H13.4c0-.408-.133-.749-.399-1.024a1.318 1.318 0 0 0-.988-.414c-.393 0-.722.138-.988.414a1.418 1.418 0 0 0-.398 1.024v1.437h4.194c.324 0 .601.122.832.367.231.245.347.539.347.882v4.356c0 .343-.118.637-.354.882a1.14 1.14 0 0 1-.851.367h-5.59Z" clip-rule="evenodd"></path>
        </svg>
      `;
      }

      const riskMVEId = entityResult.mve_id || "N/A";
      const wasZeroDay = entityResult.was_zero_day ? "No" : "Yes";
      const observedInTheWild = entityResult.observed_in_the_wild ? "No" : "Yes";
      const riskRating = entityResult.risk_rating.toLowerCase() || "N/A";
      const exploitationState = entityResult.exploitation_state || "N/A";
      const dateOfDisclosure = entityResult.date_of_disclosure || "N/A";
      const reportLink = entityResult.report_link || "N/A";

      const riskRatingColor = RiskRatingColors[Object.keys(RiskRatingColors).find(key => key.toLowerCase() === riskRating)] || "rgb(255, 255, 255)";

      const exploitationStateColors = {
        "Wide": "rgb(255 90 80)",
        "Confirmed": "rgb(250 144 62)",
        "Available": "rgb(255 237 46)",
        "Anticipated": "rgb(66 195 208)",
        "No Known": "rgb(162 162 162)",
      };

      const exploitationStateColor = exploitationStateColors[exploitationState] || "rgb(255, 255, 255)";


      headerInfoActivity.innerHTML = `
      <div class="header-info-activity-item"><div class="header-info-activity-item-key">Risk Rating</div> <div class="header-info-activity-item-value" style="color: ${riskRatingColor};">${riskRating.charAt(0).toUpperCase() + riskRating.slice(1)}</div></div>
      <div class="header-info-activity-item"><div class="header-info-activity-item-key">Exploitation State</div><div class="header-info-activity-item-value" style="color: ${exploitationStateColor}">${exploitationState}</div></div>
      <div class="header-info-activity-item"><div class="header-info-activity-item-key">Exploited as Zero-Day</div><div class="header-info-activity-item-value">${wasZeroDay}</div></div>
      <div class="header-info-activity-item"><div class="header-info-activity-item-key">Exploited in the Wild</div><div class="header-info-activity-item-value">${observedInTheWild}</div></div>
      <div class="header-info-activity-item"><div class="header-info-activity-item-key">Date Of Disclosure</div> <div class="header-info-activity-item-value">${formatDate(dateOfDisclosure)}</div></div>
      <div class="header-info-activity-item"><div class="header-info-activity-item-key">MVE ID</div> <div class="header-info-activity-item-value">${riskMVEId}</div></div>
      <div class="header-info-activity-item"><div class="header-info-activity-item-key">View Report</div><div class="header-info-activity-item-value"><a class="link" href="${reportLink}" target="_blank">Report link</a><svg class="header-info-activity-item-value-link" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.3746 14.25H3.87494V3.75H9.12475V2.25H3.87494C3.04247 2.25 2.375 2.925 2.375 3.75V14.25C2.375 15.075 3.04247 15.75 3.87494 15.75H14.3746C15.1995 15.75 15.8745 15.075 15.8745 14.25V9H14.3746V14.25Z" fill="#8AB4F8"/><path d="M10.6252 2.25V3.75H13.3176L5.94537 11.1225L7.00283 12.18L14.3751 4.8075V7.5H15.875V2.25H10.6252Z" fill="#8AB4F8"/></svg></div></div>
    `;
    } else {

      if (headerInfoTitleLogo) {
        headerInfoTitleLogo.innerHTML = `
        <svg class="header-info-title-logo" width="1em" height="1em" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
<path d="M1.88954 9.24511C1.73441 9.14506 1.64243 9.01346 1.61362 8.85034C1.58481 8.6872 1.62803 8.51863 1.74327 8.34461C2.93409 6.62366 4.42743 5.29293 6.22327 4.35241C8.01911 3.41189 9.93499 2.94163 11.9709 2.94163C14.0068 2.94163 15.9323 3.39188 17.7474 4.29237C19.5624 5.19287 21.0663 6.51265 22.2591 8.25171C22.3916 8.43371 22.4338 8.60976 22.3858 8.77986C22.3378 8.94995 22.2466 9.08502 22.1121 9.18508C21.9777 9.28514 21.8336 9.3296 21.68 9.31847C21.5263 9.30737 21.3919 9.21288 21.2766 9.035C20.2395 7.47413 18.8947 6.28348 17.2424 5.46302C15.59 4.64257 13.8374 4.23234 11.9845 4.23234C10.1316 4.23234 8.39364 4.64257 6.77066 5.46302C5.14768 6.28348 3.80801 7.47413 2.75163 9.035C2.61718 9.23511 2.47313 9.34517 2.31948 9.36518C2.16582 9.38519 2.02251 9.34517 1.88954 9.24511ZM15.2841 23.9833C13.2482 23.483 11.5916 22.4474 10.3143 20.8765C9.03707 19.3057 8.39844 17.3996 8.39844 15.1584C8.39844 14.1578 8.74698 13.3124 9.44405 12.622C10.1411 11.9316 10.9834 11.5864 11.9709 11.5864C12.9584 11.5864 13.8007 11.9266 14.4978 12.607C15.1949 13.2873 15.5434 14.1278 15.5434 15.1284C15.5434 15.7687 15.7777 16.314 16.2463 16.7643C16.7149 17.2145 17.2678 17.4396 17.9051 17.4396C18.5424 17.4396 19.086 17.2145 19.5359 16.7643C19.9857 16.314 20.2107 15.7641 20.2107 15.1145C20.2107 12.831 19.4029 10.9117 17.7873 9.35657C16.1717 7.80145 14.2425 7.02388 11.9997 7.02388C9.7648 7.02388 7.84237 7.80564 6.23246 9.36914C4.62256 10.9326 3.81761 12.8524 3.81761 15.1284C3.81761 15.6487 3.86082 16.269 3.94726 16.9894C4.03369 17.7098 4.23056 18.5202 4.53787 19.4207C4.59549 19.6165 4.58588 19.7905 4.50906 19.9428C4.43223 20.095 4.31699 20.2012 4.16333 20.2612C4.00968 20.3212 3.85122 20.3112 3.68796 20.2312C3.5247 20.1511 3.41427 20.0345 3.35664 19.8812C3.06854 19.134 2.86687 18.3686 2.75163 17.5851C2.63639 16.8017 2.57877 15.9927 2.57877 15.1584C2.57877 12.4884 3.50267 10.25 5.35046 8.44331C7.19825 6.63655 9.40507 5.73317 11.9709 5.73317C14.5638 5.73317 16.7918 6.63867 18.6549 8.44967C20.518 10.2607 21.4495 12.4869 21.4495 15.1284C21.4495 16.1546 21.1058 17.0115 20.4183 17.699C19.7309 18.3866 18.8934 18.7304 17.9058 18.7304C16.9184 18.7304 16.0713 18.3894 15.3646 17.7076C14.6579 17.0258 14.3045 16.176 14.3045 15.1584C14.3045 14.5149 14.0753 13.9739 13.6168 13.5352C13.1583 13.0965 12.6109 12.8771 11.9746 12.8771C11.3383 12.8771 10.7897 13.0965 10.3287 13.5352C9.86777 13.9739 9.63728 14.5149 9.63728 15.1584C9.63728 17.0909 10.1895 18.7047 11.2939 19.9996C12.3983 21.2946 13.834 22.2023 15.601 22.7226C15.7854 22.7861 15.9083 22.8921 15.9698 23.0404C16.0312 23.1887 16.0412 23.3464 15.9997 23.5134C15.9583 23.6596 15.8753 23.7845 15.7508 23.888C15.6264 23.9915 15.4708 24.0233 15.2841 23.9833ZM5.60385 2.97164C5.44059 3.0717 5.27733 3.09671 5.11407 3.04668C4.95081 2.99666 4.82837 2.8916 4.74674 2.73151C4.66511 2.57142 4.64831 2.41634 4.69632 2.26625C4.74434 2.11617 4.84518 1.99035 4.99883 1.88879C6.07441 1.27952 7.19801 0.812399 8.36963 0.48744C9.54125 0.16248 10.7369 0 11.9567 0C13.1958 0 14.4059 0.155086 15.5869 0.465257C16.7679 0.775429 17.9058 1.22068 19.0006 1.801C19.1927 1.90105 19.3031 2.03112 19.3319 2.19121C19.3607 2.3513 19.3463 2.51139 19.2887 2.67148C19.2311 2.83157 19.1295 2.94663 18.9838 3.01667C18.8382 3.08671 18.6613 3.0717 18.4532 2.97164C17.4353 2.43134 16.3837 2.01612 15.2985 1.72595C14.2133 1.43579 13.1041 1.29071 11.9709 1.29071C10.8569 1.29071 9.76213 1.42579 8.68654 1.69594C7.61096 1.96609 6.5834 2.39132 5.60385 2.97164ZM8.97465 23.563C7.84144 22.3223 6.97714 21.0537 6.38172 19.757C5.78631 18.4604 5.4886 16.9275 5.4886 15.1584C5.4886 13.3374 6.12243 11.8015 7.39008 10.5508C8.65773 9.30014 10.1847 8.6748 11.9709 8.6748C13.7572 8.6748 15.2937 9.29725 16.5806 10.5422C17.8674 11.787 18.5108 13.3158 18.5108 15.1284C18.5108 15.3265 18.4561 15.4861 18.3467 15.6071C18.2373 15.7282 18.0931 15.7887 17.9141 15.7887C17.7549 15.7887 17.6081 15.7282 17.4737 15.6071C17.3392 15.4861 17.272 15.3265 17.272 15.1284C17.272 13.6676 16.7471 12.4369 15.6973 11.4363C14.6476 10.4358 13.4039 9.9355 11.9664 9.9355C10.5289 9.9355 9.29636 10.4408 8.2688 11.4513C7.24123 12.4619 6.72745 13.6976 6.72745 15.1584C6.72745 16.7709 6.98674 18.1396 7.50532 19.2644C8.02391 20.3892 8.80179 21.5219 9.83895 22.6625C9.9734 22.7935 10.0406 22.9463 10.0406 23.121C10.0406 23.2956 9.98301 23.448 9.86777 23.578C9.75252 23.7081 9.6076 23.7731 9.43299 23.7731C9.25838 23.7731 9.1056 23.7031 8.97465 23.563ZM17.7618 21.5219C16.014 21.5219 14.5062 20.9266 13.2386 19.7359C11.9709 18.5453 11.3371 17.0118 11.3371 15.1356C11.3371 14.9707 11.3899 14.8232 11.4955 14.6931C11.6012 14.5631 11.7494 14.498 11.9401 14.498C12.1309 14.498 12.2845 14.5611 12.4011 14.6871C12.5176 14.8132 12.5759 14.9603 12.5759 15.1284C12.5759 16.6492 13.0945 17.8799 14.1317 18.8204C15.1689 19.7609 16.3789 20.2312 17.7618 20.2312C17.8962 20.2312 18.0643 20.2212 18.266 20.2012C18.4676 20.1812 18.6869 20.1511 18.9238 20.1111C19.1014 20.0711 19.2544 20.0997 19.3828 20.1969C19.5111 20.2941 19.595 20.4456 19.6344 20.6514C19.6729 20.8195 19.6392 20.9666 19.5336 21.0927C19.428 21.2187 19.3013 21.3018 19.1535 21.3418C18.8211 21.4419 18.5252 21.4969 18.266 21.5069C18.0067 21.5169 17.8386 21.5219 17.7618 21.5219Z" fill="white"/>
</svg>`;
      }

      const reportLink = entityResult.report_link || "N/A";

      headerInfoActivity.innerHTML = `
      <div class="header-info-activity-item"><div class="header-info-activity-item-key">View Report</div><div class="header-info-activity-item-value"><a class="link" href="${reportLink}" target="_blank">Report link</a><svg class="header-info-activity-item-value-link" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.3746 14.25H3.87494V3.75H9.12475V2.25H3.87494C3.04247 2.25 2.375 2.925 2.375 3.75V14.25C2.375 15.075 3.04247 15.75 3.87494 15.75H14.3746C15.1995 15.75 15.8745 15.075 15.8745 14.25V9H14.3746V14.25Z" fill="#8AB4F8"/><path d="M10.6252 2.25V3.75H13.3176L5.94537 11.1225L7.00283 12.18L14.3751 4.8075V7.5H15.875V2.25H10.6252Z" fill="#8AB4F8"/></svg></div></div>`;
    }
  }

  if (leftSide) {
    leftSideToggle.addEventListener("click", () => {
      leftSide.classList.toggle("collapsed");
      if (leftSide.classList.contains("collapsed")) {
        leftSideToggleIcon.classList.add("collapsed");
      } else {
        leftSideToggleIcon.classList.remove("collapsed");
      }
    });
  }

  // Update the UI with filtered data
  if (filteredActionListData.length > 0) {
    renderKeysInUI(flattenKeys(filteredActionListData[0].EntityResult));

    headerTitle.textContent = filteredActionListData[0].Entity;
    updateHeaderInfo(filteredActionListData[0]);

    filteredActionListData.forEach((el, index) => {
      const displayValue = el.Entity;
      const cleanDisplayValue = removeSpecialSymbols(displayValue);
      const button = document.createElement("button");
      button.id = cleanDisplayValue;
      button.classList.add("left-side-item");
      button.setAttribute("data-menu", "item");
      if (index === 0) {
        button.classList.add("active");
      }
      renderWithTooltip(button, displayValue);
      leftSideList.append(button);
    });

    if (filteredActionListData.length === 1) {
      leftSide.remove();
    } else {
      mainContent.style.paddingLeft = "22px";
      leftSide.addEventListener("click", event => {
        const target = event.target.closest("[data-menu='item']");
        if (!target) return;

        const id = target.id;
        const object = filteredActionListData.find(el => removeSpecialSymbols(el.Entity) === id);

        if (object) {
          mainContent.innerHTML = "";
          renderKeysInUI(flattenKeys(object.EntityResult));
          headerTitle.textContent = object.Entity;
          updateHeaderInfo(object);
        }
        document.querySelectorAll("[data-menu='item']").forEach(item => item.classList.remove("active"));
        target.classList.add("active");

        mainContent.scrollTop = 0;
      });
    }
  }

  /**
   * Recursively flattens a nested object into an array of { key, value } pairs.
   */
  function flattenKeys(obj, parentKey = "", sep = " ") {
    let keys = [];
    for (let key in obj) {
      if (obj.hasOwnProperty(key)) {
        let combinedKey = parentKey ? `${parentKey}${sep}${key}` : key;

        if (Array.isArray(obj[key])) {
          keys.push({key: combinedKey, value: obj[key]});
        } else if (typeof obj[key] === "object" && obj[key] !== null) {
          let nestedKeys = flattenKeys(obj[key], combinedKey, sep);
          keys = [...keys, ...nestedKeys];
        } else {
          keys.push({key: combinedKey, value: obj[key]});
        }
      }
    }

    return keys;
  }

  /**
   * Renders keys and their corresponding values in the UI.
   */
  function renderKeysInUI(keys) {
    const container = document.getElementById("mainContent");
    const listContainer = document.createElement("div");
    listContainer.classList.add("list");

    let isRiskRatingRendered = true;
    let vulnerability = true;

    keys.forEach(({key, value}) => {
      // Exclude specific keys from rendering
      if (key === "attributed_associations" || key === "mscore" || key === "sources" || key === "exploitation_state" || key === "risk_rating" || key === "date_of_disclosure" || key === "report_link" || key === "mve_id" || key === "locations source" || key === "locations target_sub_region" || key === "locations target_region" || key === "type" || key === "observed") {
        return;
      }

      const listItem = document.createElement("div");
      listItem.classList.add("list-item");
      const listItemButton = document.createElement("button");
      listItemButton.textContent = `Show more`;
      listItemButton.classList.add("link", "list-item-button");

      const keyElement = document.createElement("div");
      keyElement.classList.add("list-item-text", "list-item-text-key");
      renderWithTooltip(keyElement, convertCamelCaseToTitleCase(key));

      const valueElement = document.createElement("div");

      // Render special cases based on the key
      if (key === "locations target") {
        valueElement.classList.add("list-item-text", "tag");
        value.forEach(location => {
          const locationItem = document.createElement("div");
          const locationName = document.createElement("span");
          locationItem.classList.add("tag-item");
          locationName.classList.add("list-item-text-value");
          const flagIcon = document.createElement("span");
          flagIcon.classList.add("flag-icon", `flag-icon-${location.iso2.toLowerCase()}`);
          locationItem.appendChild(flagIcon);
          locationItem.appendChild(locationName);
          renderWithTooltip(locationName, location.name);
          if (location.attribution_scope === "confirmed") {
            locationItem.appendChild(generateConfirmedIcon());
            locationItem.classList.add("order-1");
          }
          valueElement.appendChild(locationItem);
        });
      } else if (key === "malware") {
        valueElement.classList.add("list-item-text", "tag");
        value.forEach(item => {
          const malwareItem = document.createElement("div");
          const malwareName = document.createElement("span");
          malwareItem.classList.add("tag-item");
          malwareName.classList.add("list-item-text-value");
          renderWithTooltip(malwareName, item.name);
          malwareItem.innerHTML = getMalwareIcon();
          malwareItem.appendChild(malwareName);
          if (item.attribution_scope === "confirmed") {
            malwareItem.appendChild(generateConfirmedIcon());
            malwareItem.classList.add("order-1");
          }
          valueElement.appendChild(malwareItem);
        });
      } else if (key === "tools") {
        valueElement.classList.add("list-item-text", "tag");
        value.forEach(item => {
          const toolItem = document.createElement("div");
          const toolName = document.createElement("span");
          toolItem.classList.add("tag-item");
          toolName.classList.add("list-item-text-value");
          renderWithTooltip(toolName, item.name);
          toolItem.innerHTML = getToolsIcon();
          toolItem.appendChild(toolName);
          if (item.attribution_scope === "confirmed") {
            toolItem.appendChild(generateConfirmedIcon());
            toolItem.classList.add("order-1");
          }
          valueElement.appendChild(toolItem);
        });
      } else if (key === "cve") {
        valueElement.classList.add("list-item-text", "tag");
        value.forEach(item => {
          const cveItem = document.createElement("div");
          const cveName = document.createElement("span");
          cveItem.classList.add("tag-item");
          cveName.classList.add("list-item-text-value");
          renderWithTooltip(cveName, item.cve_id);
          cveItem.innerHTML = getCveIcon();
          cveItem.appendChild(cveName);
          if (item.attribution_scope === "confirmed") {
            cveItem.appendChild(generateConfirmedIcon());
            cveItem.classList.add("order-1");
          }
          valueElement.appendChild(cveItem);
        });
      } else if (key === "associated_uncs") {
        valueElement.classList.add("list-item-text", "tag");
        value.forEach(item => {
          const uncItem = document.createElement("div");
          const uncName = document.createElement("span");
          uncItem.classList.add("tag-item");
          uncName.classList.add("list-item-text-value");
          renderWithTooltip(uncName, item.name);
          uncItem.innerHTML = getAssociatedUncsIcon();
          uncItem.appendChild(uncName);
          if (item.attribution_scope === "confirmed") {
            uncItem.appendChild(generateConfirmedIcon());
            uncItem.classList.add("order-1");
          }
          valueElement.appendChild(uncItem);
        });
      } else if (key === "motivations") {
        valueElement.classList.add("list-item-text", "tag");
        value.forEach(item => {
          const motivationItem = document.createElement("div");
          const motivationName = document.createElement("span");
          motivationItem.classList.add("tag-item");
          motivationName.classList.add("list-item-text-value");
          renderWithTooltip(motivationName, item.name);
          motivationItem.innerHTML = getMotivationIcon(item.name);
          motivationItem.appendChild(motivationName);
          if (item.attribution_scope === "confirmed") {
            motivationItem.appendChild(generateConfirmedIcon());
            motivationItem.classList.add("order-1");
          }
          valueElement.appendChild(motivationItem);
        });
      } else if (key === "industries") {
        valueElement.classList.add("list-item-text", "tag");
        value.forEach(item => {
          const industryItem = document.createElement("div");
          const industryName = document.createElement("span");
          industryItem.classList.add("tag-item");
          industryName.classList.add("list-item-text-value");
          renderWithTooltip(industryName, item.name);
          industryItem.innerHTML = getIndustriesIcon(item.name);
          industryItem.appendChild(industryName);
          if (item.attribution_scope === "confirmed") {
            industryItem.appendChild(generateConfirmedIcon());
            industryItem.classList.add("order-1");
          }
          valueElement.appendChild(industryItem);
        });
      } else if (key === "vendor_fix_references") {
        listItem.classList.add("order-1");
        valueElement.classList.add("list-item-text", "tag");
        value.forEach(item => {
          const fixReferenceItem = document.createElement("div");
          const fixReferenceLink = document.createElement("a");
          const fixReferenceLinkIcon = document.createElement("span");
          fixReferenceLink.href = item.url;
          fixReferenceLink.target = "_blank";
          fixReferenceItem.classList.add("tag-item");
          fixReferenceLink.classList.add("list-item-text-value", "link");
          fixReferenceLinkIcon.classList.add("link-icon");
          fixReferenceItem.appendChild(fixReferenceLink);
          renderWithTooltip(fixReferenceLink, item.url);
          fixReferenceLinkIcon.innerHTML += `<svg viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.3746 14.25H3.87494V3.75H9.12475V2.25H3.87494C3.04247 2.25 2.375 2.925 2.375 3.75V14.25C2.375 15.075 3.04247 15.75 3.87494 15.75H14.3746C15.1995 15.75 15.8745 15.075 15.8745 14.25V9H14.3746V14.25Z" fill="#8AB4F8"/><path d="M10.6252 2.25V3.75H13.3176L5.94537 11.1225L7.00283 12.18L14.3751 4.8075V7.5H15.875V2.25H10.6252Z" fill="#8AB4F8"/></svg>`;
          fixReferenceItem.appendChild(fixReferenceLinkIcon);
          valueElement.appendChild(fixReferenceItem);
        });
      } else if (Array.isArray(value)) {
        valueElement.classList.add("list-item-text", "tag");
        value.forEach(item => {
          const arrayItem = document.createElement("div");
          const arrayItemName = document.createElement("span");
          arrayItem.classList.add("tag-item");
          arrayItemName.classList.add("list-item-text-value");
          renderWithTooltip(arrayItemName, item.name || item.earliest || item);
          arrayItem.appendChild(arrayItemName);
          if (item.attribution_scope === "confirmed") {
            arrayItem.appendChild(generateConfirmedIcon());
            arrayItem.classList.add("order-1");
          }
          valueElement.appendChild(arrayItem);
        });
      } else {
        valueElement.classList.add("list-item-text", "list-item-text-value");
        valueElement.innerHTML = value;
      }

      listItemButton.addEventListener("click", function () {
        if (valueElement.classList.contains("collapsing")) {
          valueElement.classList.remove("collapsing");
          listItemButton.textContent = `Show less`;
        } else {
          valueElement.classList.add("collapsing");
          listItemButton.textContent = `Show more`;
        }
      });

      if (valueElement.textContent || valueElement.innerHTML) {
        listItem.appendChild(keyElement);
        listItem.appendChild(valueElement);

        function checkHeight() {
          if (valueElement.scrollHeight > 40) {
            listItem.appendChild(listItemButton);
            valueElement.classList.add("collapsing");
          }
        }

        setTimeout(checkHeight, 0);
        listContainer.appendChild(listItem);
      }
    });

    keys.forEach(({key, value}) => {
      if (key === "exploitation_state" && isRiskRatingRendered) {
        const keyElement = document.createElement("div");
        keyElement.classList.add("list-item-text", "list-item-text-key");
        renderWithTooltip(keyElement, `Exploitation State and Risk Rating`);

        const listItem = document.createElement("div");
        listItem.classList.add("list-item");
        const states = ["Wide", "Confirmed", "Available", "Anticipated", "No Known"];
        const levels = ["Low", "Medium", "High", "Critical"];

        const tableElement = document.createElement("table");
        tableElement.classList.add("table-score");

        const headerRow = document.createElement("tr");
        const emptyHeaderCell = document.createElement("th");
        headerRow.appendChild(emptyHeaderCell);

        levels.forEach(level => {
          const headerCell = document.createElement("th");
          headerCell.textContent = level;
          headerRow.appendChild(headerCell);
        });
        tableElement.appendChild(headerRow);

        states.forEach(state => {
          const stateRow = document.createElement("tr");

          const stateCell = document.createElement("td");
          stateCell.classList.add("state-name");
          stateCell.textContent = state;
          stateRow.appendChild(stateCell);

          levels.forEach((level) => {
            const levelCell = document.createElement("td");
            levelCell.classList.add("level-cell");

            if (state === value) {
              levelCell.classList.add("highlighted");
              levelCell.style.backgroundColor = RiskRatingColors[level];
            }

            if (level.toUpperCase() === keys.find(k => k.key === "risk_rating")?.value.toUpperCase()) {
              levelCell.classList.add("highlight");
              levelCell.style.backgroundColor = RiskRatingColors[level];
            }

            stateRow.appendChild(levelCell);
          });

          tableElement.appendChild(stateRow);
        });

        listItem.appendChild(keyElement);
        listItem.appendChild(tableElement);

        listContainer.appendChild(listItem);
      }
    });

    keys.forEach(({key, value}) => {
      if (key === "mscore") {
        const listItem = document.createElement("div");
        listItem.classList.add("list-item", "mscore-value-wrapper");

        const mscoreWrapper = document.createElement("div");
        mscoreWrapper.classList.add("mscore-wrapper");

        const progressBarContainer = document.createElement("div");
        progressBarContainer.classList.add("progress-bar-container");

        const progressBarContainerText = document.createElement("div");
        progressBarContainerText.classList.add("progress-bar-container-text");

        progressBarContainerText.innerHTML = `<span>BENIGN</span><span>INDETERMINATE</span><span>MALICIOUS</span>`;

        const progressBarWrapper = document.createElement("div");
        progressBarWrapper.classList.add("progress-bar-wrapper");

        const progressBar = document.createElement("div");
        progressBar.classList.add("progress-bar");

        const indicatorIcon = document.createElement("div");
        indicatorIcon.classList.add("indicator-icon");

        const mscoreValue = parseFloat(value);
        const percentage = Math.abs(mscoreValue - 50);

        if (mscoreValue >= 50) {
          progressBar.style.width = `${percentage}%`;
          progressBar.style.background = `linear-gradient(90deg, rgb(176, 185, 195) 10%,  rgb(204, 0, 0) 100%)`;
          progressBar.style.left = `50%`;
          indicatorIcon.style.left = `calc(50% + ${percentage}%)`;
        } else {
          progressBar.style.width = `${percentage}%`;
          progressBar.style.background = `linear-gradient(90deg, rgb(0, 85, 255) 10%, rgb(176, 185, 195) 100%)`;
          progressBar.style.left = `${50 - percentage}%`;
          indicatorIcon.style.left = `calc(50% - ${percentage}%)`;
        }

        const mscoreValueElem = document.createElement("div");
        mscoreValueElem.classList.add("mscore-value");
        mscoreValueElem.textContent = value;

        progressBarContainer.appendChild(progressBarWrapper);
        progressBarContainer.appendChild(indicatorIcon);
        progressBarWrapper.appendChild(progressBar);

        mscoreWrapper.appendChild(progressBarContainer);
        mscoreWrapper.appendChild(progressBarContainerText);
        listItem.appendChild(mscoreValueElem);
        listItem.appendChild(mscoreWrapper);

        // Append to the list container
        listContainer.appendChild(listItem);
      }
    });

    container.appendChild(listContainer);

    keys.forEach(({key, value}) => {
      if (value === "vulnerability") {
        vulnerability = false;
      } else {
        if (Array.isArray(value) && key === "sources" && vulnerability) {
          const tableWrapper = document.createElement("div");
          tableWrapper.classList.add("table-wrapper");

          const keyElement = document.createElement("div");
          keyElement.classList.add("list-item-text", "list-item-text-key");
          renderWithTooltip(keyElement, convertCamelCaseToTitleCase(key));

          tableWrapper.appendChild(keyElement);

          const tableContainer = document.createElement("div");
          const table = document.createElement("table");
          tableContainer.classList.add("table-container");
          table.classList.add("table");
          tableContainer.appendChild(table);
          tableWrapper.appendChild(tableContainer);

          const thead = document.createElement("thead");
          const tbody = document.createElement("tbody");
          table.appendChild(thead);
          table.appendChild(tbody);

          const headers = ["source_name", "first_seen", "last_seen"];
          const headerRow = document.createElement("tr");
          headers.forEach(header => {
            const th = document.createElement("th");
            th.textContent = convertCamelCaseToTitleCase(header);
            renderWithTooltip(th, convertCamelCaseToTitleCase(header));
            headerRow.appendChild(th);
          });
          thead.appendChild(headerRow);

          const rows = value.map(({first_seen, last_seen, source_name}) => {
            return [
              source_name || "N/A",
              first_seen || "N/A",
              last_seen || "N/A",
            ];
          });

          rows.forEach(rowData => {
            const row = document.createElement("tr");
            rowData.forEach(cellData => {
              const td = document.createElement("td");
              td.textContent = cellData;
              renderWithTooltip(td, formatDate(cellData));
              row.appendChild(td);
            });
            tbody.appendChild(row);
          });

          mainContent.appendChild(tableWrapper);
        }
      }

    });

    keys.forEach(({key, value}) => {
      if (Array.isArray(value) && key === "attributed_associations") {
        const tableWrapper = document.createElement("div");
        tableWrapper.classList.add("table-wrapper");

        const keyElement = document.createElement("div");
        keyElement.classList.add("list-item-text", "list-item-text-key");
        renderWithTooltip(keyElement, convertCamelCaseToTitleCase("Associations"));

        tableWrapper.appendChild(keyElement);

        const tableContainer = document.createElement("div");
        const table = document.createElement("table");
        tableContainer.classList.add("table-container");
        table.classList.add("table");
        tableContainer.appendChild(table);
        tableWrapper.appendChild(tableContainer);

        const thead = document.createElement("thead");
        const tbody = document.createElement("tbody");
        table.appendChild(thead);
        table.appendChild(tbody);

        const headers = ["Name", "Type"];
        const headerRow = document.createElement("tr");
        headers.forEach(header => {
          const th = document.createElement("th");
          th.textContent = convertCamelCaseToTitleCase(header);
          renderWithTooltip(th, convertCamelCaseToTitleCase(header));
          headerRow.appendChild(th);
        });
        thead.appendChild(headerRow);

        const rows = value.map(({name, type}) => {
          return [
            name || "N/A",
            type || "N/A",
          ];
        });

        rows.forEach(rowData => {
          const row = document.createElement("tr");
          rowData.forEach(cellData => {
            const td = document.createElement("td");
            td.textContent = cellData;
            renderWithTooltip(td, formatDate(cellData));
            row.appendChild(td);
          });
          tbody.appendChild(row);
        });

        mainContent.appendChild(tableWrapper);
      }
    });
  }

  function getIndustriesIcon(industriesName) {
    switch (industriesName) {
      case "Aerospace & Defense":
        return `<svg class="tag-item-icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="currentColor">
  <path d="M8.817 21.5v-1.173l1.943-1.442v-5.683L2.5 15.644v-1.538l8.26-4.885v-5.49c0-.346.12-.64.36-.88s.534-.36.88-.36.64.12.88.36.36.534.36.88v5.49l8.26 4.885v1.538l-8.26-2.442v5.663l1.943 1.462V21.5L12 20.577l-3.183.923Z"></path>
</svg>`;
      case "Agriculture":
        return `<svg class="tag-item-icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="currentColor">
  <path d="M3.846 9.135a.726.726 0 0 1-.534-.216.726.726 0 0 1-.216-.535c0-.212.072-.39.216-.534a.726.726 0 0 1 .534-.215h3.058c.434 0 .812.144 1.133.433.322.29.508.645.56 1.067h-4.75Zm2.02 8.98c.865 0 1.6-.302 2.206-.908A3.004 3.004 0 0 0 8.981 15c0-.865-.303-1.601-.909-2.207a3.004 3.004 0 0 0-2.207-.908c-.865 0-1.6.303-2.206.908A3.004 3.004 0 0 0 2.75 15c0 .865.303 1.601.909 2.207a3.004 3.004 0 0 0 2.206.908Zm13.634 0c.48 0 .893-.171 1.236-.514.343-.343.514-.755.514-1.236 0-.48-.171-.892-.514-1.235a1.685 1.685 0 0 0-1.236-.515c-.48 0-.893.172-1.236.515a1.685 1.685 0 0 0-.514 1.235c0 .481.171.893.514 1.236.343.343.755.514 1.236.514ZM5.863 16.308a1.26 1.26 0 0 1-.926-.382 1.267 1.267 0 0 1-.38-.928c0-.364.128-.673.383-.926.254-.253.564-.38.928-.38.364 0 .672.128.925.382.253.255.38.564.38.928 0 .364-.127.673-.382.926s-.564.38-.928.38Zm14.118-3.168c.318.064.583.145.796.242.213.097.447.255.704.476V8.192a1.74 1.74 0 0 0-.531-1.276 1.74 1.74 0 0 0-1.277-.531H13.95l-1.05-1.1 1.4-1.4-.7-.7-3.55 3.55.75.7 1.4-1.4 1.05 1.05V9c0 .656-.233 1.217-.7 1.684-.468.467-1.029.7-1.685.7h-2.15c.288.226.519.45.695.674.175.223.357.498.546.827h.91c1.074 0 1.99-.38 2.748-1.137A3.747 3.747 0 0 0 14.75 9V7.885h4.923a.3.3 0 0 1 .221.086.3.3 0 0 1 .087.221v4.948Zm-3.677 2.61c.08-.328.172-.597.275-.806.103-.21.263-.44.48-.694h-6.65c.048.288.072.538.072.75 0 .213-.024.463-.071.75h5.894Zm3.196 3.865c-.903 0-1.67-.316-2.302-.948-.632-.632-.948-1.4-.948-2.302 0-.902.316-1.67.948-2.301.632-.633 1.4-.949 2.302-.949.903 0 1.67.316 2.302.948.632.632.948 1.4.948 2.302 0 .903-.316 1.67-.948 2.302-.632.632-1.4.948-2.302.948Zm-13.635 0c-1.277 0-2.365-.45-3.265-1.35-.9-.9-1.35-1.988-1.35-3.265 0-1.277.45-2.365 1.35-3.265.9-.9 1.988-1.35 3.265-1.35 1.277 0 2.366.45 3.266 1.35.9.9 1.35 1.988 1.35 3.265 0 1.277-.45 2.365-1.35 3.265-.9.9-1.989 1.35-3.266 1.35Z"></path>
</svg>`;
      case "Civil Society & Non-Profits":
        return `<svg class="tag-item-icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="currentColor">
  <path d="M11.789 19.971a.725.725 0 0 0 .3-.07.81.81 0 0 0 .242-.157l7.998-7.998c.226-.226.395-.466.51-.723.114-.256.17-.526.17-.808a2.151 2.151 0 0 0-.68-1.573l-4-4a2.07 2.07 0 0 0-.7-.495 2.102 2.102 0 0 0-.816-.157c-.282 0-.552.053-.812.157-.26.105-.5.27-.718.495l-.573.573 1.85 1.866c.224.214.39.458.497.732.107.275.16.56.16.854 0 .61-.204 1.12-.611 1.527-.408.408-.917.612-1.527.612-.295 0-.58-.049-.857-.146a1.945 1.945 0 0 1-.735-.468L9.592 8.313 5.246 12.66a.76.76 0 0 0-.227.542c0 .184.063.342.189.473a.62.62 0 0 0 .465.196.725.725 0 0 0 .301-.07.81.81 0 0 0 .241-.157L9.5 10.36l1.054 1.053-3.27 3.285a.76.76 0 0 0-.226.542c0 .179.064.332.193.461a.629.629 0 0 0 .46.193.725.725 0 0 0 .302-.069.812.812 0 0 0 .24-.158l3.4-3.384 1.055 1.053-3.385 3.4a.608.608 0 0 0-.165.242.802.802 0 0 0-.062.3.63.63 0 0 0 .193.461.629.629 0 0 0 .461.194.764.764 0 0 0 .542-.227l3.4-3.385 1.054 1.054-3.4 3.4a.813.813 0 0 0-.227.552c0 .184.069.338.206.46a.678.678 0 0 0 .464.184Zm-.016 1.5a2.098 2.098 0 0 1-1.479-.588 2.026 2.026 0 0 1-.66-1.466c-.566-.038-1.04-.24-1.42-.604-.38-.364-.586-.842-.618-1.434-.592-.039-1.07-.246-1.436-.621-.366-.376-.561-.848-.587-1.418-.595-.038-1.086-.254-1.473-.647s-.58-.89-.58-1.491c0-.295.055-.584.168-.866a2.18 2.18 0 0 1 .489-.746l5.415-5.4 2.93 2.93a.62.62 0 0 0 .23.165.778.778 0 0 0 .311.061c.182 0 .34-.06.472-.18a.61.61 0 0 0 .198-.474.779.779 0 0 0-.062-.31.62.62 0 0 0-.165-.232L9.998 4.642a2.054 2.054 0 0 0-.705-.495 2.138 2.138 0 0 0-.82-.157c-.282 0-.55.053-.803.157a2.24 2.24 0 0 0-.718.495l-3.285 3.3a2.252 2.252 0 0 0-.447.645 2.19 2.19 0 0 0-.205.76c-.02.212-.01.423.03.63.039.21.109.405.209.588L2.15 11.67a3.645 3.645 0 0 1-.51-1.094 3.801 3.801 0 0 1 .172-2.563c.187-.428.449-.811.786-1.149l3.275-3.275a3.914 3.914 0 0 1 1.222-.822c.44-.184.903-.276 1.388-.276.484 0 .945.092 1.382.276.438.184.838.458 1.202.822l.573.574.573-.574c.375-.364.78-.638 1.218-.822a3.528 3.528 0 0 1 1.383-.276c.484 0 .947.092 1.387.276.44.184.843.458 1.207.822l3.975 3.975c.364.365.643.779.836 1.244.194.464.29.94.29 1.424s-.096.945-.29 1.382a3.967 3.967 0 0 1-.836 1.202l-7.998 7.983a2.248 2.248 0 0 1-1.612.673Z"></path>
</svg>`;
      case "Construction & Engineering":
        return `<svg class="tag-item-icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="currentColor">
  <path d="M5.815 20.23a1.975 1.975 0 0 1-1.451-.593 1.975 1.975 0 0 1-.595-1.452V6.312c0-.426.192-.722.574-.888.383-.166.719-.105 1.007.184l1.865 1.865-1.061 1.062.584.584L7.8 8.058l2.37 2.369-1.062 1.062.584.584 1.062-1.061 2.408 2.407-1.062 1.062.585.584 1.061-1.061 2.37 2.37-1.062 1.06.584.585 1.062-1.061 1.712 1.711c.282.282.34.613.174.992-.166.38-.46.57-.878.57H5.815ZM6.308 18H14.3L6 9.7v7.992a.3.3 0 0 0 .087.221.3.3 0 0 0 .22.087Z"></path>
</svg>`;
      case "Education":
        return `<svg class="tag-item-icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="currentColor">
  <path d="m12 19.846-6.5-3.53v-5.424L2.039 9 12 3.577 21.961 9v7.192h-1.5V9.831L18.5 10.892v5.423L12 19.846Zm0-7.146L18.84 9 12 5.3 5.16 9 12 12.7Zm0 5.438 5-2.7v-3.746l-5 2.73-5-2.73v3.746l5 2.7Z"></path>
</svg>`;
      case "Energy & Utilities":
        return `<svg class="tag-item-icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="currentColor">
  <path d="M12 21.577c-.505 0-.94-.175-1.307-.525a1.881 1.881 0 0 1-.597-1.283h3.808a1.881 1.881 0 0 1-.597 1.283c-.366.35-.802.525-1.307.525Zm-3.75-3.192v-1.5h7.5v1.5h-7.5Zm.154-2.885a7.273 7.273 0 0 1-2.488-2.553A6.736 6.736 0 0 1 5 9.5c0-1.949.68-3.603 2.038-4.962C8.398 3.18 10.051 2.5 12 2.5c1.949 0 3.602.68 4.962 2.038C18.32 5.898 19 7.551 19 9.5a6.736 6.736 0 0 1-.916 3.447 7.273 7.273 0 0 1-2.488 2.553H8.404ZM8.85 14h6.3a5.55 5.55 0 0 0 1.737-1.975A5.383 5.383 0 0 0 17.5 9.5c0-1.533-.533-2.833-1.6-3.9C14.833 4.533 13.533 4 12 4s-2.833.533-3.9 1.6C7.033 6.667 6.5 7.967 6.5 9.5c0 .9.204 1.742.612 2.525A5.549 5.549 0 0 0 8.85 14Z"></path>
</svg>`;
      case "Financial Services":
        return `<svg class="tag-item-icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="currentColor">
  <path d="M11.798 15.952h.629v-.79a2.094 2.094 0 0 0 1.187-.564c.325-.31.488-.71.488-1.2 0-.425-.167-.78-.5-1.066a4.362 4.362 0 0 0-1.15-.703V9.692a.98.98 0 0 1 .456.246c.124.12.214.26.27.42l.805-.337a1.686 1.686 0 0 0-.601-.786 2.288 2.288 0 0 0-.93-.397v-.79h-.654v.775a2.087 2.087 0 0 0-1.187.498c-.325.283-.488.66-.488 1.13 0 .436.17.803.513 1.101.341.298.729.537 1.162.72v2.041a1.481 1.481 0 0 1-.728-.4 1.57 1.57 0 0 1-.399-.696l-.788.337c.133.444.366.809.7 1.095a2.32 2.32 0 0 0 1.215.528v.775Zm.654-1.654v-1.775c.208.095.393.21.554.343.162.133.242.32.242.563 0 .277-.075.476-.224.597-.15.121-.34.212-.572.272Zm-.654-2.946a3.09 3.09 0 0 1-.562-.343.664.664 0 0 1-.26-.559c0-.25.085-.433.255-.549.169-.116.358-.19.567-.224v1.675ZM8 18.5c-1.81 0-3.347-.63-4.608-1.891C2.131 15.348 1.5 13.812 1.5 12.002s.63-3.347 1.892-4.609C4.653 6.131 6.189 5.5 8 5.5h8c1.81 0 3.347.63 4.608 1.891 1.261 1.261 1.892 2.797 1.892 4.607s-.63 3.347-1.892 4.609C19.347 17.869 17.811 18.5 16 18.5H8ZM8 17h8c1.383 0 2.563-.488 3.538-1.463C20.512 14.563 21 13.383 21 12s-.488-2.562-1.462-3.537C18.562 7.488 17.383 7 16 7H8c-1.383 0-2.562.488-3.537 1.463C3.488 9.438 3 10.617 3 12s.488 2.563 1.463 3.537C5.438 16.512 6.617 17 8 17Z"></path>
</svg>`;
      case "Governments":
        return `<svg class="tag-item-icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="currentColor">
  <path d="M5.75 17V9.5h1.5V17h-1.5Zm5.5 0V9.5h1.5V17h-1.5Zm-8.48 3.5V19h18.46v1.5H2.77ZM16.75 17V9.5h1.5V17h-1.5ZM2.77 7.5V6.077L12 1.557l9.23 4.52V7.5H2.77ZM6.314 6h11.37L12 3.25 6.315 6Z"></path>
</svg>`;
      case "Hospitality":
        return `<svg class="tag-item-icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 24 24">
  <path d="M2.615 18.192v-1.5h18.77v1.5H2.615ZM3.5 15.5v-.615c0-2.05.662-3.842 1.987-5.376C6.81 7.975 8.482 7.029 10.5 6.673v-.346c0-.409.148-.761.443-1.057A1.443 1.443 0 0 1 12 4.827c.409 0 .761.148 1.057.443.295.296.443.648.443 1.057v.346c2.028.357 3.702 1.302 5.021 2.836 1.32 1.534 1.979 3.326 1.979 5.376v.615h-17ZM5.06 14h13.88c-.194-1.682-.957-3.1-2.286-4.252C15.324 8.596 13.774 8.02 12 8.02c-1.773 0-3.322.576-4.646 1.73C6.03 10.9 5.264 12.317 5.06 14Z"></path>
</svg>`;
      case "Insurance":
        return `<svg class="tag-item-icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="currentColor">
  <path d="M12 21.48c-2.163-.589-3.954-1.862-5.372-3.819C5.209 15.706 4.5 13.518 4.5 11.1V5.346L12 2.538l7.5 2.808V11.1c0 2.418-.71 4.605-2.128 6.562-1.418 1.956-3.21 3.229-5.372 3.819Zm0-1.58c1.733-.55 3.167-1.65 4.3-3.3s1.7-3.483 1.7-5.5V6.375l-6-2.24-6 2.24V11.1c0 2.017.567 3.85 1.7 5.5s2.567 2.75 4.3 3.3Z"></path>
</svg>`;
      case "Legal & Professional Services":
        return `<svg class="tag-item-icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="currentColor">
  <path d="M2.5 20.5V19h8.75V7.883a2.63 2.63 0 0 1-1.188-.671A2.558 2.558 0 0 1 9.367 6h-3.31L9 13.106c-.02.75-.345 1.388-.977 1.913-.632.526-1.39.789-2.273.789-.883 0-1.641-.263-2.273-.789-.632-.525-.958-1.163-.977-1.913L5.442 6H3.5V4.5h5.867a2.69 2.69 0 0 1 .955-1.428A2.624 2.624 0 0 1 12 2.5c.637 0 1.197.19 1.678.572.481.382.8.858.955 1.428H20.5V6h-1.942l2.942 7.106c-.02.75-.345 1.388-.977 1.913-.632.526-1.39.789-2.273.789-.883 0-1.641-.263-2.273-.789-.632-.525-.958-1.163-.977-1.913L17.942 6h-3.31a2.548 2.548 0 0 1-.694 1.212 2.63 2.63 0 0 1-1.188.67V19h8.75v1.5h-19Zm13.808-7.442h3.884L18.25 8.37l-1.942 4.687Zm-12.5 0h3.884L5.75 8.37l-1.942 4.687ZM12 6.5c.347 0 .643-.121.886-.364s.364-.539.364-.886-.121-.643-.364-.886A1.206 1.206 0 0 0 12 4c-.348 0-.643.121-.886.364a1.205 1.205 0 0 0-.364.886c0 .347.121.643.364.886s.538.364.886.364Z"></path>
</svg>`;
      case "Manufacturing":
        return `<svg class="tag-item-icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="currentColor">
  <path d="m10.75 22.51-1.044-1.07 2.075-2.075H7.767a2.543 2.543 0 0 1-.895 1.255 2.38 2.38 0 0 1-1.487.495 2.41 2.41 0 0 1-1.771-.729 2.41 2.41 0 0 1-.73-1.77c0-.56.166-1.057.496-1.488a2.54 2.54 0 0 1 1.255-.895V7.767a2.543 2.543 0 0 1-1.255-.895 2.381 2.381 0 0 1-.495-1.487c0-.695.243-1.285.729-1.771a2.411 2.411 0 0 1 1.77-.73c.56 0 1.057.166 1.488.496.432.33.73.748.895 1.255h4.014L9.696 2.56l1.054-1.07 3.894 3.895-3.894 3.894-1.054-1.07 2.085-2.074H7.767a2.466 2.466 0 0 1-1.632 1.632v8.466a2.465 2.465 0 0 1 1.632 1.632h4.004L9.706 15.79l1.044-1.069 3.894 3.894-3.894 3.895Zm7.868-1.395a2.415 2.415 0 0 1-1.772-.729 2.408 2.408 0 0 1-.73-1.77c0-.568.165-1.069.495-1.501.33-.433.748-.727 1.254-.882V7.767a2.448 2.448 0 0 1-1.254-.882 2.407 2.407 0 0 1-.496-1.5c0-.695.243-1.285.729-1.771a2.407 2.407 0 0 1 1.77-.73c.693 0 1.283.244 1.77.73.488.486.731 1.076.731 1.77 0 .568-.165 1.069-.495 1.501-.33.433-.748.727-1.255.882v8.466c.507.165.925.463 1.255.895.33.431.495.927.495 1.487a2.41 2.41 0 0 1-.728 1.771 2.407 2.407 0 0 1-1.77.73Zm-13.233-1.5c.283 0 .52-.095.712-.287a.968.968 0 0 0 .288-.713.967.967 0 0 0-.288-.712.967.967 0 0 0-.712-.288.967.967 0 0 0-.713.288.967.967 0 0 0-.287.712c0 .284.095.521.287.713.192.192.43.287.713.287Zm13.23 0a.966.966 0 0 0 .713-.287.968.968 0 0 0 .287-.713.968.968 0 0 0-.287-.712.968.968 0 0 0-.713-.288.967.967 0 0 0-.712.288.967.967 0 0 0-.288.712c0 .284.096.521.288.713a.966.966 0 0 0 .712.287ZM5.385 6.385c.283 0 .52-.096.712-.288a.968.968 0 0 0 .288-.712.968.968 0 0 0-.288-.713.968.968 0 0 0-.712-.287.968.968 0 0 0-.713.287.968.968 0 0 0-.287.713c0 .283.095.52.287.712.192.192.43.288.713.288Zm13.23 0a.967.967 0 0 0 .713-.288.968.968 0 0 0 .287-.712.968.968 0 0 0-.287-.713.968.968 0 0 0-.713-.287.967.967 0 0 0-.712.287.967.967 0 0 0-.288.713c0 .283.096.52.288.712a.967.967 0 0 0 .712.288Z"></path>
</svg>`;
      case "Media & Entertainment":
        return `<svg class="tag-item-icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="currentColor">
  <path d="M4.53 18.5c-.676 0-1.201-.24-1.575-.72-.374-.479-.515-1.044-.424-1.695L3.6 8.527c.13-.878.519-1.602 1.164-2.172A3.341 3.341 0 0 1 7.05 5.5h9.9c.878 0 1.64.285 2.286.855.645.57 1.033 1.294 1.164 2.172l1.07 7.558c.09.65-.051 1.216-.425 1.696-.373.48-.899.719-1.576.719-.286 0-.548-.048-.787-.144a1.997 1.997 0 0 1-.667-.452L15.612 15.5H8.388l-2.403 2.404a1.996 1.996 0 0 1-.667.452 2.092 2.092 0 0 1-.787.144Zm.4-1.65L7.78 14h8.44l2.85 2.85c.033.033.16.083.38.15a.59.59 0 0 0 .438-.163c.108-.108.145-.254.112-.437l-1.1-7.7a1.914 1.914 0 0 0-.655-1.212A1.901 1.901 0 0 0 16.95 7h-9.9a1.9 1.9 0 0 0-1.295.488c-.37.325-.588.729-.655 1.212L4 16.4c-.033.183.004.33.113.438A.591.591 0 0 0 4.55 17c.046 0 .173-.05.38-.15ZM17 12.904a.872.872 0 0 0 .64-.264.872.872 0 0 0 .264-.64.872.872 0 0 0-.264-.64.872.872 0 0 0-.64-.264.872.872 0 0 0-.64.264.872.872 0 0 0-.264.64.87.87 0 0 0 .264.64.872.872 0 0 0 .64.264Zm-2-3a.872.872 0 0 0 .64-.264.872.872 0 0 0 .264-.64.872.872 0 0 0-.264-.64.872.872 0 0 0-.64-.264.871.871 0 0 0-.64.264.872.872 0 0 0-.264.64.87.87 0 0 0 .264.64.871.871 0 0 0 .64.264Zm-7.096 2.942h1.192v-1.75h1.75V9.904h-1.75v-1.75H7.904v1.75h-1.75v1.192h1.75v1.75Z"></path>
</svg>`;
      case "Oil & Gas":
        return `<svg class="tag-item-icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="currentColor">
  <path d="M4.5 20.5V5.308c0-.505.175-.933.525-1.283.35-.35.778-.525 1.283-.525h5.384c.505 0 .933.175 1.283.525.35.35.525.778.525 1.283v6.5h.961c.498 0 .923.177 1.277.53.354.355.531.78.531 1.277v4.539c0 .322.112.594.336.818.223.224.496.336.818.336.322 0 .595-.112.818-.336.224-.224.336-.496.336-.818v-7.008c-.15.09-.309.152-.475.187a2.578 2.578 0 0 1-.525.052 2.117 2.117 0 0 1-1.557-.636 2.117 2.117 0 0 1-.635-1.557c0-.495.14-.935.423-1.322a2.038 2.038 0 0 1 1.119-.778l-2.254-2.254.838-.838 3.566 3.504a2.42 2.42 0 0 1 .692 1.688v8.962c0 .657-.226 1.212-.68 1.666a2.263 2.263 0 0 1-1.664.68 2.269 2.269 0 0 1-1.666-.68 2.263 2.263 0 0 1-.682-1.666v-4.846a.3.3 0 0 0-.087-.222.3.3 0 0 0-.22-.086H13.5v7.5h-9ZM6 10.25h6V5.308a.294.294 0 0 0-.096-.212.294.294 0 0 0-.212-.096H6.308a.294.294 0 0 0-.212.096.294.294 0 0 0-.096.212v4.942Zm11.577-.058c.283 0 .52-.095.712-.287a.968.968 0 0 0 .288-.713.968.968 0 0 0-.288-.712.968.968 0 0 0-.712-.288.967.967 0 0 0-.713.288.967.967 0 0 0-.287.712.97.97 0 0 0 .287.713c.192.192.43.287.713.287ZM6 19h6v-7.25H6V19Z"></path>
</svg>`;
      case "Retail":
        return `<svg class="tag-item-icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="currentColor">
  <path d="M20.765 10.973v7.97c0 .504-.175.932-.525 1.282-.35.35-.777.525-1.282.525H5.073c-.505 0-.933-.175-1.283-.525a1.745 1.745 0 0 1-.525-1.283v-7.988a3.031 3.031 0 0 1-.906-1.288c-.202-.527-.206-1.097-.013-1.708l1.012-3.304c.133-.42.36-.76.679-1.017.319-.258.7-.387 1.144-.387h13.65c.443 0 .822.123 1.136.37.314.245.543.584.687 1.015l1.03 3.323c.194.611.19 1.179-.012 1.703a3.273 3.273 0 0 1-.907 1.312Zm-6.55-.723c.547 0 .957-.167 1.232-.5.275-.335.388-.694.338-1.077l-.608-3.923h-2.412V8.7c0 .42.143.784.427 1.09.285.307.626.46 1.023.46Zm-4.5 0c.46 0 .834-.153 1.12-.46.287-.306.43-.67.43-1.09V4.75H8.854l-.608 3.962c-.054.355.058.7.335 1.035.277.335.655.503 1.134.503Zm-4.45 0c.37 0 .69-.13.956-.387a1.69 1.69 0 0 0 .494-.975l.589-4.138H5.18a.423.423 0 0 0-.26.072.43.43 0 0 0-.144.216l-.962 3.254c-.132.43-.07.863.187 1.301.256.438.677.657 1.263.657Zm13.5 0c.541 0 .956-.213 1.243-.637.287-.425.356-.866.207-1.32l-1.011-3.274a.378.378 0 0 0-.144-.207.471.471 0 0 0-.26-.062h-2.073l.588 4.138c.063.392.228.716.495.975.266.258.585.387.955.387Zm-13.692 9h13.885a.3.3 0 0 0 .22-.087.3.3 0 0 0 .087-.22V11.66c-.108.04-.2.065-.273.075a2.731 2.731 0 0 1-1.414-.23c-.342-.163-.673-.424-.993-.783a3.2 3.2 0 0 1-.997.748c-.383.186-.82.279-1.311.279-.424 0-.824-.088-1.2-.264a3.775 3.775 0 0 1-1.062-.763 3.255 3.255 0 0 1-1.05.763 2.868 2.868 0 0 1-1.188.264c-.451 0-.874-.082-1.27-.245a2.704 2.704 0 0 1-1.042-.782c-.42.42-.808.697-1.162.829a2.96 2.96 0 0 1-1.038.198c-.078 0-.159-.005-.242-.014a.875.875 0 0 1-.258-.075v7.281a.3.3 0 0 0 .087.221.3.3 0 0 0 .221.087Z"></path>
</svg>`;
      case "Technology":
        return `<svg class="tag-item-icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="currentColor">
  <path d="M5.5 22.558v-.75c0-2.323.477-4.169 1.43-5.537.955-1.368 2.26-2.792 3.914-4.271-1.661-1.48-2.969-2.903-3.923-4.271-.954-1.368-1.43-3.214-1.43-5.537v-.75h1.5v.75c0 .26.007.507.021.739.015.232.04.46.076.684h9.814a7.26 7.26 0 0 0 .076-.684c.015-.232.022-.478.022-.739v-.75h1.5v.75c0 2.323-.477 4.169-1.43 5.537-.955 1.368-2.26 2.792-3.914 4.271 1.655 1.473 2.96 2.895 3.913 4.266.954 1.372 1.431 3.219 1.431 5.542v.75H17v-.75c0-.26-.007-.507-.022-.739a7.252 7.252 0 0 0-.076-.684H7.098a7.229 7.229 0 0 0-.076.684c-.015.232-.022.478-.022.739v.75H5.5ZM8.594 7.5h6.802c.262-.362.492-.734.692-1.118.2-.384.37-.806.51-1.267H7.392c.146.45.316.868.51 1.254s.424.763.692 1.131ZM12 11.017c.391-.347.766-.688 1.124-1.023.358-.334.695-.666 1.01-.994H9.857c.315.328.654.66 1.015.994.362.335.738.676 1.129 1.023ZM9.865 15h4.27a26.62 26.62 0 0 0-1.011-.994A61.006 61.006 0 0 0 12 12.983c-.391.347-.766.688-1.124 1.023-.358.334-.695.666-1.01.994Zm-2.463 3.885h9.196a8.98 8.98 0 0 0-.51-1.254 8.047 8.047 0 0 0-.692-1.131H8.604a8.67 8.67 0 0 0-.697 1.123c-.197.38-.365.801-.505 1.262Z"></path>
</svg>`;
      case "Telecommunications":
        return `<svg class="tag-item-icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="currentColor">
  <path d="M19.44 20.5c-1.884 0-3.778-.438-5.68-1.314-1.901-.877-3.649-2.113-5.242-3.71-1.593-1.595-2.827-3.343-3.704-5.241C3.938 8.335 3.5 6.445 3.5 4.56A1.032 1.032 0 0 1 4.55 3.5h3.262c.252 0 .475.082.668.247.193.165.316.368.368.61L9.421 7.3c.04.273.032.508-.025.704-.056.196-.158.36-.304.494l-2.31 2.248c.372.68.797 1.325 1.275 1.932.477.607.994 1.187 1.55 1.74a17.26 17.26 0 0 0 3.753 2.842l2.244-2.264a1.27 1.27 0 0 1 .568-.342c.223-.066.454-.082.693-.048l2.777.565c.253.067.459.196.619.387a.98.98 0 0 1 .239.65v3.242a1.032 1.032 0 0 1-1.06 1.05ZM6.073 9.327l1.785-1.708a.178.178 0 0 0 .062-.106.234.234 0 0 0-.005-.125l-.434-2.234a.206.206 0 0 0-.068-.116A.194.194 0 0 0 7.288 5H5.15a.13.13 0 0 0-.135.135 12.79 12.79 0 0 0 1.058 4.192Zm8.7 8.642c.663.31 1.354.545 2.074.709.72.163 1.393.26 2.018.291a.13.13 0 0 0 .135-.134V16.73a.194.194 0 0 0-.038-.125.206.206 0 0 0-.116-.068l-2.1-.427a.159.159 0 0 0-.1-.004.245.245 0 0 0-.092.062l-1.78 1.8Z"></path>
</svg>`;
      case "Transportation":
        return `<svg class="tag-item-icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="currentColor">
  <path d="M6.52 20.5a.726.726 0 0 1-.535-.216.726.726 0 0 1-.216-.534v-1.973c-.313-.237-.602-.573-.869-1.007a2.737 2.737 0 0 1-.4-1.462V6c0-1.21.602-2.096 1.805-2.658C7.508 2.781 9.406 2.5 12 2.5c2.687 0 4.609.27 5.765.81C18.922 3.848 19.5 4.745 19.5 6v9.308c0 .54-.133 1.028-.4 1.462-.267.434-.556.77-.87 1.007v1.973c0 .212-.071.39-.215.534a.726.726 0 0 1-.534.216h-.616a.726.726 0 0 1-.534-.216.726.726 0 0 1-.216-.534V18.5h-8.23v1.25c0 .212-.072.39-.216.534a.726.726 0 0 1-.534.216h-.616Zm5.51-15.23h5.755H6.277h5.754ZM16 12H6h12-2ZM6 10.5h12V6.77H6v3.73Zm2.502 5.308c.364 0 .673-.128.926-.382.253-.255.38-.564.38-.928 0-.364-.128-.673-.382-.926a1.267 1.267 0 0 0-.928-.38c-.364 0-.673.128-.926.382-.253.255-.38.564-.38.928 0 .364.128.673.382.926.255.253.564.38.928.38Zm7 0c.364 0 .673-.128.926-.382.253-.255.38-.564.38-.928 0-.364-.128-.673-.382-.926a1.267 1.267 0 0 0-.928-.38c-.364 0-.673.128-.926.382-.253.255-.38.564-.38.928 0 .364.128.673.382.926.255.253.564.38.928.38ZM6.277 5.269h11.508c-.212-.398-.748-.71-1.608-.933C15.317 4.112 13.935 4 12.03 4c-1.873 0-3.24.117-4.1.351-.86.234-1.412.54-1.654.918ZM8 17h8c.55 0 1.02-.196 1.413-.587A1.93 1.93 0 0 0 18 15v-3H6v3c0 .55.196 1.02.588 1.413.391.391.862.587 1.412.587Z"></path>
</svg>`;
      case "Chemicals & Materials":
        return `<svg class="tag-item-icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="currentColor">
  <path d="M5 20.5c-.638 0-1.091-.285-1.36-.854-.269-.57-.204-1.099.195-1.588L9.5 11.173V5H8.308a.725.725 0 0 1-.535-.216.726.726 0 0 1-.215-.534.73.73 0 0 1 .215-.535.726.726 0 0 1 .535-.215h7.384c.213 0 .39.072.535.216a.726.726 0 0 1 .215.534.73.73 0 0 1-.215.535.726.726 0 0 1-.535.215H14.5v6.173l5.665 6.885c.4.49.464 1.019.195 1.588-.269.57-.722.854-1.36.854H5ZM5 19h14l-6-7.3V5h-2v6.7L5 19Z"></path>
</svg>`;
      case "Healthcare":
        return `<svg class="tag-item-icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="currentColor">
  <path d="M13.482 21.5c-1.664 0-3.082-.584-4.254-1.751-1.171-1.167-1.757-2.584-1.757-4.249v-.546c-1.35-.176-2.479-.778-3.387-1.806C3.175 12.12 2.72 10.904 2.72 9.5V3.75h3v-1h1.5v3.5h-1.5v-1h-1.5V9.5c0 1.1.392 2.042 1.175 2.825.784.783 1.725 1.175 2.825 1.175s2.042-.392 2.825-1.175c.784-.783 1.175-1.725 1.175-2.825V5.25h-1.5v1h-1.5v-3.5h1.5v1h3V9.5c0 1.404-.454 2.62-1.362 3.648-.909 1.028-2.038 1.63-3.388 1.806v.546c0 1.25.439 2.313 1.315 3.188.877.875 1.942 1.312 3.195 1.312 1.25 0 2.312-.438 3.187-1.313S17.98 16.75 17.98 15.5v-1.617a2.469 2.469 0 0 1-1.298-.907c-.34-.45-.51-.96-.51-1.534 0-.71.249-1.314.746-1.811a2.468 2.468 0 0 1 1.813-.746c.71 0 1.314.248 1.811.746.497.497.745 1.1.745 1.811 0 .573-.17 1.085-.51 1.534a2.47 2.47 0 0 1-1.297.907V15.5c0 1.665-.584 3.082-1.751 4.249-1.168 1.167-2.583 1.751-4.248 1.751Zm5.249-9c.296 0 .546-.102.75-.307.205-.204.307-.454.307-.75 0-.297-.102-.547-.306-.752a1.021 1.021 0 0 0-.751-.306c-.296 0-.547.102-.751.306a1.021 1.021 0 0 0-.307.751c0 .296.102.547.307.751.204.205.455.307.75.307Z"></path>
</svg>`;
      default:
        return "";
    }
  }

  function getMotivationIcon(motivationName) {
    switch (motivationName) {
      case "Attack / Destruction":
        return `<svg class="tag-item-icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="currentColor">
                <path d="M5.25 21.115a1.69 1.69 0 0 1-1.24-.51c-.34-.34-.51-.754-.51-1.24v-3.72c0-.487.17-.9.51-1.24a1.69 1.69 0 0 1 1.24-.51h13.5c.486 0 .899.17 1.24.51.34.34.51.753.51 1.24v3.72c0 .486-.17.9-.51 1.24a1.69 1.69 0 0 1-1.24.51H5.25Zm.058-1.5h13.384a.3.3 0 0 0 .221-.086.3.3 0 0 0 .087-.221v-3.606a.3.3 0 0 0-.087-.221.3.3 0 0 0-.22-.087H5.307a.3.3 0 0 0-.221.087.3.3 0 0 0-.087.22v3.607a.3.3 0 0 0 .087.22.3.3 0 0 0 .22.087Zm1.284-7.22L2.27 9.918l5.548-.932-1.51-5.462 4.62 3.285 2.798-4.925.933 5.577 5.461-1.51-3.275 4.62 3.223 1.822h-3.05l-2.361-1.336 1.8-2.537-3.004.83-.517-3.063-1.521 2.7-2.537-1.8.83 3.004-3.034.518 2.808 1.684h-2.89Z"></path>
              </svg>`;
      case "Espionage":
        return `<svg class="tag-item-icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 21.5a9.235 9.235 0 0 1-3.703-.75 9.607 9.607 0 0 1-3.016-2.03 9.607 9.607 0 0 1-2.032-3.017A9.236 9.236 0 0 1 2.5 12c0-1.313.25-2.547.75-3.703a9.607 9.607 0 0 1 2.03-3.016 9.607 9.607 0 0 1 3.017-2.032A9.235 9.235 0 0 1 12 2.5c2.382 0 4.452.766 6.21 2.297 1.757 1.532 2.81 3.438 3.157 5.718h-1.53a7.928 7.928 0 0 0-1.64-3.58A7.716 7.716 0 0 0 15 4.582V5c0 .55-.196 1.02-.588 1.413A1.926 1.926 0 0 1 13 7h-2v2c0 .283-.096.52-.287.713A.968.968 0 0 1 10 10H8v2h1.923v3H9l-4.8-4.8c-.05.3-.096.6-.138.9-.041.3-.062.6-.062.9 0 2.183.767 4.058 2.3 5.625C7.833 19.192 9.733 19.983 12 20v1.5Zm9.061-.385-3.325-3.305a4.834 4.834 0 0 1-1.048.5 3.67 3.67 0 0 1-1.188.19c-1.115 0-2.06-.388-2.836-1.163-.776-.776-1.164-1.722-1.164-2.837 0-1.115.388-2.06 1.164-2.836.775-.776 1.72-1.164 2.836-1.164 1.115 0 2.06.388 2.837 1.164.775.775 1.163 1.72 1.163 2.836 0 .424-.065.825-.195 1.203a4.72 4.72 0 0 1-.515 1.053l3.325 3.305-1.053 1.054ZM15.5 17c.7 0 1.292-.242 1.775-.725.483-.483.725-1.075.725-1.775s-.242-1.292-.725-1.775C16.792 12.242 16.2 12 15.5 12s-1.292.242-1.775.725C13.242 13.208 13 13.8 13 14.5s.242 1.292.725 1.775c.483.483 1.075.725 1.775.725Z"></path>
              </svg>`;
      default:
        return "";
    }
  }

  function getMalwareIcon() {
    return `<svg class="tag-item-icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="currentColor">
  <path d="M12 19c1.1 0 2.042-.392 2.825-1.175C15.608 17.042 16 16.1 16 15v-4c0-1.1-.392-2.042-1.175-2.825C14.042 7.392 13.1 7 12 7s-2.042.392-2.825 1.175C8.392 8.958 8 9.9 8 11v4c0 1.1.392 2.042 1.175 2.825C9.958 18.608 10.9 19 12 19Zm-1.846-3.25h3.692v-1.5h-3.692v1.5Zm0-4h3.692v-1.5h-3.692v1.5ZM12 20.5a5.388 5.388 0 0 1-2.753-.733 5.43 5.43 0 0 1-2.005-2.017H4.5v-1.5h2.177a5.645 5.645 0 0 1-.164-1.245c-.009-.42-.013-.838-.013-1.255h-2v-1.5h2c0-.423.001-.845.003-1.264a4.6 4.6 0 0 1 .174-1.236H4.5v-1.5h2.742c.24-.409.523-.782.85-1.118a4.7 4.7 0 0 1 1.123-.851L7.52 4.554l1.035-1.035 2.13 2.131a4.428 4.428 0 0 1 2.6 0l2.181-2.13L16.5 4.553 14.773 6.28c.422.23.798.512 1.129.843.33.331.616.707.856 1.126H19.5v1.5h-2.177a4.6 4.6 0 0 1 .174 1.236c.002.42.003.841.003 1.264h2v1.5h-2c0 .417-.004.835-.012 1.255a5.65 5.65 0 0 1-.165 1.245H19.5v1.5h-2.742a5.43 5.43 0 0 1-2.005 2.017A5.387 5.387 0 0 1 12 20.5Z"></path>
</svg>`;
  }

  function getToolsIcon() {
    return `<svg class="tag-item-icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="currentColor">
  <path d="m18.929 20.5-5.514-5.514 1.581-1.58 5.514 5.513-1.581 1.581Zm-13.848 0L3.5 18.92l6.929-6.93-2.335-2.325-.623.623-1.111-1.12v1.924l-.623.623-2.823-2.823.623-.623h1.925L4.356 7.173l2.857-2.858a2.72 2.72 0 0 1 .917-.619c.329-.13.67-.196 1.026-.196.355 0 .697.065 1.026.196.329.131.634.337.916.62L9.125 6.287l1.173 1.174-.623.623 2.335 2.325 2.404-2.404a2.489 2.489 0 0 1-.245-.628 2.947 2.947 0 0 1-.077-.682c0-.9.31-1.66.931-2.28.62-.621 1.38-.931 2.28-.931a2.723 2.723 0 0 1 1.189.242L16.22 6 18 7.78l2.273-2.272c.098.195.162.388.194.581.032.193.048.396.048.607 0 .9-.31 1.66-.93 2.28-.62.621-1.381.932-2.281.932-.239 0-.466-.023-.682-.07a2.042 2.042 0 0 1-.628-.251L5.081 20.5Z"></path>
</svg>`;
  }

  function getCveIcon() {
    return `<svg class="tag-item-icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 24 24">
  <path fill-rule="evenodd" d="M20.5 12a8.5 8.5 0 1 1-17 0 8.5 8.5 0 0 1 17 0Zm1.5 0c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2s10 4.477 10 10ZM9.205 17a1.14 1.14 0 0 1-.85-.367A1.225 1.225 0 0 1 8 15.75v-4.356c0-.343.118-.637.354-.882a1.14 1.14 0 0 1 .851-.367H9.4V8.709c0-.754.254-1.394.761-1.92A2.477 2.477 0 0 1 12.013 6c.728 0 1.345.263 1.852.79.508.525.762 1.165.762 1.919H13.4c0-.408-.133-.749-.399-1.024a1.318 1.318 0 0 0-.988-.414c-.393 0-.722.138-.988.414a1.418 1.418 0 0 0-.398 1.024v1.437h4.194c.324 0 .601.122.832.367.231.245.347.539.347.882v4.356c0 .343-.118.637-.354.882a1.14 1.14 0 0 1-.851.367h-5.59Z" clip-rule="evenodd"></path>
</svg>`;
  }

  function getAssociatedUncsIcon() {
    return `<svg class="tag-item-icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="currentColor">
  <path d="M3.7 12.7h16.8L17 9.9H7.2l-3.5 2.8Zm12.25.7a3.139 3.139 0 0 0-2.738 1.623 3.154 3.154 0 0 0-2.224 0 3.126 3.126 0 1 0 .412 1.527c0-.062-.015-.12-.018-.182a1.726 1.726 0 0 1 1.436 0c0 .062-.018.12-.018.182a3.15 3.15 0 1 0 3.15-3.15Zm-7.7 4.9a1.75 1.75 0 1 1 0-3.5 1.75 1.75 0 0 1 0 3.5Zm7.7 0a1.75 1.75 0 1 1 0-3.5 1.75 1.75 0 0 1 0 3.5Zm.7-9.8-.918-3.67a.7.7 0 0 0-.679-.53H9.147a.7.7 0 0 0-.68.53L7.55 8.5h9.1Z"></path>
</svg>`;
  }

  function generateConfirmedIcon() {
    const iconElement = document.createElement("span");
    iconElement.classList.add("confirmed-icon");
    iconElement.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="currentColor">
            <title>Confirmed</title>
            <path d="M12 16.5c1.249 0 2.31-.438 3.187-1.313.875-.876 1.313-1.938 1.313-3.187 0-1.249-.438-2.31-1.313-3.187C14.31 7.938 13.248 7.5 12 7.5c-1.249 0-2.31.438-3.187 1.313C7.938 9.69 7.5 10.751 7.5 12c0 1.249.438 2.31 1.313 3.187.876.875 1.938 1.313 3.187 1.313Zm.002 5a9.255 9.255 0 0 1-3.705-.748 9.596 9.596 0 0 1-3.017-2.03 9.591 9.591 0 0 1-2.032-3.016 9.245 9.245 0 0 1-.748-3.704c0-1.314.25-2.55.748-3.705a9.597 9.597 0 0 1 2.03-3.017 9.592 9.592 0 0 1 3.016-2.032 9.245 9.245 0 0 1 3.704-.748c1.314 0 2.55.25 3.705.748a9.596 9.596 0 0 1 3.018 2.03 9.592 9.592 0 0 1 2.03 3.016 9.247 9.247 0 0 1 .749 3.704c0 1.314-.25 2.55-.748 3.705a9.596 9.596 0 0 1-2.03 3.018 9.592 9.592 0 0 1-3.016 2.03 9.247 9.247 0 0 1-3.704.749ZM12 20c2.233 0 4.125-.775 5.675-2.325C19.225 16.125 20 14.233 20 12c0-2.233-.775-4.125-2.325-5.675C16.125 4.775 14.233 4 12 4c-2.233 0-4.125.775-5.675 2.325C4.775 7.875 4 9.767 4 12c0 2.233.775 4.125 2.325 5.675C7.875 19.225 9.767 20 12 20Z"></path>
        </svg>
    `;
    return iconElement;
  }

  /**
   * Utility function to filter keys based on allowlistedFields
   */
  function filterKeys(obj, allowedKeys) {
    if (allowedKeys.length === 0) {
      return obj;
    }
    const filtered = {};
    allowedKeys.forEach(key => {
      if (obj.hasOwnProperty(key)) {
        filtered[key] = obj[key];
      }
    });
    return filtered;
  }

  function formatDate(dateString) {
    const date = new Date(dateString);

    if (isNaN(date.getTime())) {
      return dateString;
    }

    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, "0");
    const day = String(date.getDate()).padStart(2, "0");

    return `${year}-${month}-${day}`;
  }

  /**
   * Returns transposed Array
   */
  function transposeArray(array) {
    const n = array.length;
    if (n === 0) {
      return [];
    }
    const m = array[0]?.length ?? 0;
    if (m === 0) {
      return [];
    }

    let transposedArray = new Array(m);
    for (let i = 0; i < m; i++) {
      transposedArray[i] = new Array(n);
    }

    for (let i = 0; i < n; i++) {
      for (let j = 0; j < m; j++) {
        transposedArray[j][i] = array[i][j];
      }
    }

    return transposedArray;
  }

  /**
   * Removes special symbols from a string.
   */
  function removeSpecialSymbols(str) {
    return str.replace(/[^\w\s]/gi, "");
  }

  /**
   * Converts camelCaseName to Title Case.
   */
  function convertCamelCaseToTitleCase(str) {
    let result = str.replace(/_/g, " ");
    result = result.replace(/([a-z])([A-Z])/g, "$1 $2");
    result = result.replace(/\b\w/g, char => char.toUpperCase());
    return result;
  }

  /**
   * Creates a tooltip with given text and position.
   */
  function createTooltip(text, x, y, trianglePointX, placeAtBottom, contentOverflowWindow) {
    removeTooltip();
    const tooltip = document.createElement("div");
    tooltip.classList.add("tooltip");
    tooltip.textContent = text;
    tooltip.style.left = `${x}px`;
    tooltip.style.top = `${y}px`;
    if (contentOverflowWindow) {
      tooltip.style.right = `${tooltipGap}px`;
    }
    const tooltipTriangle = document.createElement("span");
    tooltipTriangle.classList.add("tooltip-triangle");
    tooltipTriangle.style.left = `${trianglePointX}px`;
    if (placeAtBottom) {
      tooltipTriangle.style.top = "-8px";
      tooltipTriangle.style.borderTop = "0";
      tooltipTriangle.style.borderBottom = "solid 8px rgb(195, 210, 232)";
    }
    tooltip.append(tooltipTriangle);
    document.body.append(tooltip);
  }

  /**
   * Removes any existing tooltip from the DOM.
   */
  function removeTooltip() {
    const tooltip = document.querySelectorAll(".tooltip");
    tooltip.forEach((item) => {
      if (item) {
        item.remove();
      }
    });
  }

  /**
   * Sets a timeout to calculate and show tooltip position after a delay.
   */
  function createTooltipListener(event) {
    tooltipTimeout = setTimeout(() => calculateTooltipPosition(event), 1000);
  }

  /**
   * Clears any existing tooltip timeout and removes the tooltip.
   */
  function removeTooltipListener() {
    if (tooltipTimeout) {
      clearTimeout(tooltipTimeout);
    }
    removeTooltip();
  }

  /**
   * Calculates and positions the tooltip relative to the event target.
   */
  function calculateTooltipPosition(event) {
    const target = event.target;
    if (!target) {
      return;
    }
    const viewportWidth = window.innerWidth;
    const rect = target.getBoundingClientRect();
    const tooltipContent = document.createElement("div");
    tooltipContent.classList.add("tooltip");
    tooltipContent.style.top = "0";
    tooltipContent.textContent = target.textContent;
    document.body.appendChild(tooltipContent);
    let contentOverflowWindow = false;
    // Determine if window width would not be enough for content of tooltip
    if (tooltipGap * 2 + tooltipContent.offsetWidth >= viewportWidth) {
      // setting left, right positions to get correct tooltipContentWidth and tooltipContentHeight
      tooltipContent.style.left = `${tooltipGap}px`;
      tooltipContent.style.right = `${tooltipGap}px`;
      contentOverflowWindow = true;
    }
    const tooltipContentWidth = tooltipContent.offsetWidth;
    const tooltipContentHeight = tooltipContent.offsetHeight;
    tooltipContent.remove();
    const elementMidX = rect.left + (rect.width / 2);
    const placeOnRight = elementMidX + tooltipContentWidth / 2 + tooltipGap > viewportWidth;
    const x = Math.max(tooltipGap, placeOnRight ? viewportWidth - tooltipContentWidth - tooltipGap : elementMidX - tooltipContentWidth / 2);
    const placeAtBottom = rect.top < tooltipContentHeight;
    const y = placeAtBottom ? rect.bottom + tooltipTriangleHeight : rect.top - tooltipContentHeight;
    // Calculating trianglePointX relative to window width, to guarantee that it is not out of window
    const trianglePointX = Math.min(Math.max(elementMidX - x, tooltipTriangleMinGap), tooltipContentWidth - tooltipTriangleMinGap - triangleWidth);
    createTooltip(target.textContent, x, y, trianglePointX, placeAtBottom, contentOverflowWindow);
  }

  /**
   * Renders an item with text and sets up tooltip behavior.
   */
  function renderWithTooltip(item, text) {
    item.innerText = text;
    item.classList.add("text-ellipsis");
    tooltipDetectResizeObserver.observe(item);
  }
</script>
</body>
</html>
